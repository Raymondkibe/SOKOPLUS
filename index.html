<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0">
    <title>SOKOPLUS | Marketplace & Social Platform</title>

<meta name="description" content="Post products, jobs, social updates, and ads. Earn 50% on referrals. Free posts for subscribed users. Boost your posts for visibility." />
<meta name="keywords" content="sokoplus, marketplace, social media, jobs, kenya, earn money, referrals, business" />

<!-- Open Graph / Facebook / WhatsApp -->
<meta property="og:title" content="SOKOPLUS – Kenya's All-In-One Marketplace" />
<meta property="og:description" content="Buy & Sell, Jobs, Business Tools & Earn 50% Referral Commission. Join SOKOPLUS today!" />
<meta property="og:image" content="https://sokoplus.vercel.app/og-image.png" />
<meta property="og:url" content="https://sokoplus.vercel.app/" />
<meta property="og:type" content="website" />
<meta property="og:site_name" content="SOKOPLUS" />

<!-- Image size -->
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:alt" content="SOKOPLUS Kenya Marketplace" />

<!-- Twitter / X -->
<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:title" content="SOKOPLUS – Kenya's All-In-One Marketplace" />
<meta name="twitter:description" content="Buy, Sell, Find Jobs & Earn 50% Referral Commission on SOKOPLUS." />
<meta name="twitter:image" content="https://sokoplus.vercel.app/og-image.png" />    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&family=Montserrat:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link rel="icon" href="favicon.png">
    <!-- Chart.js for analytics -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    <style>
        /* ============================================
           NEW COLOR SCHEME: Facebook + Instagram + WhatsApp + Jumia + Glovo
        ============================================ */
        :root {
            /* FACEBOOK BLUE */
            --primary: #1877F2;
            --primary-dark: #0A5FCC;
            --primary-light: #3D8BF7;
            
            /* INSTAGRAM GRADIENT */
            --instagram-pink: #E4405F;
            --instagram-purple: #8A3AB9;
            --instagram-orange: #FBAD50;
            --instagram-blue: #4C5FD7;
            
            /* WHATSAPP GREEN */
            --whatsapp-green: #25D366;
            --whatsapp-green-dark: #1DA851;
            
            /* JUMIA ORANGE */
            --jumia-orange: #F68B1E;
            --jumia-orange-dark: #D9780A;
            
            /* GLOVO TEAL */
            --glovo-teal: #00B2A9;
            --glovo-teal-dark: #00948C;
            
            /* COMBINED THEME */
            --secondary: var(--instagram-pink);
            --secondary-dark: #D32A50;
            --accent: var(--whatsapp-green);
            --accent-dark: var(--whatsapp-green-dark);
            --business: var(--glovo-teal);
            --business-dark: var(--glovo-teal-dark);
            
            /* STATUS COLORS */
            --success: var(--whatsapp-green);
            --warning: var(--jumia-orange);
            --danger: #FF4757;
            --info: #2E86DE;
            
            /* FACEBOOK-INSPIRED NEUTRALS */
            --dark: #0F172A;
            --dark-gray: #242526;
            --gray: #65676B;
            --light-gray: #B0B3B8;
            --lighter-gray: #E4E6EB;
            --lightest-gray: #F0F2F5;
            --white: #FFFFFF;
            
            /* SHADOWS */
            --shadow-sm: 0 1px 2px rgba(0,0,0,0.1);
            --shadow: 0 2px 4px rgba(0,0,0,0.1);
            --shadow-md: 0 4px 8px rgba(0,0,0,0.1);
            --shadow-lg: 0 8px 16px rgba(0,0,0,0.1);
            --shadow-xl: 0 12px 24px rgba(0,0,0,0.1);
            
            --radius-sm: 6px;
            --radius: 10px;
            --radius-md: 14px;
            --radius-lg: 18px;
            --radius-xl: 24px;
            --radius-full: 9999px;
            
            --transition-fast: all 0.2s ease;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            --transition-slow: all 0.5s ease;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }
        
        body {
            font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
            line-height: 1.6;
            color: var(--lighter-gray);
            background-color: var(--dark);
            min-height: 100vh;
            overflow-x: hidden;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            color: var(--white);
        }
        
        h1 { font-size: clamp(2rem, 5vw, 3.5rem); }
        h2 { font-size: clamp(1.75rem, 4vw, 2.5rem); }
        h3 { font-size: clamp(1.5rem, 3.5vw, 2rem); }
        h4 { font-size: clamp(1.25rem, 3vw, 1.75rem); }
        h5 { font-size: clamp(1.125rem, 2.5vw, 1.5rem); }
        h6 { font-size: clamp(1rem, 2vw, 1.25rem); }
        
        /* ============================================
           CONTAINER
        ============================================ */
        .container {
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 1rem;
        }
        
        /* ============================================
           HEADER & NAVIGATION - FACEBOOK STYLE
        ============================================ */
        .header {
            background: var(--dark-gray);
            box-shadow: var(--shadow);
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            height: 70px;
            border-bottom: 2px solid var(--primary);
        }
        
        .nav-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 100%;
        }
        
        .logo {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            text-decoration: none;
            font-family: 'Montserrat', sans-serif;
        }
        
        .logo-icon {
            width: 50px;
            height: 50px;
            background: linear-gradient(45deg, var(--instagram-purple), var(--instagram-pink), var(--instagram-orange));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.5rem;
            font-weight: 900;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .logo-text {
            font-size: 1.75rem;
            font-weight: 900;
            color: var(--white);
            display: flex;
            flex-direction: column;
            line-height: 1.2;
        }
        
        .logo-text span {
            color: var(--jumia-orange);
            text-shadow: 0 2px 4px rgba(0,0,0,0.5);
        }
        
        .logo-tagline {
            font-size: 0.75rem;
            color: var(--light-gray);
            font-weight: 400;
            font-family: 'Poppins', sans-serif;
        }
        
        .mobile-menu-btn {
            display: none;
            flex-direction: column;
            gap: 5px;
            background: none;
            border: none;
            width: 40px;
            height: 40px;
            padding: 8px;
            cursor: pointer;
            z-index: 1001;
        }
        
        .mobile-menu-btn span {
            display: block;
            width: 100%;
            height: 3px;
            background: var(--jumia-orange);
            border-radius: 2px;
            transition: var(--transition);
        }
        
        .mobile-menu-btn.active span:nth-child(1) {
            transform: rotate(45deg) translate(5px, 5px);
        }
        
        .mobile-menu-btn.active span:nth-child(2) {
            opacity: 0;
        }
        
        .mobile-menu-btn.active span:nth-child(3) {
            transform: rotate(-45deg) translate(7px, -6px);
        }
        
        .nav-menu {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }
        
        .nav-links {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }
        
        .nav-link {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.75rem 1.25rem;
            color: var(--light-gray);
            text-decoration: none;
            border-radius: var(--radius);
            transition: var(--transition-fast);
            font-weight: 500;
            white-space: nowrap;
        }
        
        .nav-link:hover, .nav-link.active {
            background: rgba(24, 119, 242, 0.15);
            color: var(--primary-light);
            border: 1px solid rgba(61, 139, 247, 0.3);
        }
        
        .nav-link i {
            font-size: 1.1rem;
        }
        
        .user-section {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        
        .user-avatar {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--instagram-purple), var(--instagram-pink), var(--instagram-orange));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 600;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition-fast);
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
        }
        
        .user-avatar:hover {
            border-color: var(--jumia-orange);
            transform: scale(1.05);
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            font-weight: 600;
            font-size: 0.95rem;
            cursor: pointer;
            transition: var(--transition-fast);
            border: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            text-align: center;
            white-space: nowrap;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--primary-dark));
            color: var(--white);
            border: 1px solid rgba(61, 139, 247, 0.3);
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            background: linear-gradient(135deg, var(--primary-light), var(--primary));
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, var(--instagram-pink), var(--secondary-dark));
            color: var(--white);
            border: 1px solid rgba(228, 64, 95, 0.3);
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            background: linear-gradient(135deg, #F06A83, var(--instagram-pink));
        }
        
        .btn-accent {
            background: linear-gradient(135deg, var(--whatsapp-green), var(--whatsapp-green-dark));
            color: var(--white);
            border: 1px solid rgba(37, 211, 102, 0.3);
        }
        
        .btn-business {
            background: linear-gradient(135deg, var(--glovo-teal), var(--glovo-teal-dark));
            color: var(--white);
            border: 1px solid rgba(0, 178, 169, 0.3);
        }
        
        .btn-orange {
            background: linear-gradient(135deg, var(--jumia-orange), var(--jumia-orange-dark));
            color: var(--white);
            border: 1px solid rgba(246, 139, 30, 0.3);
        }
        
        .btn-orange:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
            background: linear-gradient(135deg, #F8A145, var(--jumia-orange));
        }
        
        .btn-outline {
            background: transparent;
            border: 2px solid var(--gray);
            color: var(--light-gray);
        }
        
        .btn-outline:hover {
            border-color: var(--primary-light);
            color: var(--primary-light);
            background: rgba(61, 139, 247, 0.1);
        }
        
        .btn-sm {
            padding: 0.5rem 1rem;
            font-size: 0.875rem;
        }
        
        .btn-lg {
            padding: 1rem 2rem;
            font-size: 1.1rem;
        }
        
        /* ============================================
           ENHANCED HERO SECTION - INSTAGRAM STYLE
        ============================================ */
        .hero-section {
            padding: 6rem 0;
            background: linear-gradient(135deg, 
                rgba(24, 119, 242, 0.1) 0%, 
                rgba(138, 58, 185, 0.1) 50%,
                rgba(228, 64, 95, 0.1) 100%), 
                radial-gradient(circle at 20% 80%, rgba(24, 119, 242, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(246, 139, 30, 0.2) 0%, transparent 50%);
            border-radius: 0 0 var(--radius-xl) var(--radius-xl);
            margin-bottom: 3rem;
            position: relative;
            overflow: hidden;
            min-height: 90vh;
            display: flex;
            align-items: center;
        }
        
        .hero-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse"><path d="M 10 0 L 0 0 0 10" fill="none" stroke="rgba(255,255,255,0.05)" stroke-width="0.5"/></pattern></defs><rect width="100" height="100" fill="url(%23grid)"/></svg>');
            pointer-events: none;
        }
        
        .hero-content {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 4rem;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        
        .gradient-text {
            background: linear-gradient(45deg, 
                var(--instagram-purple), 
                var(--instagram-pink), 
                var(--jumia-orange),
                var(--whatsapp-green));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            display: inline-block;
        }
        
        .hero-title {
            font-size: clamp(2.5rem, 6vw, 4rem);
            line-height: 1.2;
            margin-bottom: 1.5rem;
        }
        
        .hero-subtitle {
            font-size: 1.25rem;
            color: var(--lighter-gray);
            margin-bottom: 2.5rem;
            max-width: 600px;
        }
        
        .highlight {
            color: var(--jumia-orange);
            font-weight: 600;
        }
        
        .hero-cta {
            display: flex;
            gap: 1rem;
            margin-bottom: 3rem;
            flex-wrap: wrap;
        }
        
        .hero-stats-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.5rem;
            margin: 3rem 0;
        }
        
        @media (min-width: 768px) {
            .hero-stats-container {
                grid-template-columns: repeat(4, 1fr);
            }
        }
        
        .stat-card {
            background: rgba(36, 37, 38, 0.9);
            backdrop-filter: blur(10px);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            border: 1px solid rgba(61, 139, 247, 0.3);
            transition: var(--transition);
            text-align: center;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            border-color: var(--primary-light);
            box-shadow: 0 10px 30px rgba(24, 119, 242, 0.3);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--instagram-pink), var(--jumia-orange));
        }
        
        .stat-icon {
            width: 50px;
            height: 50px;
            background: rgba(24, 119, 242, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            color: var(--primary-light);
            font-size: 1.25rem;
        }
        
        .stat-number {
            display: block;
            font-size: 2rem;
            font-weight: 800;
            color: var(--jumia-orange);
            line-height: 1;
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--light-gray);
            margin-top: 0.5rem;
            display: block;
        }
        
        .hero-features {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .feature-tag {
            background: rgba(37, 211, 102, 0.1);
            border: 1px solid rgba(37, 211, 102, 0.3);
            color: var(--whatsapp-green);
            padding: 0.5rem 1rem;
            border-radius: var(--radius-full);
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .hero-visual {
            position: relative;
            height: 500px;
        }
        
        .floating-card {
            position: absolute;
            background: var(--dark-gray);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            border: 1px solid var(--gray);
            box-shadow: var(--shadow-lg);
            width: 160px;
            z-index: 2;
            animation: float 6s ease-in-out infinite;
        }
        
        .floating-card.card-1 {
            top: 10%;
            left: 5%;
            animation-delay: 0s;
        }
        
        .floating-card.card-2 {
            top: 40%;
            right: 10%;
            animation-delay: 2s;
        }
        
        .floating-card.card-3 {
            bottom: 20%;
            left: 15%;
            animation-delay: 4s;
        }
        
        .card-icon {
            width: 40px;
            height: 40px;
            background: linear-gradient(45deg, var(--instagram-purple), var(--instagram-pink));
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            margin-bottom: 1rem;
        }
        
        .floating-card h4 {
            font-size: 0.875rem;
            color: var(--white);
            margin-bottom: 0.25rem;
        }
        
        .floating-card p {
            font-size: 1rem;
            color: var(--jumia-orange);
            font-weight: 600;
        }
        
        .hero-illustration {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1;
        }
        
        .phone-mockup {
            width: 280px;
            height: 500px;
            background: linear-gradient(135deg, var(--dark-gray), #1a1a2e);
            border-radius: 40px;
            padding: 15px;
            position: relative;
            border: 3px solid var(--primary);
            box-shadow: 0 20px 50px rgba(0, 0, 0, 0.5);
        }
        
        .phone-screen {
            width: 100%;
            height: 100%;
            background: var(--dark);
            border-radius: 30px;
            overflow: hidden;
            display: flex;
            flex-direction: column;
        }
        
        .app-header {
            background: linear-gradient(135deg, var(--instagram-purple), var(--instagram-pink));
            color: var(--white);
            padding: 1rem;
            text-align: center;
            font-weight: 700;
            font-size: 1.25rem;
        }
        
        .app-content {
            flex: 1;
            padding: 2rem;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .app-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--dark-gray);
            border-radius: var(--radius);
            color: var(--light-gray);
            transition: var(--transition-fast);
        }
        
        .app-item.active {
            background: var(--primary);
            color: var(--white);
            border-left: 4px solid var(--jumia-orange);
        }
        
        .app-item i {
            font-size: 1.25rem;
        }
        
        .scroll-indicator {
            position: absolute;
            bottom: 2rem;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem;
            color: var(--light-gray);
            animation: bounce 2s infinite;
            cursor: pointer;
        }
        
        .scroll-indicator i {
            font-size: 1.5rem;
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-20px); }
        }
        
        @keyframes bounce {
            0%, 20%, 50%, 80%, 100% { transform: translateX(-50%) translateY(0); }
            40% { transform: translateX(-50%) translateY(-10px); }
            60% { transform: translateX(-50%) translateY(-5px); }
        }
        
        .pulse-animation {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(24, 119, 242, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(24, 119, 242, 0); }
            100% { box-shadow: 0 0 0 0 rgba(24, 119, 242, 0); }
        }
        
        /* Fix for mobile responsiveness */
        @media (max-width: 768px) {
            .hero-visual {
                display: none;
            }
            
            .hero-stats-container {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .hero-features {
                justify-content: center;
            }
            
            .hero-content {
                grid-template-columns: 1fr;
                text-align: center;
            }
            
            .hero-cta {
                justify-content: center;
            }
        }
        
        /* ============================================
           MEDIA UPLOAD STYLES
        ============================================ */
        .media-preview-container {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }
        
        .media-preview {
            position: relative;
            width: 100px;
            height: 100px;
            border-radius: var(--radius);
            overflow: hidden;
            border: 2px solid var(--gray);
            background: var(--dark-gray);
        }
        
        .media-preview img, .media-preview video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        .media-preview .remove-media {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 24px;
            height: 24px;
            background: var(--danger);
            color: white;
            border-radius: 50%;
            border: none;
            cursor: pointer;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .upload-area {
            border: 2px dashed var(--gray);
            border-radius: var(--radius);
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: var(--dark-gray);
            margin-bottom: 1rem;
        }
        
        .upload-area:hover {
            border-color: var(--primary-light);
            background: rgba(61, 139, 247, 0.1);
        }
        
        .upload-area i {
            font-size: 2.5rem;
            color: var(--primary-light);
            margin-bottom: 1rem;
        }
        
        .media-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .media-gallery-item {
            width: 100%;
            height: 150px;
            border-radius: var(--radius);
            overflow: hidden;
            position: relative;
            background: var(--dark-gray);
        }
        
        .media-gallery-item img, .media-gallery-item video {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        
        /* ============================================
           CHATBOT STYLES - WHATSAPP INSPIRED
        ============================================ */
        .chatbot-toggle {
            position: fixed;
            bottom: 30px;
            right: 30px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--whatsapp-green), var(--whatsapp-green-dark));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.5rem;
            cursor: pointer;
            box-shadow: var(--shadow-lg);
            z-index: 1000;
            transition: var(--transition);
            border: 2px solid var(--white);
        }
        
        .chatbot-toggle:hover {
            transform: scale(1.1);
            box-shadow: 0 0 20px rgba(37, 211, 102, 0.3);
        }
        
        .chatbot-container {
            position: fixed;
            bottom: 100px;
            right: 30px;
            width: 350px;
            height: 500px;
            background: var(--dark-gray);
            border-radius: var(--radius-xl);
            box-shadow: var(--shadow-xl);
            z-index: 1001;
            display: none;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid var(--primary);
        }
        
        .chatbot-container.active {
            display: flex;
            animation: slideUp 0.3s ease;
        }
        
        .chatbot-header {
            background: linear-gradient(135deg, var(--primary), var(--instagram-purple));
            color: var(--white);
            padding: 1rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 2px solid var(--jumia-orange);
        }
        
        .chatbot-close {
            background: none;
            border: none;
            color: var(--white);
            font-size: 1.2rem;
            cursor: pointer;
        }
        
        .chatbot-messages {
            flex: 1;
            padding: 1.5rem;
            overflow-y: auto;
            background: var(--dark);
        }
        
        .chat-message {
            margin-bottom: 1rem;
            max-width: 80%;
        }
        
        .chat-message.bot {
            align-self: flex-start;
        }
        
        .chat-message.user {
            align-self: flex-end;
            margin-left: auto;
        }
        
        .message-bubble {
            padding: 0.75rem 1rem;
            border-radius: var(--radius-lg);
            background: var(--dark-gray);
            box-shadow: var(--shadow-sm);
            display: inline-block;
            border: 1px solid var(--gray);
        }
        
        .message-bubble.bot {
            background: var(--dark-gray);
            border-top-left-radius: 5px;
            border-left: 3px solid var(--primary);
        }
        
        .message-bubble.user {
            background: var(--primary);
            color: var(--white);
            border-top-right-radius: 5px;
            border-right: 3px solid var(--jumia-orange);
        }
        
        .chatbot-input {
            padding: 1rem;
            border-top: 1px solid var(--gray);
            display: flex;
            gap: 0.5rem;
            background: var(--dark-gray);
        }
        
        .chatbot-input input {
            flex: 1;
            padding: 0.75rem;
            border: 1px solid var(--gray);
            border-radius: var(--radius);
            font-family: 'Poppins', sans-serif;
            background: var(--dark);
            color: var(--white);
        }
        
        .quick-questions {
            padding: 1rem;
            border-top: 1px solid var(--gray);
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            background: var(--dark-gray);
        }
        
        .quick-question {
            padding: 0.5rem 0.75rem;
            background: var(--dark);
            border: 1px solid var(--gray);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            cursor: pointer;
            transition: var(--transition-fast);
            color: var(--light-gray);
        }
        
        .quick-question:hover {
            background: var(--primary);
            color: var(--white);
        }
        
        /* ============================================
           MAIN CONTENT & LAYOUT
        ============================================ */
        .main-container {
            padding-top: 80px;
            min-height: calc(100vh - 200px);
        }
        
        .page {
            display: none;
            animation: fadeIn 0.5s ease;
        }
        
        .page.active {
            display: block;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* ============================================
           FEATURES GRID - ENHANCED
        ============================================ */
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin: 4rem 0;
        }
        
        .feature-card {
            background: var(--dark-gray);
            border-radius: var(--radius-lg);
            padding: 2.5rem;
            text-align: center;
            box-shadow: var(--shadow);
            transition: var(--transition);
            border: 1px solid var(--gray);
            position: relative;
            overflow: hidden;
            height: 100%;
        }
        
        .feature-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, var(--instagram-purple), var(--instagram-pink), var(--jumia-orange));
        }
        
        .feature-card:hover {
            transform: translateY(-10px);
            box-shadow: var(--shadow-xl);
            border-color: var(--primary-light);
        }
        
        .feature-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2.5rem;
            border-radius: var(--radius-lg);
            box-shadow: 0 8px 20px rgba(0,0,0,0.3);
            transition: var(--transition);
        }
        
        .feature-card:hover .feature-icon {
            transform: scale(1.1) rotate(5deg);
        }
        
        .feature-icon.primary {
            background: rgba(24, 119, 242, 0.2);
            color: var(--primary-light);
            border: 1px solid rgba(61, 139, 247, 0.3);
        }
        
        .feature-icon.secondary {
            background: rgba(228, 64, 95, 0.2);
            color: var(--instagram-pink);
            border: 1px solid rgba(228, 64, 95, 0.3);
        }
        
        .feature-icon.accent {
            background: rgba(37, 211, 102, 0.2);
            color: var(--whatsapp-green);
            border: 1px solid rgba(37, 211, 102, 0.3);
        }
        
        /* ============================================
           NEW HOMEPAGE SECTIONS
        ============================================ */
        .trending-section {
            margin: 4rem 0;
        }
        
        .trending-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .trending-item {
            background: var(--dark-gray);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            display: flex;
            align-items: center;
            gap: 1rem;
            border: 1px solid transparent;
            transition: var(--transition);
            cursor: pointer;
        }
        
        .trending-item:hover {
            border-color: var(--primary);
            transform: translateX(5px);
        }
        
        .trending-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .trending-icon.blue { background: rgba(24, 119, 242, 0.2); color: var(--primary); }
        .trending-icon.orange { background: rgba(246, 139, 30, 0.2); color: var(--jumia-orange); }
        .trending-icon.purple { background: rgba(138, 58, 185, 0.2); color: var(--instagram-purple); }
        
        /* New Members Section */
        .members-section {
            margin: 4rem 0;
        }
        
        .members-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .member-card {
            background: var(--dark-gray);
            border-radius: var(--radius-lg);
            padding: 1.5rem 1rem;
            text-align: center;
            border: 1px solid var(--gray);
            transition: var(--transition);
            cursor: pointer;
        }
        
        .member-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
        }
        
        .member-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            background: linear-gradient(45deg, var(--instagram-purple), var(--instagram-pink));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            border: 2px solid var(--jumia-orange);
        }
        
        .member-avatar img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }
        
        /* Featured Shops Section */
        .shops-section {
            margin: 4rem 0;
        }
        
        .shops-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .shop-card {
            background: var(--dark-gray);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            text-align: center;
            border: 1px solid var(--gray);
            transition: var(--transition);
            cursor: pointer;
        }
        
        .shop-card:hover {
            border-color: var(--primary);
            transform: translateY(-5px);
        }
        
        .shop-logo {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin: 0 auto 1rem;
            background: linear-gradient(45deg, var(--instagram-purple), var(--instagram-pink));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
            border: 2px solid var(--jumia-orange);
        }
        
        .shop-logo img {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            object-fit: cover;
        }
        
        /* Reels Section */
        .reels-section {
            margin: 4rem 0;
        }
        .reels-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        .reel-card {
            background: var(--dark-gray);
            border-radius: var(--radius-lg);
            overflow: hidden;
            position: relative;
            cursor: pointer;
            border: 1px solid var(--gray);
            transition: var(--transition);
        }
        .reel-card:hover {
            transform: scale(1.02);
            border-color: var(--primary);
        }
        .reel-card video {
            width: 100%;
            height: 300px;
            object-fit: cover;
        }
        .reel-info {
            padding: 0.75rem;
        }
        .reel-views {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 0.2rem 0.5rem;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
        }
        .reel-tip-btn {
            position: absolute;
            bottom: 0.5rem;
            right: 0.5rem;
            background: var(--whatsapp-green);
            color: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.2rem;
            transition: var(--transition);
        }
        .reel-tip-btn:hover {
            transform: scale(1.1);
        }
        
        /* ============================================
           ADS SECTION (NEW)
        ============================================ */
        .ads-section {
            margin: 4rem 0;
            padding: 2rem;
            background: linear-gradient(135deg, rgba(24,119,242,0.05), rgba(228,64,95,0.05));
            border-radius: var(--radius-xl);
            border: 1px solid var(--primary);
        }
        
        .ads-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .ad-card {
            background: var(--dark-gray);
            border-radius: var(--radius-lg);
            overflow: hidden;
            border: 1px solid var(--gray);
            transition: var(--transition);
            cursor: pointer;
            position: relative;
        }
        
        .ad-card:hover {
            transform: translateY(-5px);
            border-color: var(--jumia-orange);
            box-shadow: 0 10px 20px rgba(246, 139, 30, 0.2);
        }
        
        .ad-card .ad-image {
            height: 150px;
            overflow: hidden;
        }
        
        .ad-card .ad-image img, .ad-card .ad-image video {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s;
        }
        
        .ad-card:hover .ad-image img,
        .ad-card:hover .ad-image video {
            transform: scale(1.1);
        }
        
        .ad-card .ad-content {
            padding: 1.5rem;
        }
        
        .ad-card .ad-title {
            font-size: 1.1rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--white);
        }
        
        .ad-card .ad-description {
            font-size: 0.875rem;
            color: var(--light-gray);
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .ad-card .ad-offer {
            background: var(--success);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-full);
            font-size: 0.7rem;
            font-weight: 600;
            display: inline-block;
            margin-bottom: 0.5rem;
        }
        
        .ad-card .ad-link {
            display: inline-block;
            padding: 0.5rem 1rem;
            background: var(--primary);
            color: white;
            border-radius: var(--radius);
            font-size: 0.875rem;
            text-decoration: none;
            font-weight: 600;
        }
        
        .ad-card .ad-link:hover {
            background: var(--primary-dark);
        }
        
        .ad-card .ad-badge {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--jumia-orange);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-full);
            font-size: 0.7rem;
            font-weight: 600;
            z-index: 2;
        }
        
        /* ============================================
           TESTIMONIALS SECTION
        ============================================ */
        .testimonials-section {
            margin: 6rem 0;
            position: relative;
        }
        
        .testimonials-slider {
            display: flex;
            overflow-x: auto;
            gap: 2rem;
            padding: 2rem 0;
            scrollbar-width: thin;
            scrollbar-color: var(--primary) var(--dark);
        }
        
        .testimonial-card {
            min-width: 350px;
            background: var(--dark-gray);
            border-radius: var(--radius-xl);
            padding: 2.5rem;
            position: relative;
            border: 1px solid var(--gray);
        }
        
        .testimonial-card::before {
            content: '"';
            position: absolute;
            top: 20px;
            left: 20px;
            font-size: 5rem;
            color: var(--primary);
            opacity: 0.3;
            font-family: serif;
        }
        
        .testimonial-content {
            margin-bottom: 2rem;
            position: relative;
            z-index: 1;
        }
        
        .testimonial-author {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-top: 1.5rem;
        }
        
        /* ============================================
           CONTENT CARDS & GRIDS
        ============================================ */
        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
            flex-wrap: wrap;
            gap: 1rem;
        }
        
        .section-title {
            position: relative;
            padding-bottom: 0.5rem;
        }
        
        .section-title::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 80px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--instagram-pink), var(--jumia-orange));
            border-radius: 2px;
        }
        
        .content-tabs {
            display: flex;
            gap: 0.5rem;
            border-bottom: 2px solid var(--gray);
            margin-bottom: 2rem;
            overflow-x: auto;
            padding-bottom: 0.5rem;
        }
        
        .tab-btn {
            padding: 0.75rem 1.5rem;
            background: none;
            border: none;
            color: var(--light-gray);
            font-weight: 600;
            cursor: pointer;
            border-radius: var(--radius) var(--radius) 0 0;
            transition: var(--transition-fast);
            white-space: nowrap;
        }
        
        .tab-btn:hover {
            color: var(--primary-light);
            background: rgba(61, 139, 247, 0.1);
        }
        
        .tab-btn.active {
            color: var(--jumia-orange);
            background: var(--dark-gray);
            border-bottom: 3px solid var(--jumia-orange);
        }
        
        .content-grid {
            display: grid;
            gap: 1.5rem;
        }
        
        .grid-2 { grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); }
        .grid-3 { grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
        .grid-4 { grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); }
        
        .card {
            background: var(--dark-gray);
            border-radius: var(--radius-lg);
            overflow: hidden;
            box-shadow: var(--shadow);
            transition: var(--transition);
            cursor: pointer;
            border: 1px solid var(--gray);
            position: relative;
        }
        
        .card:hover {
            transform: translateY(-5px);
            box-shadow: var(--shadow-lg);
            border-color: var(--primary-light);
        }
        
        .product-card .card-image {
            height: 200px;
            position: relative;
            overflow: hidden;
        }
        
        .product-card .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        
        .product-card:hover .card-image img {
            transform: scale(1.1);
        }
        
        .product-card .boost-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: linear-gradient(135deg, var(--jumia-orange), var(--jumia-orange-dark));
            color: var(--white);
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 0.25rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.3);
            z-index: 2;
        }
        
        .product-card .countdown {
            position: absolute;
            bottom: 1rem;
            left: 1rem;
            background: rgba(0,0,0,0.7);
            color: white;
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-full);
            font-size: 0.7rem;
            z-index: 2;
        }
        
        .product-card .card-content {
            padding: 1.5rem;
        }
        
        .product-card .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--white);
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .product-card .card-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--jumia-orange);
            margin-bottom: 1rem;
        }
        
        .social-card .card-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1.5rem 1.5rem 1rem;
        }
        
        .social-card .user-avatar-sm {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--instagram-purple), var(--instagram-pink));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-weight: 600;
        }
        
        .social-card .post-content {
            padding: 0 1.5rem 1rem;
        }
        
        .social-card .post-actions {
            display: flex;
            justify-content: space-around;
            padding: 1rem 1.5rem;
            border-top: 1px solid var(--gray);
        }
        
        .social-card .post-action {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            background: none;
            border: none;
            color: var(--light-gray);
            cursor: pointer;
            transition: var(--transition-fast);
        }
        
        .social-card .post-action:hover {
            color: var(--primary-light);
        }
        
        .job-card .card-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--gray);
        }
        
        .job-card .job-type {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            background: rgba(24, 119, 242, 0.2);
            color: var(--primary-light);
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            border: 1px solid rgba(61, 139, 247, 0.3);
        }
        
        .job-card .card-content {
            padding: 1.5rem;
        }
        
        .job-card .job-salary {
            color: var(--jumia-orange);
            font-weight: 600;
            margin: 1rem 0;
        }
        
        .proposal-card {
            background: var(--dark-gray);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            border: 1px solid var(--gray);
        }
        
        .proposal-card .proposal-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: var(--white);
            margin-bottom: 0.5rem;
        }
        
        .proposal-card .proposal-budget {
            color: var(--whatsapp-green);
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        /* Digital Product Card */
        .digital-card .card-image {
            height: 200px;
            background: linear-gradient(135deg, var(--instagram-purple), var(--instagram-pink));
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 3rem;
        }
        .digital-card .card-content {
            padding: 1.5rem;
        }
        .digital-card .card-title {
            font-size: 1.125rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--white);
        }
        .digital-card .card-price {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--jumia-orange);
            margin-bottom: 1rem;
        }
        .digital-card .buy-btn {
            background: var(--whatsapp-green);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: var(--radius);
            cursor: pointer;
            font-weight: 600;
            width: 100%;
            transition: var(--transition);
        }
        .digital-card .buy-btn:hover {
            background: var(--whatsapp-green-dark);
        }
        
        /* Lesson Card */
        .lesson-card .card-image {
            height: 200px;
            position: relative;
        }
        .lesson-card .card-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .lesson-card .playlist-badge {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--primary);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: var(--radius-full);
            font-size: 0.7rem;
        }
        .lesson-card .card-content {
            padding: 1rem;
        }
        
        /* ============================================
           POST CREATION FORMS
        ============================================ */
        .post-creation-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .post-tab {
            padding: 1rem 1.5rem;
            background: var(--dark-gray);
            border: 2px solid var(--gray);
            border-radius: var(--radius);
            color: var(--light-gray);
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition-fast);
            display: flex;
            align-items: center;
            gap: 0.5rem;
            flex: 1;
            min-width: 200px;
            justify-content: center;
        }
        
        .post-tab:hover {
            border-color: var(--primary-light);
            color: var(--primary-light);
        }
        
        .post-tab.active {
            border-color: var(--primary-light);
            background: rgba(61, 139, 247, 0.1);
            color: var(--primary-light);
        }
        
        .form-container {
            max-width: 800px;
            margin: 0 auto;
        }
        
        .form-card {
            background: var(--dark-gray);
            border-radius: var(--radius-xl);
            padding: 3rem;
            box-shadow: var(--shadow-xl);
            border: 1px solid var(--primary);
        }
        
        .form-title {
            text-align: center;
            margin-bottom: 2rem;
            color: var(--white);
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: var(--white);
        }
        
        .form-control {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--gray);
            border-radius: var(--radius);
            font-size: 1rem;
            transition: var(--transition-fast);
            font-family: 'Poppins', sans-serif;
            background: var(--dark);
            color: var(--white);
        }
        
        .form-control:focus {
            outline: none;
            border-color: var(--primary-light);
            box-shadow: 0 0 0 3px rgba(61, 139, 247, 0.1);
        }
        
        .form-textarea {
            min-height: 150px;
            resize: vertical;
        }
        
        .media-upload {
            border: 2px dashed var(--gray);
            border-radius: var(--radius);
            padding: 3rem 1rem;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
            background: var(--dark);
        }
        
        .media-upload:hover {
            border-color: var(--primary-light);
            background: rgba(61, 139, 247, 0.05);
        }
        
        /* ============================================
           DASHBOARD - ENHANCED
        ============================================ */
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }
        
        .stat-card {
            background: var(--dark-gray);
            border-radius: var(--radius-lg);
            padding: 1.5rem;
            box-shadow: var(--shadow);
            display: flex;
            align-items: center;
            gap: 1rem;
            border: 1px solid var(--gray);
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }
        
        .stat-card:hover {
            border-color: var(--primary);
            transform: translateY(-3px);
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--instagram-purple));
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            flex-shrink: 0;
        }
        
        .stat-content {
            flex: 1;
        }
        
        .stat-value {
            font-size: 1.75rem;
            font-weight: 800;
            line-height: 1;
            margin-bottom: 0.25rem;
            color: var(--white);
        }
        
        .earnings-card {
            background: linear-gradient(135deg, var(--instagram-purple), var(--instagram-pink), var(--jumia-orange));
            color: var(--white);
            border-radius: var(--radius-xl);
            padding: 2.5rem;
            margin: 3rem 0;
            border: 2px solid var(--jumia-orange);
            box-shadow: var(--shadow-lg);
            position: relative;
            overflow: hidden;
        }
        
        .earnings-card::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 100%;
            height: 200%;
            background: radial-gradient(circle, rgba(255,255,255,0.1) 1px, transparent 1px);
            background-size: 20px 20px;
            opacity: 0.2;
            animation: moveBackground 20s linear infinite;
        }
        
        @keyframes moveBackground {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* Wallet Balance Card */
        .wallet-card {
            background: linear-gradient(135deg, var(--primary), var(--instagram-purple));
            border-radius: var(--radius-xl);
            padding: 1.5rem;
            margin-bottom: 2rem;
            color: white;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }
        .wallet-balance {
            font-size: 2rem;
            font-weight: 800;
        }
        .deposit-btn {
            background: white;
            color: var(--primary);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: var(--radius);
            font-weight: 600;
            cursor: pointer;
        }
        
        /* Bonus Milestone Card */
        .bonus-card {
            background: linear-gradient(135deg, var(--instagram-purple), var(--instagram-pink));
            color: var(--white);
            border-radius: var(--radius-xl);
            padding: 2rem;
            margin-bottom: 2rem;
            border: 2px solid var(--jumia-orange);
            box-shadow: var(--shadow-lg);
        }
        .bonus-card h4 {
            color: white;
            margin-bottom: 1rem;
        }
        .bonus-progress-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }
        .bonus-progress-item {
            background: rgba(255,255,255,0.1);
            border-radius: var(--radius-lg);
            padding: 1rem;
        }
        .bonus-progress-bar {
            background: rgba(255,255,255,0.2);
            height: 8px;
            border-radius: 4px;
            margin: 0.5rem 0;
        }
        .bonus-progress-fill {
            height: 8px;
            border-radius: 4px;
            background: var(--whatsapp-green);
            width: 0%;
        }
        .bonus-progress-fill.referrals {
            background: var(--jumia-orange);
        }
        
        /* ============================================
           BUSINESS TOOLS - ENHANCED SECTION
        ============================================ */
        .business-tools-section {
            margin: 4rem 0;
        }
        
        .tools-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 2rem;
            margin-top: 2rem;
        }
        
        .tool-card {
            background: var(--dark-gray);
            border-radius: var(--radius-lg);
            padding: 2rem;
            text-align: center;
            border: 2px solid transparent;
            transition: var(--transition);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .tool-card:hover {
            border-color: var(--glovo-teal);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 178, 169, 0.2);
        }
        
        .tool-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, transparent, rgba(0, 178, 169, 0.1));
            opacity: 0;
            transition: var(--transition);
        }
        
        .tool-card:hover::before {
            opacity: 1;
        }
        
        .tool-icon {
            width: 80px;
            height: 80px;
            margin: 0 auto 1.5rem;
            background: rgba(0, 178, 169, 0.2);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            color: var(--glovo-teal);
            border: 2px solid var(--glovo-teal);
        }
        
        .tool-coming-soon {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--jumia-orange);
            color: var(--dark);
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        /* ============================================
           MODALS
        ============================================ */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            padding: 1rem;
        }
        
        .modal.active {
            display: flex;
            animation: fadeIn 0.3s ease;
        }
        
        .modal-content {
            background: var(--dark-gray);
            border-radius: var(--radius-xl);
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            animation: slideUp 0.3s ease;
            position: relative;
            border: 2px solid var(--primary);
        }
        
        .modal-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--jumia-orange);
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            z-index: 10;
        }
        
        .modal-close:hover {
            background: var(--dark);
        }
        
        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        /* Calculator Tabs */
        .calculator-tabs {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1.5rem;
            border-bottom: 1px solid var(--gray);
            padding-bottom: 0.5rem;
        }
        
        .calculator-tab {
            padding: 0.5rem 1rem;
            background: var(--dark);
            border: 1px solid var(--gray);
            border-radius: var(--radius);
            color: var(--light-gray);
            cursor: pointer;
            transition: var(--transition-fast);
            font-size: 0.9rem;
        }
        
        .calculator-tab:hover,
        .calculator-tab.active {
            background: var(--primary);
            color: white;
            border-color: var(--primary);
        }
        
        .calculator-pane {
            display: none;
        }
        
        .calculator-pane.active {
            display: block;
        }
        
        .calculator-input-group {
            margin-bottom: 1rem;
        }
        
        .calculator-input-group label {
            display: block;
            margin-bottom: 0.25rem;
            color: var(--light-gray);
            font-size: 0.9rem;
        }
        
        .calculator-input-group input {
            width: 100%;
            padding: 0.75rem;
            border-radius: var(--radius);
            border: 1px solid var(--gray);
            background: var(--dark);
            color: var(--white);
        }
        
        .calculator-result {
            margin-top: 1.5rem;
            padding: 1rem;
            background: var(--primary);
            border-radius: var(--radius);
            color: white;
            font-weight: 600;
            text-align: center;
            font-size: 1.2rem;
        }
        
        /* ============================================
           NOTIFICATIONS
        ============================================ */
        .notification {
            position: fixed;
            top: 80px;
            right: 1rem;
            padding: 1rem 1.5rem;
            border-radius: var(--radius);
            color: var(--white);
            font-weight: 500;
            box-shadow: var(--shadow-xl);
            z-index: 3000;
            animation: slideIn 0.3s ease;
            max-width: 400px;
            word-wrap: break-word;
            border-left: 4px solid var(--jumia-orange);
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); opacity: 0; }
            to { transform: translateX(0); opacity: 1; }
        }
        
        /* ============================================
           FOOTER
        ============================================ */
        .footer {
            background: var(--dark-gray);
            color: var(--light-gray);
            margin-top: 4rem;
            border-top: 2px solid var(--primary);
        }
        
        .footer-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 3rem;
            padding: 4rem 0;
        }
        
        .footer-bottom {
            text-align: center;
            padding: 2rem 0;
            border-top: 1px solid var(--gray);
            color: var(--light-gray);
            font-size: 0.875rem;
        }
        
        /* ============================================
           RESPONSIVE DESIGN
        ============================================ */
        @media (max-width: 1200px) {
            .hero-content { grid-template-columns: 1fr; }
            .hero-visual { display: none; }
        }
        
        @media (max-width: 768px) {
            .mobile-menu-btn { display: flex; }
            
            .nav-menu {
                position: fixed;
                top: 70px;
                left: -100%;
                width: 100%;
                height: calc(100vh - 70px);
                background: var(--dark-gray);
                flex-direction: column;
                padding: 2rem 1.5rem;
                transition: var(--transition);
                overflow-y: auto;
                gap: 0;
                border-top: 2px solid var(--primary);
            }
            
            .nav-menu.active {
                left: 0;
            }
            
            .nav-links {
                flex-direction: column;
                width: 100%;
                gap: 0.5rem;
                margin-bottom: 2rem;
            }
            
            .nav-link {
                width: 100%;
                justify-content: flex-start;
            }
            
            .user-section {
                flex-direction: column;
                width: 100%;
                gap: 1rem;
                padding-top: 1rem;
                border-top: 1px solid var(--gray);
            }
            
            .hero-content {
                gap: 2rem;
            }
            
            .hero-stats-container {
                flex-wrap: wrap;
                justify-content: flex-start;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
            }
            
            .form-card {
                padding: 1.5rem;
            }
            
            .chatbot-container {
                width: 90%;
                right: 5%;
                bottom: 80px;
            }
        }
        
        @media (max-width: 576px) {
            .hero-section { padding: 3rem 0; }
            .features-grid { grid-template-columns: 1fr; }
            .grid-3, .grid-4 { grid-template-columns: 1fr; }
            .post-tab { min-width: 100%; }
            .testimonial-card { min-width: 280px; }
        }
        
        /* ============================================
           UTILITY CLASSES
        ============================================ */
        .text-center { text-align: center; }
        .text-right { text-align: right; }
        .text-left { text-align: left; }
        .mb-1 { margin-bottom: 1rem; }
        .mb-2 { margin-bottom: 2rem; }
        .mb-3 { margin-bottom: 3rem; }
        .mt-1 { margin-top: 1rem; }
        .mt-2 { margin-top: 2rem; }
        .mt-3 { margin-top: 3rem; }
        .w-full { width: 100%; }
        .hidden { display: none !important; }
        .flex { display: flex; }
        .flex-col { flex-direction: column; }
        .items-center { align-items: center; }
        .justify-between { justify-content: space-between; }
        .gap-1 { gap: 1rem; }
        .gap-2 { gap: 2rem; }
        .gap-3 { gap: 3rem; }
        
        .badge {
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius-full);
            font-size: 0.75rem;
            font-weight: 600;
            display: inline-block;
        }
        
        .badge-success { background: rgba(37, 211, 102, 0.2); color: var(--whatsapp-green); border: 1px solid rgba(37, 211, 102, 0.3); }
        .badge-warning { background: rgba(246, 139, 30, 0.2); color: var(--jumia-orange); border: 1px solid rgba(246, 139, 30, 0.3); }
        .badge-danger { background: rgba(255, 71, 87, 0.2); color: var(--danger); border: 1px solid rgba(255, 71, 87, 0.3); }
        .badge-info { background: rgba(24, 119, 242, 0.2); color: var(--primary); border: 1px solid rgba(61, 139, 247, 0.3); }
        .badge-primary { background: rgba(24, 119, 242, 0.2); color: var(--primary-light); border: 1px solid rgba(61, 139, 247, 0.3); }
        .badge-secondary { background: rgba(228, 64, 95, 0.2); color: var(--instagram-pink); border: 1px solid rgba(228, 64, 95, 0.3); }
        .badge-accent { background: rgba(37, 211, 102, 0.2); color: var(--whatsapp-green); border: 1px solid rgba(37, 211, 102, 0.3); }
        
        .empty-state {
            text-align: center;
            padding: 4rem 1rem;
            color: var(--gray);
            grid-column: 1 / -1;
        }
        
        .empty-state i {
            font-size: 4rem;
            margin-bottom: 1rem;
            color: var(--gray);
        }
        
        /* ============================================
           PAYMENT METHODS STYLES
        ============================================ */
        .payment-methods {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .payment-method {
            background: var(--dark);
            border-radius: var(--radius-lg);
            padding: 2rem;
            border: 2px solid var(--gray);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
            position: relative;
        }
        
        .payment-method:hover {
            border-color: var(--primary-light);
            transform: translateY(-2px);
        }
        
        .payment-method.selected {
            border-color: var(--jumia-orange);
            background: rgba(246, 139, 30, 0.1);
        }
        
        .payment-method-header {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .payment-method-icon {
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary), var(--instagram-purple));
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.5rem;
        }
        
        .payment-method-features {
            text-align: left;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--gray);
        }
        
        .payment-method-feature {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            color: var(--light-gray);
            font-size: 0.875rem;
        }
        
        .payment-method-feature i {
            color: var(--whatsapp-green);
        }
        
        /* Automatic Payment Flow */
        .automatic-payment-flow {
            background: var(--dark);
            border-radius: var(--radius);
            padding: 2rem;
            margin-top: 2rem;
            border: 1px solid var(--gray);
        }
        
        .payment-step {
            display: flex;
            align-items: flex-start;
            gap: 1rem;
            margin-bottom: 1.5rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--gray);
        }
        
        .payment-step:last-child {
            border-bottom: none;
            margin-bottom: 0;
            padding-bottom: 0;
        }
        
        .step-number {
            width: 30px;
            height: 30px;
            background: var(--primary);
            color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            flex-shrink: 0;
        }
        
        .payment-pin-input {
            width: 100%;
            padding: 1rem;
            border: 2px solid var(--gray);
            border-radius: var(--radius);
            font-size: 1.5rem;
            letter-spacing: 8px;
            text-align: center;
            background: var(--dark-gray);
            color: var(--white);
            font-family: monospace;
        }
        
        .payment-pin-input:focus {
            outline: none;
            border-color: var(--whatsapp-green);
        }
        
        .payment-timer {
            text-align: center;
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--jumia-orange);
            margin: 1rem 0;
        }
        
        .simulated-phone {
            background: var(--dark-gray);
            border-radius: var(--radius);
            padding: 2rem;
            margin-top: 1.5rem;
            border: 2px solid var(--primary);
            position: relative;
            overflow: hidden;
        }
        
        .simulated-phone::before {
            content: "M-Pesa";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            background: linear-gradient(135deg, var(--whatsapp-green), #1DA851);
            color: white;
            text-align: center;
            padding: 0.5rem;
            font-weight: 600;
        }
        
        .simulated-message {
            background: var(--dark);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin-top: 2rem;
            border-left: 4px solid var(--jumia-orange);
        }
        
        /* Manual Payment Flow */
        .manual-payment-flow {
            background: var(--dark);
            border-radius: var(--radius);
            padding: 2rem;
            margin-top: 2rem;
            border: 1px solid var(--gray);
        }
        
        .payment-details {
            background: var(--dark-gray);
            border-radius: var(--radius);
            padding: 1.5rem;
            margin: 1.5rem 0;
            border: 1px solid var(--gray);
        }
        
        .payment-detail {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem 0;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .payment-detail:last-child {
            border-bottom: none;
        }
        
        .payment-detail-label {
            color: var(--light-gray);
        }
        
        .payment-detail-value {
            color: var(--white);
            font-weight: 600;
        }
        
        .payment-detail-value.amount {
            color: var(--jumia-orange);
            font-size: 1.25rem;
        }
        
        .copy-btn {
            background: none;
            border: 1px solid var(--gray);
            color: var(--light-gray);
            padding: 0.25rem 0.75rem;
            border-radius: var(--radius);
            cursor: pointer;
            transition: var(--transition-fast);
        }
        
        .copy-btn:hover {
            border-color: var(--whatsapp-green);
            color: var(--whatsapp-green);
        }
        
        .payment-status {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 1rem;
            border-radius: var(--radius);
            margin-top: 1.5rem;
            font-weight: 600;
        }
        
        .payment-status.pending {
            background: rgba(246, 139, 30, 0.1);
            color: var(--jumia-orange);
            border: 1px solid rgba(246, 139, 30, 0.3);
        }
        
        .payment-status.success {
            background: rgba(37, 211, 102, 0.1);
            color: var(--whatsapp-green);
            border: 1px solid rgba(37, 211, 102, 0.3);
        }
        
        /* ============================================
           PASSWORD RECOVERY STYLES
        ============================================ */
        .recovery-steps {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }
        
        .step {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 1rem;
            background: var(--dark);
            border-radius: var(--radius);
            border-left: 4px solid var(--primary);
            border: 1px solid var(--gray);
        }
        
        .step-number {
            width: 30px;
            height: 30px;
            background: var(--primary);
            color: var(--white);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }
        
        /* ============================================
           PROFILE STYLES
        ============================================ */
        .profile-header {
            display: flex;
            align-items: center;
            gap: 2rem;
            margin-bottom: 2rem;
            padding-bottom: 2rem;
            border-bottom: 1px solid var(--gray);
        }
        
        .profile-avatar-lg {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--instagram-purple), var(--instagram-pink));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 2.5rem;
            font-weight: 600;
            border: 3px solid var(--jumia-orange);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .profile-info h3 {
            margin-bottom: 0.5rem;
        }
        
        .profile-info p {
            color: var(--light-gray);
            margin-bottom: 0.5rem;
        }

        /* ============================================
           ADMIN SPECIFIC STYLES
        ============================================ */
        .admin-table {
            width: 100%;
            background: var(--dark);
            border-radius: var(--radius);
            overflow: hidden;
            border: 1px solid var(--gray);
        }
        
        .admin-table th {
            background: var(--primary);
            color: var(--white);
            padding: 1rem;
            text-align: left;
            font-weight: 600;
        }
        
        .admin-table td {
            padding: 1rem;
            border-bottom: 1px solid var(--gray);
            color: var(--light-gray);
        }
        
        .admin-table tr:hover {
            background: var(--dark-gray);
        }
        
        .admin-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        /* ============================================
           PAYMENT OPTIONS STYLES
        ============================================ */
        .payment-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .payment-option {
            background: var(--dark);
            border-radius: var(--radius);
            padding: 1.5rem;
            border: 2px solid var(--gray);
            cursor: pointer;
            transition: var(--transition);
        }
        
        .payment-option:hover {
            border-color: var(--primary-light);
            transform: translateY(-2px);
        }
        
        .payment-option.selected {
            border-color: var(--jumia-orange);
            background: rgba(246, 139, 30, 0.1);
        }
        
        .payment-option-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .payment-option-icon {
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.5rem;
        }
        
        /* ============================================
           DASHBOARD QUICK ACTIONS
        ============================================ */
        .quick-actions {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }
        
        .quick-action-btn {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 1.5rem;
            background: var(--dark-gray);
            border-radius: var(--radius);
            border: 1px solid var(--gray);
            cursor: pointer;
            transition: var(--transition);
            text-align: center;
        }
        
        .quick-action-btn:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
            background: rgba(24, 119, 242, 0.1);
        }
        
        .quick-action-btn i {
            font-size: 2rem;
            margin-bottom: 0.5rem;
            color: var(--primary);
        }
        
        /* ============================================
           LOADING SPINNER
        ============================================ */
        .spinner {
            width: 40px;
            height: 40px;
            border: 3px solid rgba(61, 139, 247, 0.3);
            border-radius: 50%;
            border-top-color: var(--primary);
            animation: spin 1s ease-in-out infinite;
            margin: 2rem auto;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .post-form {
            display: none;
        }
        
        .post-form.active {
            display: block;
        }
        
        .content-tab {
            display: none;
        }
        
        .dashboard-tab {
            display: none;
        }
        
        .dashboard-tab:first-child {
            display: block;
        }

        /* ============================================
           SHOP STYLES
        ============================================ */
        .shop-header {
            display: flex;
            align-items: center;
            gap: 2rem;
            margin-bottom: 2rem;
            padding: 2rem;
            background: var(--dark-gray);
            border-radius: var(--radius-xl);
            border: 2px solid var(--primary);
        }
        
        .shop-avatar-lg {
            width: 120px;
            height: 120px;
            border-radius: var(--radius-xl);
            background: linear-gradient(45deg, var(--instagram-purple), var(--instagram-pink));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 3rem;
            font-weight: 600;
            border: 3px solid var(--jumia-orange);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .shop-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .shop-stat {
            text-align: center;
            padding: 1rem;
            background: var(--dark);
            border-radius: var(--radius);
            border: 1px solid var(--gray);
        }
        
        .shop-stat-value {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--jumia-orange);
            display: block;
        }
        
        .shop-stat-label {
            font-size: 0.875rem;
            color: var(--light-gray);
            margin-top: 0.25rem;
        }

        /* Shop Rating */
        .shop-rating {
            display: flex;
            align-items: center;
            gap: 0.25rem;
            margin-top: 0.5rem;
        }
        .star {
            color: gold;
            cursor: pointer;
            font-size: 1.2rem;
        }
        .star.inactive {
            color: var(--gray);
        }

        /* ============================================
           CV UPLOAD STYLES
        ============================================ */
        .cv-preview {
            width: 100%;
            height: 300px;
            border-radius: var(--radius);
            overflow: hidden;
            border: 2px solid var(--gray);
            background: var(--dark);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 2rem;
        }
        
        .cv-preview i {
            font-size: 4rem;
            color: var(--primary);
            margin-bottom: 1rem;
        }
        
        .cv-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }
        
        .cv-item {
            background: var(--dark-gray);
            border-radius: var(--radius);
            padding: 1.5rem;
            border: 1px solid var(--gray);
            transition: var(--transition);
            cursor: pointer;
        }
        
        .cv-item:hover {
            border-color: var(--primary);
            transform: translateY(-2px);
        }
        
        .cv-item-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }
        
        .cv-item-icon {
            width: 50px;
            height: 50px;
            background: var(--primary);
            border-radius: var(--radius);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 1.5rem;
        }

        /* ============================================
           SHOP PRODUCTS GRID
        ============================================ */
        .shop-products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 2rem;
        }

        /* ============================================
           BUSINESS CALCULATOR (enhanced)
        ============================================ */
        .calculator {
            background: var(--dark);
            border-radius: var(--radius);
            padding: 2rem;
            border: 1px solid var(--gray);
        }
        .calculator .input-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }
        .calculator label {
            color: var(--white);
            font-weight: 500;
        }
        .calculator input {
            padding: 0.75rem;
            border-radius: var(--radius);
            border: 1px solid var(--gray);
            background: var(--dark-gray);
            color: var(--white);
        }
        .calculator .result {
            margin-top: 2rem;
            padding: 1rem;
            background: var(--primary);
            border-radius: var(--radius);
            color: white;
            font-weight: 600;
            text-align: center;
        }

        /* ============================================
           USER PROFILE PAGE STYLES
        ============================================ */
        .user-profile-header {
            display: flex;
            align-items: center;
            gap: 2rem;
            margin-bottom: 2rem;
            padding: 2rem;
            background: var(--dark-gray);
            border-radius: var(--radius-xl);
            border: 2px solid var(--primary);
        }
        
        .user-profile-avatar-lg {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            background: linear-gradient(45deg, var(--instagram-purple), var(--instagram-pink));
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--white);
            font-size: 3rem;
            font-weight: 600;
            border: 3px solid var(--jumia-orange);
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        }
        
        .user-profile-info {
            flex: 1;
        }
        
        .user-profile-meta {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin: 1rem 0;
        }
        
        .user-profile-meta span {
            color: var(--light-gray);
            font-size: 0.9rem;
        }
        
        .user-profile-meta i {
            color: var(--primary);
            margin-right: 0.3rem;
        }

        /* ============================================
           ADS POPUP
        ============================================ */
        .ad-popup {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--dark-gray);
            border-radius: var(--radius-xl);
            padding: 2rem;
            max-width: 500px;
            width: 90%;
            z-index: 3000;
            border: 3px solid var(--primary);
            box-shadow: var(--shadow-xl);
            display: none;
        }
        .ad-popup.active {
            display: block;
            animation: fadeIn 0.3s;
        }
        .ad-popup-close {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: none;
            border: none;
            color: var(--light-gray);
            font-size: 1.5rem;
            cursor: pointer;
        }
        .ad-popup-image {
            width: 100%;
            max-height: 200px;
            object-fit: cover;
            border-radius: var(--radius);
            margin-bottom: 1rem;
        }

        /* ============================================
           NEW FEATURE STYLES
        ============================================ */
        .star-rating {
            display: inline-flex;
            gap: 0.2rem;
            margin: 0.5rem 0;
        }
        .star-rating .fa-star {
            color: gold;
        }
        .star-rating .fa-star.inactive {
            color: var(--gray);
        }
        .order-item {
            background: var(--dark-gray);
            border-radius: var(--radius);
            padding: 1rem;
            margin-bottom: 1rem;
            border: 1px solid var(--gray);
        }
        .chat-window {
            display: flex;
            flex-direction: column;
            height: 400px;
            background: var(--dark);
            border-radius: var(--radius);
            border: 1px solid var(--gray);
        }
        .chat-messages-area {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
        }
        .chat-input-area {
            display: flex;
            padding: 0.5rem;
            border-top: 1px solid var(--gray);
        }
        .chat-input-area input {
            flex: 1;
            padding: 0.5rem;
            border-radius: var(--radius);
            border: none;
            background: var(--dark-gray);
            color: var(--white);
        }
        .chat-input-area button {
            margin-left: 0.5rem;
        }
        .badge-gold {
            background: gold;
            color: black;
        }
        .badge-silver {
            background: silver;
            color: black;
        }
        .badge-bronze {
            background: #cd7f32;
            color: black;
        }
        .shipping-form {
            display: grid;
            gap: 1rem;
        }
        .language-switcher {
            display: flex;
            gap: 0.5rem;
            margin-left: 1rem;
        }
        .language-switcher button {
            padding: 0.25rem 0.5rem;
            background: var(--dark);
            border: 1px solid var(--gray);
            border-radius: var(--radius);
            color: var(--light-gray);
            cursor: pointer;
        }
        .language-switcher button.active {
            background: var(--primary);
            color: white;
        }
        .notification-badge {
            position: relative;
        }
        .notification-badge::after {
            content: attr(data-count);
            position: absolute;
            top: -5px;
            right: -5px;
            background: var(--danger);
            color: white;
            font-size: 0.7rem;
            padding: 0.1rem 0.3rem;
            border-radius: 50%;
        }
        .analytics-chart {
            background: var(--dark-gray);
            border-radius: var(--radius);
            padding: 1rem;
            margin: 1rem 0;
        }
        .recommended-section {
            margin: 3rem 0;
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="header">
        <div class="container">
            <div class="nav-container">
                <a href="#" class="logo" onclick="showPage('home'); return false;">
                    <div class="logo-icon">S+</div>
                    <div class="logo-text">
                        SOKO<span>PLUS</span>
                        <span class="logo-tagline">Marketplace & Business Hub</span>
                    </div>
                </a>
                
                <button class="mobile-menu-btn" id="mobileMenuBtn">
                    <span></span>
                    <span></span>
                    <span></span>
                </button>
                
                <nav class="nav-menu" id="navMenu">
                    <div class="nav-links" id="navLinks">
                        <!-- Navigation loaded by JavaScript -->
                    </div>
                    
                    <div class="user-section" id="userSection">
                        <!-- User section loaded by JavaScript -->
                    </div>
                    <!-- Language Switcher -->
                    <div class="language-switcher" id="languageSwitcher">
                        <button class="active" onclick="setLanguage('en')">EN</button>
                        <button onclick="setLanguage('sw')">SW</button>
                    </div>
                </nav>
            </div>
        </div>
    </header>
    
    <!-- Main Content -->
    <main class="main-container">
        <!-- Home Page - ENHANCED -->
        <section id="home" class="page active">
            <div class="container">
                <!-- Enhanced Hero Section -->
                <div class="hero-section">
                    <div class="hero-content">
                        <div class="hero-text">
                            <h1 class="hero-title">
                                <span class="gradient-text">Sell, Connect & Grow</span>
                                <br>with SOKOPLUS Marketplace
                            </h1>
                            <p class="hero-subtitle">
                                Kenyans all-in-one platform for businesses & individuals. 
                                Post products, jobs, services & social updates. 
                                <span class="highlight">Earn 50% commission</span> on referrals!
                            </p>
                            
                            <div class="hero-cta" id="heroActions">
                                <!-- Buttons loaded by JavaScript -->
                            </div>
                            
                            <div class="hero-stats-container">
                                <div class="stat-card pulse-animation">
                                    <div class="stat-icon">
                                        <i class="fas fa-users"></i>
                                    </div>
                                    <div class="stat-data">
                                        <span class="stat-number" id="totalUsers">0</span>
                                        <span class="stat-label">Active Users</span>
                                    </div>
                                </div>
                                
                                <div class="stat-card pulse-animation" style="animation-delay: 0.2s">
                                    <div class="stat-icon">
                                        <i class="fas fa-box"></i>
                                    </div>
                                    <div class="stat-data">
                                        <span class="stat-number" id="totalPosts">0</span>
                                        <span class="stat-label">Live Posts</span>
                                    </div>
                                </div>
                                
                                <div class="stat-card pulse-animation" style="animation-delay: 0.4s">
                                    <div class="stat-icon">
                                        <i class="fas fa-money-bill-wave"></i>
                                    </div>
                                    <div class="stat-data">
                                        <span class="stat-number" id="totalEarnings">KES 0</span>
                                        <span class="stat-label">Paid Out</span>
                                    </div>
                                </div>
                                
                                <div class="stat-card pulse-animation" style="animation-delay: 0.6s">
                                    <div class="stat-icon">
                                        <i class="fas fa-rocket"></i>
                                    </div>
                                    <div class="stat-data">
                                        <span class="stat-number" id="activeTransactions">0</span>
                                        <span class="stat-label">Today</span>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="hero-features">
                                <div class="feature-tag">
                                    <i class="fas fa-check-circle"></i> Free Posts with Subscription
                                </div>
                                <div class="feature-tag">
                                    <i class="fas fa-check-circle"></i> 50% Referral Commission
                                </div>
                                <div class="feature-tag">
                                    <i class="fas fa-check-circle"></i> Business Analytics
                                </div>
                                <div class="feature-tag">
                                    <i class="fas fa-check-circle"></i> M-Pesa Auto/Manual Payments
                                </div>
                            </div>
                        </div>
                        
                        <div class="hero-visual">
                            <div class="floating-card card-1">
                                <div class="card-content">
                                    <div class="card-icon">
                                        <i class="fas fa-shopping-cart"></i>
                                    </div>
                                    <h4>Product Sales</h4>
                                    <p>KES 85,000</p>
                                </div>
                            </div>
                            
                            <div class="floating-card card-2">
                                <div class="card-content">
                                    <div class="card-icon">
                                        <i class="fas fa-briefcase"></i>
                                    </div>
                                    <h4>Job Posted</h4>
                                    <p>Remote Developer</p>
                                </div>
                            </div>
                            
                            <div class="floating-card card-3">
                                <div class="card-content">
                                    <div class="card-icon">
                                        <i class="fas fa-chart-line"></i>
                                    </div>
                                    <h4>Earnings</h4>
                                    <p>KES 25,000+</p>
                                </div>
                            </div>
                            
                            <div class="hero-illustration">
                                <div class="illustration-container">
                                    <div class="phone-mockup">
                                        <div class="phone-screen">
                                            <div class="app-header">
                                                <span>SOKOPLUS</span>
                                            </div>
                                            <div class="app-content">
                                                <div class="app-item">
                                                    <i class="fas fa-box"></i>
                                                    <span>Products</span>
                                                </div>
                                                <div class="app-item active">
                                                    <i class="fas fa-users"></i>
                                                    <span>Social</span>
                                                </div>
                                                <div class="app-item">
                                                    <i class="fas fa-briefcase"></i>
                                                    <span>Jobs</span>
                                                </div>
                                                <div class="app-item">
                                                    <i class="fas fa-concierge-bell"></i>
                                                    <span>Services</span>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="scroll-indicator" onclick="document.querySelector('.trending-section').scrollIntoView({ behavior: 'smooth' })">
                        <span>Explore Marketplace</span>
                        <i class="fas fa-chevron-down"></i>
                    </div>
                </div>
                
                <!-- Recommended for You Section (AI Recommendations) -->
                <div class="recommended-section">
                    <div class="section-header">
                        <h2 class="section-title">Recommended for You</h2>
                        <a href="#" onclick="showPage('marketplace'); return false;" style="color: var(--primary-light);">View All</a>
                    </div>
                    <div class="content-grid grid-3" id="recommendedContent">
                        <!-- Loaded by JavaScript -->
                        <div class="empty-state">
                            <i class="fas fa-magic"></i>
                            <h3>Log in to see recommendations</h3>
                        </div>
                    </div>
                </div>
                      
                <!-- Sponsored Ads Section -->
                <div class="ads-section">
                    <div class="section-header">
                        <h2 class="section-title">Sponsored Ads</h2>
                        <a href="#" onclick="showPage('create-post'); return false;" style="color: var(--primary-light);">Create Ad</a>
                    </div>
                    <div class="ads-grid" id="sponsoredAds">
                        <!-- Ads loaded by JavaScript -->
                        <div class="empty-state">
                            <i class="fas fa-ad"></i>
                            <h3>No Ads Yet</h3>
                            <p>Be the first to advertise here</p>
                        </div>
                    </div>
                </div>
                
                <!-- Featured Shops Section -->
                <div class="shops-section">
                    <div class="section-header">
                        <h2 class="section-title">Featured Shops</h2>
                        <a href="#" onclick="showPage('marketplace'); return false;" style="color: var(--primary-light); text-decoration: none; font-weight: 600;">
                            View All <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                    <div class="shops-grid" id="featuredShops">
                        <!-- Shops loaded by JavaScript -->
                    </div>
                </div>
                
                <!-- Reels Section -->
                <div class="reels-section">
                    <div class="section-header">
                        <h2 class="section-title">Reels</h2>
                        <a href="#" onclick="showPage('reels'); return false;" style="color: var(--primary-light);">View All</a>
                    </div>
                    <div class="reels-grid" id="reelsGrid">
                        <!-- Reels loaded by JavaScript -->
                        <div class="empty-state">
                            <i class="fas fa-video"></i>
                            <h3>No Reels Yet</h3>
                            <p>Upload your first reel and earn KES 10,000 when you reach 1500 views and 360 monthly referrals!</p>
                        </div>
                    </div>
                </div>
                       
                <!-- Trending Categories -->
                <div class="trending-section">
                    <div class="section-header">
                        <h2 class="section-title">Trending Categories</h2>
                        <a href="#" onclick="showPage('marketplace'); return false;" style="color: var(--primary-light); text-decoration: none; font-weight: 600;">
                            View All <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                    <div class="trending-grid">
                        <div class="trending-item" onclick="filterMarketplace('electronics')">
                            <div class="trending-icon blue">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <div>
                                <h4 style="color: var(--white);">Electronics</h4>
                                <p style="color: var(--light-gray); font-size: 0.875rem;">Phones, Laptops, Gadgets</p>
                            </div>
                        </div>
                        
                        <div class="trending-item" onclick="filterMarketplace('fashion')">
                            <div class="trending-icon purple">
                                <i class="fas fa-tshirt"></i>
                            </div>
                            <div>
                                <h4 style="color: var(--white);">Fashion</h4>
                                <p style="color: var(--light-gray); font-size: 0.875rem;">Clothes, Shoes, Accessories</p>
                            </div>
                        </div>
                        
                        <div class="trending-item" onclick="filterMarketplace('vehicles')">
                            <div class="trending-icon orange">
                                <i class="fas fa-car"></i>
                            </div>
                            <div>
                                <h4 style="color: var(--white);">Vehicles</h4>
                                <p style="color: var(--light-gray); font-size: 0.875rem;">Cars, Bikes, Parts</p>
                            </div>
                        </div>
                        
                        <div class="trending-item" onclick="filterMarketplace('real-estate')">
                            <div class="trending-icon blue">
                                <i class="fas fa-home"></i>
                            </div>
                            <div>
                                <h4 style="color: var(--white);">Real Estate</h4>
                                <p style="color: var(--light-gray); font-size: 0.875rem;">Houses, Plots, Rentals</p>
                            </div>
                        </div>
                        <div class="trending-item" onclick="filterMarketplace('digital')">
                            <div class="trending-icon purple">
                                <i class="fas fa-book"></i>
                            </div>
                            <div>
                                <h4 style="color: var(--white);">Digital Products</h4>
                                <p style="color: var(--light-gray); font-size: 0.875rem;">Ebooks, Templates, Lessons</p>
                            </div>
                        </div>
                        <div class="trending-item" onclick="filterMarketplace('lessons')">
                            <div class="trending-icon orange">
                                <i class="fas fa-chalkboard-teacher"></i>
                            </div>
                            <div>
                                <h4 style="color: var(--white);">Online Lessons</h4>
                                <p style="color: var(--light-gray); font-size: 0.875rem;">Courses, Tutorials</p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- New Members Section (recently joined users) -->
                <div class="members-section">
                    <div class="section-header">
                        <h2 class="section-title">New Members</h2>
                        <a href="#" onclick="showPage('marketplace'); return false;" style="color: var(--primary-light); text-decoration: none; font-weight: 600;">
                            View All <i class="fas fa-arrow-right"></i>
                        </a>
                    </div>
                    <div class="members-grid" id="recentMembers">
                        <!-- Recent users loaded by JavaScript -->
                    </div>
                </div>
        
                <!-- NEW: Payment Methods Section (Homepage) -->
                <div class="business-tools-section">
                    <div class="section-header">
                        <h2 class="section-title">Easy Payments</h2>
                        <p style="color: var(--light-gray); max-width: 500px;">Choose between automatic M-Pesa STK Push or manual Paybill payments</p>
                    </div>
                    <div class="payment-methods">
                        <div class="payment-method" onclick="selectPaymentMethod('automatic')" id="homeAutomaticPayment">
                            <div class="payment-method-header">
                                <div class="payment-method-icon">
                                    <i class="fas fa-bolt"></i>
                                </div>
                                <div>
                                    <h3 style="color: var(--white);">Automatic Payment</h3>
                                    <p style="color: var(--light-gray);">M-Pesa STK Push</p>
                                </div>
                            </div>
                            <p style="color: var(--light-gray); margin-bottom: 1rem;">
                                Instant payment via M-Pesa STK Push. Enter your PIN on your phone to complete payment.
                            </p>
                            <div class="payment-method-features">
                                <div class="payment-method-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Instant confirmation</span>
                                </div>
                                <div class="payment-method-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>No transaction codes needed</span>
                                </div>
                                <div class="payment-method-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Secure PIN entry on your phone</span>
                                </div>
                                <div class="payment-method-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Automatic approval</span>
                                </div>
                            </div>
                            <div class="payment-status success" style="margin-top: 1rem;">
                                <i class="fas fa-bolt"></i>
                                <span>Recommended</span>
                            </div>
                        </div>
                        
                        <div class="payment-method" onclick="selectPaymentMethod('manual')" id="homeManualPayment">
                            <div class="payment-method-header">
                                <div class="payment-method-icon">
                                    <i class="fas fa-mobile-alt"></i>
                                </div>
                                <div>
                                    <h3 style="color: var(--white);">Manual Payment</h3>
                                    <p style="color: var(--light-gray);">Paybill</p>
                                </div>
                            </div>
                            <p style="color: var(--light-gray); margin-bottom: 1rem;">
                                Manual payment via M-Pesa Paybill. Send money then enter the transaction code for verification.
                            </p>
                            <div class="payment-method-features">
                                <div class="payment-method-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Familiar Paybill process</span>
                                </div>
                                <div class="payment-method-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>No app installation needed</span>
                                </div>
                                <div class="payment-method-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Works on all phones</span>
                                </div>
                                <div class="payment-method-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Admin approval required</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
           
                
                <!-- How It Works -->
                <div class="mb-3">
                    <div class="section-header">
                        <h2 class="section-title">How SOKOPLUS Works</h2>
                    </div>
                    <div class="features-grid">
                        <div class="feature-card">
                            <div class="feature-icon primary">
                                <i class="fas fa-user-plus"></i>
                            </div>
                            <h3>Subscribe (KES 50/week or KES 200/month)</h3>
                            <p>Weekly subscription gives you unlimited free posts. Businesses can subscribe for KES 100/week or KES 400/month.</p>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon secondary">
                                <i class="fas fa-upload"></i>
                            </div>
                            <h3>Post for Free</h3>
                            <p>Upload products, jobs, proposals, or social posts with images/videos. No additional fees for subscribers.</p>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon accent">
                                <i class="fas fa-rocket"></i>
                            </div>
                            <h3>Boost Posts (KES 100)</h3>
                            <p>Pay KES 100 to boost your posts for maximum visibility. Featured in premium section for 7 days.</p>
                        </div>
                        
                        <div class="feature-card">
                            <div class="feature-icon primary">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h3>Business Analytics</h3>
                            <p>Track post performance, views, and engagement. Get insights to optimize your listings and reach.</p>
                        </div>
                        
                        <!-- New feature: Advertise -->
                        <div class="feature-card">
                            <div class="feature-icon orange">
                                <i class="fas fa-ad"></i>
                            </div>
                            <h3>Advertise (KES 299/week)</h3>
                            <p>Create eye-catching ads on our homepage. Reach thousands of users daily. Admins can add offers.</p>
                        </div>

                        <div class="feature-card">
                            <div class="feature-icon orange">
                                <i class="fas fa-file-alt"></i>
                            </div>
                            <h3>Proposals</h3>
                            <p>Upload business proposals and get contacted by potential partners.</p>
                        </div>
                        <!-- New feature: Digital Products -->
                        <div class="feature-card">
                            <div class="feature-icon primary">
                                <i class="fas fa-book"></i>
                            </div>
                            <h3>Sell Digital Products</h3>
                            <p>Ebooks, templates, canvas, online lessons. Buy using referral balance or deposit.</p>
                        </div>
                        <!-- New feature: Resell -->
                        <div class="feature-card">
                            <div class="feature-icon secondary">
                                <i class="fas fa-hand-holding-usd"></i>
                            </div>
                            <h3>Resell Products</h3>
                            <p>Resell any product and earn commission on every sale through your unique link.</p>
                        </div>
                    </div>
                </div>
                
                <!-- Business Tools Section -->
                <div class="business-tools-section">
                    <div class="section-header">
                        <h2 class="section-title">Business Tools</h2>
                        <p style="color: var(--light-gray); max-width: 500px;">Advanced tools to help you grow your business and maximize earnings</p>
                    </div>
                    <div class="tools-grid">
                        <div class="tool-card" onclick="showPage('dashboard')">
                            <div class="tool-icon">
                                <i class="fas fa-chart-bar"></i>
                            </div>
                            <h3>Analytics Dashboard</h3>
                            <p>Track post performance, views, and engagement metrics</p>
                        </div>
                        
                        <div class="tool-card" onclick="showBusinessModal('bulkUpload')">
                            <div class="tool-icon">
                                <i class="fas fa-file-upload"></i>
                            </div>
                            <h3>Bulk Upload</h3>
                            <p>Upload multiple products at once with CSV/Excel</p>
                        </div>
                        
                        <div class="tool-card" onclick="showBusinessModal('inventory')">
                            <div class="tool-icon">
                                <i class="fas fa-boxes"></i>
                            </div>
                            <h3>Inventory Management</h3>
                            <p>Track stock levels and receive low stock alerts</p>
                        </div>
                        
                        <div class="tool-card" onclick="showBusinessModal('scheduler')">
                            <div class="tool-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <h3>Post Scheduler</h3>
                            <p>Schedule posts for optimal times automatically</p>
                        </div>
                        
                        <div class="tool-card" onclick="showBusinessModal('marketing')">
                            <div class="tool-icon">
                                <i class="fas fa-bullhorn"></i>
                            </div>
                            <h3>Marketing Tools</h3>
                            <p>Create campaigns and track conversion rates</p>
                        </div>
                        
                        <div class="tool-card" onclick="showBusinessModal('reports')">
                            <div class="tool-icon">
                                <i class="fas fa-file-invoice-dollar"></i>
                            </div>
                            <h3>Sales Reports</h3>
                            <p>Generate detailed sales and earnings reports</p>
                        </div>

                        <div class="tool-card" onclick="showBusinessModal('calculator')">
                            <div class="tool-icon">
                                <i class="fas fa-calculator"></i>
                            </div>
                            <h3>Business Calculator</h3>
                            <p>Calculate profits, revenue, and costs</p>
                        </div>
                    </div>
                </div>
                
                <!-- Testimonials -->
                <div class="testimonials-section">
                    <div class="section-header">
                        <h2 class="section-title">Success Stories</h2>
                    </div>
                    <div class="testimonials-slider">
                        <div class="testimonial-card">
                            <div class="testimonial-content">
                                <p>"SOKOPLUS helped me grow my clothing business by 300% in 3 months. The automatic payment feature made subscription so easy!"</p>
                            </div>
                            <div class="testimonial-author">
                                <div class="user-avatar-sm">S</div>
                                <div>
                                    <h4 style="color: var(--white);">Sarah Wanjiru</h4>
                                    <p style="color: var(--light-gray); font-size: 0.875rem;">Fashion Entrepreneur</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="testimonial-card">
                            <div class="testimonial-content">
                                <p>"As a freelance developer, I found 5 clients through SOKOPLUS in one week. The automatic M-Pesa payment is a game-changer!"</p>
                            </div>
                            <div class="testimonial-author">
                                <div class="user-avatar-sm">J</div>
                                <div>
                                    <h4 style="color: var(--white);">John Maina</h4>
                                    <p style="color: var(--light-gray); font-size: 0.875rem;">Software Developer</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="testimonial-card">
                            <div class="testimonial-content">
                                <p>"The business tools helped me manage my inventory and boost sales. Automatic payments save me so much time!"</p>
                            </div>
                            <div class="testimonial-author">
                                <div class="user-avatar-sm">M</div>
                                <div>
                                    <h4 style="color: var(--white);">Mary Atieno</h4>
                                    <p style="color: var(--light-gray); font-size: 0.875rem;">Electronics Retailer</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Content Tabs -->
                <div class="content-tabs" id="homeContentTabs">
                    <button class="tab-btn active" onclick="showHomeTab('featured')">
                        <i class="fas fa-star"></i> Featured
                    </button>
                    <button class="tab-btn" onclick="showHomeTab('products')">
                        <i class="fas fa-box"></i> Products
                    </button>
                    <button class="tab-btn" onclick="showHomeTab('digital')">
                        <i class="fas fa-book"></i> Digital
                    </button>
                    <button class="tab-btn" onclick="showHomeTab('lessons')">
                        <i class="fas fa-chalkboard-teacher"></i> Lessons
                    </button>
                    <button class="tab-btn" onclick="showHomeTab('social')">
                        <i class="fas fa-users"></i> Social
                    </button>
                    <button class="tab-btn" onclick="showHomeTab('jobs')">
                        <i class="fas fa-briefcase"></i> Jobs
                    </button>
                    <button class="tab-btn" onclick="showHomeTab('boosted')">
                        <i class="fas fa-rocket"></i> Boosted
                    </button>
                    <button class="tab-btn" onclick="showHomeTab('proposals')">
                        <i class="fas fa-file-alt"></i> Proposals
                    </button>
                </div>
                
                <!-- Content Areas -->
                <div id="featuredTab" class="content-tab">
                    <div class="content-grid grid-3" id="featuredContent">
                        <!-- Featured content loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="productsTab" class="content-tab" style="display: none;">
                    <div class="content-grid grid-3" id="featuredProducts">
                        <!-- Products loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="digitalTab" class="content-tab" style="display: none;">
                    <div class="content-grid grid-3" id="featuredDigital">
                        <!-- Digital products loaded by JavaScript -->
                    </div>
                </div>

                <div id="lessonsTab" class="content-tab" style="display: none;">
                    <div class="content-grid grid-3" id="featuredLessons">
                        <!-- Lessons loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="socialTab" class="content-tab" style="display: none;">
                    <div class="content-grid grid-2" id="featuredSocial">
                        <!-- Social posts loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="jobsTab" class="content-tab" style="display: none;">
                    <div class="content-grid grid-3" id="featuredJobs">
                        <!-- Jobs loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="boostedTab" class="content-tab" style="display: none;">
                    <div class="content-grid grid-3" id="featuredBoosted">
                        <!-- Boosted content loaded by JavaScript -->
                    </div>
                </div>

                <div id="proposalsTab" class="content-tab" style="display: none;">
                    <div class="content-grid grid-3" id="featuredProposals">
                        <!-- Proposals loaded by JavaScript -->
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Marketplace -->
        <section id="marketplace" class="page">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Marketplace</h2>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <input type="text" id="marketplaceSearch" class="form-control" placeholder="Search posts..." style="min-width: 200px;">
                        <select id="marketplaceCategory" class="form-control">
                            <option value="">All Categories</option>
                            <option value="electronics">Electronics</option>
                            <option value="fashion">Fashion</option>
                            <option value="vehicles">Vehicles</option>
                            <option value="real-estate">Real Estate</option>
                            <option value="home">Home & Garden</option>
                            <option value="services">Services</option>
                            <option value="social">Social Posts</option>
                            <option value="jobs">Jobs</option>
                            <option value="ads">Ads</option>
                            <option value="proposals">Proposals</option>
                            <!-- New categories -->
                            <option value="templates">Templates</option>
                            <option value="ebooks">Ebooks</option>
                            <option value="online-lessons">Online Lessons</option>
                            <option value="designs">Designs</option>
                            <option value="animals">Animals</option>
                            <option value="foods">Foods</option>
                            <option value="digital">Digital Products</option>
                            <option value="lessons">Lessons</option>
                        </select>
                        <select id="marketplaceSort" class="form-control">
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                            <option value="price-low">Price: Low to High</option>
                            <option value="price-high">Price: High to Low</option>
                            <option value="boosted">Boosted First</option>
                            <option value="popular">Most Viewed</option>
                        </select>
                        <button class="btn btn-primary" onclick="loadMarketplace()">
                            <i class="fas fa-search"></i>
                        </button>
                    </div>
                </div>
                
                <div class="content-grid grid-3" id="marketplaceContent">
                    <!-- Marketplace content loaded by JavaScript -->
                </div>
                
                <div id="marketplacePagination" style="display: flex; justify-content: center; gap: 0.5rem; margin-top: 2rem;"></div>
            </div>
        </section>
        
        <!-- Create Post -->
        <section id="create-post" class="page">
            <div class="container">
                <div class="form-container">
                    <div class="form-card">
                        <h2 class="form-title">Create New Post</h2>
                        <p class="text-center mb-3" style="color: var(--light-gray);">Free posting for subscribed users (except ads)</p>
                        
                        <!-- Post Type Tabs -->
                        <div class="post-creation-tabs">
                            <div class="post-tab active" onclick="showPostForm('product')">
                                <i class="fas fa-box"></i>
                                <span>Product</span>
                            </div>
                            <div class="post-tab" onclick="showPostForm('digital')">
                                <i class="fas fa-book"></i>
                                <span>Digital Product</span>
                            </div>
                            <div class="post-tab" onclick="showPostForm('lesson')">
                                <i class="fas fa-chalkboard-teacher"></i>
                                <span>Online Lesson</span>
                            </div>
                            <div class="post-tab" onclick="showPostForm('social')">
                                <i class="fas fa-users"></i>
                                <span>Social Post</span>
                            </div>
                            <div class="post-tab" onclick="showPostForm('job')">
                                <i class="fas fa-briefcase"></i>
                                <span>Job Listing</span>
                            </div>
                            <div class="post-tab" onclick="showPostForm('service')">
                                <i class="fas fa-concierge-bell"></i>
                                <span>Service</span>
                            </div>
                            <div class="post-tab" onclick="showPostForm('cv')">
                                <i class="fas fa-file-alt"></i>
                                <span>Upload CV</span>
                            </div>
                            <div class="post-tab" onclick="showPostForm('ad')">
                                <i class="fas fa-ad"></i>
                                <span>Ad (KES 299/week)</span>
                            </div>
                            <div class="post-tab" onclick="showPostForm('proposal')">
                                <i class="fas fa-file-pdf"></i>
                                <span>Proposal</span>
                            </div>
                            <!-- New Reel tab -->
                            <div class="post-tab" onclick="showPostForm('reel')">
                                <i class="fas fa-video"></i>
                                <span>Reel</span>
                            </div>
                        </div>
                        
                        <!-- Product Form -->
                        <form id="productForm" class="post-form active">
                            <div class="form-group">
                                <label class="form-label">Product Title *</label>
                                <input type="text" class="form-control" id="productTitle" placeholder="e.g., iPhone 13 Pro Max 256GB" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Description *</label>
                                <textarea class="form-control form-textarea" id="productDescription" placeholder="Describe your product in detail..." required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Product Images/Videos</label>
                                <div class="upload-area" onclick="document.getElementById('productMedia').click()">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Click to upload images/videos</p>
                                    <small style="color: var(--light-gray);">Max 10 files, 10MB each</small>
                                </div>
                                <input type="file" id="productMedia" accept="image/*,video/*" multiple style="display: none;" onchange="previewMedia('productMedia', 'productMediaPreview')">
                                <div id="productMediaPreview" class="media-preview-container"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Price (KES) *</label>
                                <input type="number" class="form-control" id="productPrice" placeholder="e.g., 85000" min="1" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Category *</label>
                                <select class="form-control" id="productCategory" required>
                                    <option value="">Select Category</option>
                                    <option value="electronics">Electronics</option>
                                    <option value="fashion">Fashion</option>
                                    <option value="home">Home & Garden</option>
                                    <option value="vehicles">Vehicles</option>
                                    <option value="real-estate">Real Estate</option>
                                    <option value="services">Services</option>
                                    <!-- New categories -->
                                    <option value="templates">Templates</option>
                                    <option value="ebooks">Ebooks</option>
                                    <option value="online-lessons">Online Lessons</option>
                                    <option value="designs">Designs</option>
                                    <option value="animals">Animals</option>
                                    <option value="foods">Foods</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Location *</label>
                                <input type="text" class="form-control" id="productLocation" placeholder="e.g., Nairobi, Mombasa" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Contact WhatsApp *</label>
                                <input type="text" class="form-control" id="productWhatsapp" placeholder="2547XXXXXXXX" pattern="^2547\d{8}$" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Countdown (Optional)</label>
                                <input type="datetime-local" class="form-control" id="productCountdown">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="boostProduct" style="margin-right: 0.5rem;">
                                    Boost this post for KES 100 (Increased visibility)
                                </label>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Schedule Post (Optional)</label>
                                <input type="datetime-local" class="form-control" id="productSchedule">
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-full btn-lg">
                                <i class="fas fa-plus-circle"></i> Post Product
                            </button>
                        </form>
                        
                        <!-- Digital Product Form -->
                        <form id="digitalForm" class="post-form">
                            <div class="form-group">
                                <label class="form-label">Product Title *</label>
                                <input type="text" class="form-control" id="digitalTitle" placeholder="e.g., Professional Resume Template" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Description *</label>
                                <textarea class="form-control form-textarea" id="digitalDescription" placeholder="Describe your digital product..." required></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Price (KES) *</label>
                                <input type="number" class="form-control" id="digitalPrice" placeholder="e.g., 500" min="1" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Category *</label>
                                <select class="form-control" id="digitalCategory" required>
                                    <option value="">Select Category</option>
                                    <option value="ebooks">Ebook</option>
                                    <option value="templates">Template</option>
                                    <option value="online-lessons">Online Lesson</option>
                                    <option value="designs">Design</option>
                                    <option value="canvas">Canvas</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Cover Image</label>
                                <div class="upload-area" onclick="document.getElementById('digitalCover').click()">
                                    <i class="fas fa-image"></i>
                                    <p>Click to upload cover image</p>
                                    <small style="color: var(--light-gray);">Max 5MB</small>
                                </div>
                                <input type="file" id="digitalCover" accept="image/*" style="display: none;" onchange="previewDigitalCover()">
                                <div id="digitalCoverPreview" class="media-preview-container mt-2"></div>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Digital File *</label>
                                <div class="upload-area" onclick="document.getElementById('digitalFile').click()">
                                    <i class="fas fa-file"></i>
                                    <p>Click to upload file (PDF, ZIP, etc.)</p>
                                    <small style="color: var(--light-gray);">Max 50MB</small>
                                </div>
                                <input type="file" id="digitalFile" style="display: none;" onchange="previewDigitalFile()">
                                <div id="digitalFilePreview" class="mt-2"></div>
                            </div>
                            <button type="submit" class="btn btn-primary w-full btn-lg">
                                <i class="fas fa-upload"></i> Sell Digital Product
                            </button>
                        </form>
                        
                        <!-- Online Lesson Form -->
                        <form id="lessonForm" class="post-form">
                            <div class="form-group">
                                <label class="form-label">Lesson Title *</label>
                                <input type="text" class="form-control" id="lessonTitle" placeholder="e.g., Python Programming for Beginners" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Description *</label>
                                <textarea class="form-control form-textarea" id="lessonDescription" placeholder="Describe your lesson or course..." required></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Price (KES) *</label>
                                <input type="number" class="form-control" id="lessonPrice" placeholder="e.g., 1500" min="1" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Lesson Type</label>
                                <select class="form-control" id="lessonType" onchange="toggleLessonType()">
                                    <option value="single">Single Video</option>
                                    <option value="playlist">Playlist (Multiple Videos)</option>
                                </select>
                            </div>
                            <div class="form-group" id="lessonThumbnailGroup">
                                <label class="form-label">Thumbnail Image *</label>
                                <div class="upload-area" onclick="document.getElementById('lessonThumbnail').click()">
                                    <i class="fas fa-image"></i>
                                    <p>Click to upload thumbnail</p>
                                    <small style="color: var(--light-gray);">Max 5MB</small>
                                </div>
                                <input type="file" id="lessonThumbnail" accept="image/*" style="display: none;" onchange="previewLessonThumbnail()">
                                <div id="lessonThumbnailPreview" class="media-preview-container mt-2"></div>
                            </div>
                            <div class="form-group" id="lessonVideoGroup">
                                <label class="form-label">Lesson Video *</label>
                                <div class="upload-area" onclick="document.getElementById('lessonVideo').click()">
                                    <i class="fas fa-video"></i>
                                    <p>Click to upload video (MP4, max 500MB)</p>
                                    <small style="color: var(--light-gray);">For single video</small>
                                </div>
                                <input type="file" id="lessonVideo" accept="video/*" style="display: none;" onchange="previewLessonVideo()">
                                <div id="lessonVideoPreview" class="media-preview-container mt-2"></div>
                            </div>
                            <div class="form-group" id="lessonPlaylistGroup" style="display: none;">
                                <label class="form-label">Playlist Videos *</label>
                                <div class="upload-area" onclick="document.getElementById('lessonPlaylist').click()">
                                    <i class="fas fa-list"></i>
                                    <p>Click to upload multiple videos (MP4, max 500MB each)</p>
                                    <small style="color: var(--light-gray);">You can select multiple files</small>
                                </div>
                                <input type="file" id="lessonPlaylist" accept="video/*" multiple style="display: none;" onchange="previewLessonPlaylist()">
                                <div id="lessonPlaylistPreview" class="media-preview-container"></div>
                            </div>
                            <button type="submit" class="btn btn-primary w-full btn-lg">
                                <i class="fas fa-upload"></i> Create Lesson
                            </button>
                        </form>
                        
                        <!-- Social Post Form -->
                        <form id="socialForm" class="post-form">
                            <div class="form-group">
                                <label class="form-label">What's on your mind? *</label>
                                <textarea class="form-control form-textarea" id="socialContent" placeholder="Share your thoughts, updates, or announcements..." rows="6" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Add Images/Videos</label>
                                <div class="upload-area" onclick="document.getElementById('socialMedia').click()">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Click to upload images/videos</p>
                                    <small style="color: var(--light-gray);">Max 10 files, 10MB each</small>
                                </div>
                                <input type="file" id="socialMedia" accept="image/*,video/*" multiple style="display: none;" onchange="previewMedia('socialMedia', 'socialMediaPreview')">
                                <div id="socialMediaPreview" class="media-preview-container"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Post Type</label>
                                <select class="form-control" id="socialType">
                                    <option value="general">General</option>
                                    <option value="announcement">Announcement</option>
                                    <option value="promotion">Promotion</option>
                                    <option value="question">Question</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="boostSocial" style="margin-right: 0.5rem;">
                                    Boost this post for KES 100 (Reach more people)
                                </label>
                            </div>
                            
                            <button type="submit" class="btn btn-secondary w-full btn-lg">
                                <i class="fas fa-share"></i> Share Post
                            </button>
                        </form>
                        
                        <!-- Job Form -->
                        <form id="jobForm" class="post-form">
                            <div class="form-group">
                                <label class="form-label">Job Title *</label>
                                <input type="text" class="form-control" id="jobTitle" placeholder="e.g., Software Developer, Sales Manager" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Company/Organization *</label>
                                <input type="text" class="form-control" id="jobCompany" placeholder="Your company name" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Job Description *</label>
                                <textarea class="form-control form-textarea" id="jobDescription" placeholder="Describe the job responsibilities, requirements..." required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Job Type *</label>
                                <select class="form-control" id="jobType" required>
                                    <option value="">Select Type</option>
                                    <option value="full-time">Full Time</option>
                                    <option value="part-time">Part Time</option>
                                    <option value="contract">Contract</option>
                                    <option value="internship">Internship</option>
                                    <option value="remote">Remote</option>
                                    <option value="hybrid">Hybrid</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Salary Range (KES) *</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <input type="number" class="form-control" id="jobSalaryMin" placeholder="Minimum" required>
                                    <input type="number" class="form-control" id="jobSalaryMax" placeholder="Maximum" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Location *</label>
                                <input type="text" class="form-control" id="jobLocation" placeholder="e.g., Nairobi, Remote, Hybrid" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Contact WhatsApp *</label>
                                <input type="text" class="form-control" id="jobWhatsapp" placeholder="2547XXXXXXXX" pattern="^2547\d{8}$" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Application Email/URL *</label>
                                <input type="text" class="form-control" id="jobApply" placeholder="Email or application link" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Company Images/Videos (Optional)</label>
                                <div class="upload-area" onclick="document.getElementById('jobMedia').click()">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Upload company/office images</p>
                                    <small style="color: var(--light-gray);">Max 5 files, 10MB each</small>
                                </div>
                                <input type="file" id="jobMedia" accept="image/*,video/*" multiple style="display: none;" onchange="previewMedia('jobMedia', 'jobMediaPreview')">
                                <div id="jobMediaPreview" class="media-preview-container"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">
                                    <input type="checkbox" id="boostJob" style="margin-right: 0.5rem;">
                                    Boost this job post for KES 100 (Get more applicants)
                                </label>
                            </div>
                            
                            <button type="submit" class="btn btn-accent w-full btn-lg">
                                <i class="fas fa-briefcase"></i> Post Job
                            </button>
                        </form>
                        
                        <!-- Service Form -->
                        <form id="serviceForm" class="post-form">
                            <div class="form-group">
                                <label class="form-label">Service Title *</label>
                                <input type="text" class="form-control" id="serviceTitle" placeholder="e.g., Web Development, Plumbing, Photography" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Service Description *</label>
                                <textarea class="form-control form-textarea" id="serviceDescription" placeholder="Describe your service in detail..." required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Service Category *</label>
                                <select class="form-control" id="serviceCategory" required>
                                    <option value="">Select Category</option>
                                    <option value="it">IT & Tech</option>
                                    <option value="creative">Creative</option>
                                    <option value="professional">Professional</option>
                                    <option value="home">Home Services</option>
                                    <option value="health">Health & Wellness</option>
                                    <option value="education">Education</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Price Range (KES) *</label>
                                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1rem;">
                                    <input type="number" class="form-control" id="servicePriceMin" placeholder="Minimum" required>
                                    <input type="number" class="form-control" id="servicePriceMax" placeholder="Maximum" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Location *</label>
                                <input type="text" class="form-control" id="serviceLocation" placeholder="e.g., Nairobi, Remote, On-site" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Contact WhatsApp *</label>
                                <input type="text" class="form-control" id="serviceWhatsapp" placeholder="2547XXXXXXXX" pattern="^2547\d{8}$" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Portfolio Images/Videos</label>
                                <div class="upload-area" onclick="document.getElementById('serviceMedia').click()">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Upload portfolio/work samples</p>
                                    <small style="color: var(--light-gray);">Max 8 files, 10MB each</small>
                                </div>
                                <input type="file" id="serviceMedia" accept="image/*,video/*" multiple style="display: none;" onchange="previewMedia('serviceMedia', 'serviceMediaPreview')">
                                <div id="serviceMediaPreview" class="media-preview-container"></div>
                            </div>
                            
                            <button type="submit" class="btn btn-business w-full btn-lg">
                                <i class="fas fa-concierge-bell"></i> List Service
                            </button>
                        </form>
                        
                        <!-- CV Form -->
                        <form id="cvForm" class="post-form">
                            <div class="form-group">
                                <label class="form-label">CV Title *</label>
                                <input type="text" class="form-control" id="cvTitle" placeholder="e.g., Senior Software Developer CV" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Professional Summary</label>
                                <textarea class="form-control form-textarea" id="cvSummary" placeholder="Briefly describe your skills, experience, and career goals..." rows="4"></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">CV File *</label>
                                <div class="upload-area" onclick="document.getElementById('cvFile').click()">
                                    <i class="fas fa-file-pdf"></i>
                                    <p>Click to upload CV (PDF/DOC/DOCX)</p>
                                    <small style="color: var(--light-gray);">Max 5MB, PDF, DOC, DOCX formats</small>
                                </div>
                                <input type="file" id="cvFile" accept=".pdf,.doc,.docx" style="display: none;" onchange="previewCV()">
                                <div id="cvPreview" class="cv-preview mt-2">
                                    <i class="fas fa-file-alt"></i>
                                    <p>CV Preview will appear here</p>
                                    <small style="color: var(--light-gray);">Upload your CV to see preview</small>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Skills (comma separated)</label>
                                <input type="text" class="form-control" id="cvSkills" placeholder="e.g., JavaScript, React, Node.js, Python">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Experience Level</label>
                                <select class="form-control" id="cvExperience">
                                    <option value="">Select Level</option>
                                    <option value="entry">Entry Level (0-2 years)</option>
                                    <option value="mid">Mid Level (2-5 years)</option>
                                    <option value="senior">Senior (5+ years)</option>
                                    <option value="executive">Executive</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Expected Salary (KES)</label>
                                <input type="number" class="form-control" id="cvSalary" placeholder="e.g., 150000">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Location</label>
                                <input type="text" class="form-control" id="cvLocation" placeholder="e.g., Nairobi, Remote">
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-full btn-lg">
                                <i class="fas fa-upload"></i> Upload CV
                            </button>
                        </form>
                        
                        <!-- Ad Form -->
                        <form id="adForm" class="post-form">
                            <div class="form-group">
                                <label class="form-label">Ad Title *</label>
                                <input type="text" class="form-control" id="adTitle" placeholder="e.g., Big Sale at Super Store" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Ad Description *</label>
                                <textarea class="form-control form-textarea" id="adDescription" placeholder="Describe your ad..." rows="4" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Contact WhatsApp *</label>
                                <input type="text" class="form-control" id="adWhatsapp" placeholder="2547XXXXXXXX" pattern="^2547\d{8}$" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Ad Media (Images/Videos)</label>
                                <div class="upload-area" onclick="document.getElementById('adMedia').click()">
                                    <i class="fas fa-image"></i>
                                    <p>Click to upload images/videos</p>
                                    <small style="color: var(--light-gray);">Max 5 files, 10MB each</small>
                                </div>
                                <input type="file" id="adMedia" accept="image/*,video/*" multiple style="display: none;" onchange="previewMedia('adMedia', 'adMediaPreview')">
                                <div id="adMediaPreview" class="media-preview-container"></div>
                            </div>

                            <!-- Admin only: Offer details (shown only if user is admin) -->
                            <div id="adminOfferFields" style="display: none;">
                                <div class="form-group">
                                    <label class="form-label">Offer Title (Admin)</label>
                                    <input type="text" class="form-control" id="adOfferTitle">
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Offer Description</label>
                                    <textarea class="form-control form-textarea" id="adOfferDesc" rows="2"></textarea>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Target URL *</label>
                                <input type="url" class="form-control" id="adUrl" placeholder="https://your-website.com" required>
                                <small style="color: var(--light-gray);">Where users will go when they click the ad</small>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Duration *</label>
                                <select class="form-control" id="adDuration" required>
                                    <option value="1">1 week (KES 299)</option>
                                    <option value="2">2 weeks (KES 598)</option>
                                    <option value="4">1 month (KES 1,196)</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Payment Method</label>
                                <div class="payment-options">
                                    <div class="payment-option selected" onclick="selectAdPaymentMethod('auto')" id="adAutoPayment">
                                        <div class="payment-option-header">
                                            <i class="fas fa-bolt payment-option-icon"></i>
                                            <div>
                                                <h4>Automatic (Instant)</h4>
                                                <small>M-Pesa STK Push</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="payment-option" onclick="selectAdPaymentMethod('manual')" id="adManualPayment">
                                        <div class="payment-option-header">
                                            <i class="fas fa-mobile-alt payment-option-icon"></i>
                                            <div>
                                                <h4>Manual</h4>
                                                <small>Paybill + Transaction Code</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div id="adManualPaymentFields" style="display: none;">
                                <div class="payment-details">
                                    <div class="payment-detail">
                                        <span>Paybill</span>
                                        <span class="payment-detail-value">222111</span>
                                    </div>
                                    <div class="payment-detail">
                                        <span>Account</span>
                                        <span class="payment-detail-value">5414200</span>
                                    </div>
                                    <div class="payment-detail">
                                        <span>Amount</span>
                                        <span class="payment-detail-value amount" id="adTotalAmount">KES 299</span>
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label class="form-label">Transaction Code *</label>
                                    <input type="text" class="form-control" id="adTransactionCode" placeholder="e.g., RGT6X9B5P2">
                                </div>
                            </div>
                            
                            <button type="submit" class="btn btn-orange w-full btn-lg">
                                <i class="fas fa-ad"></i> Create Ad (KES <span id="adSubmitAmount">299</span>)
                            </button>
                        </form>

                        <!-- Proposal Form -->
                        <form id="proposalForm" class="post-form">
                            <div class="form-group">
                                <label class="form-label">Proposal Title *</label>
                                <input type="text" class="form-control" id="proposalTitle" placeholder="e.g., Business Partnership Proposal" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Description *</label>
                                <textarea class="form-control form-textarea" id="proposalDesc" placeholder="Describe your proposal..." rows="5" required></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Budget (KES)</label>
                                <input type="number" class="form-control" id="proposalBudget" placeholder="e.g., 50000">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Proposal File (PDF/DOC)</label>
                                <div class="upload-area" onclick="document.getElementById('proposalFile').click()">
                                    <i class="fas fa-file-pdf"></i>
                                    <p>Click to upload proposal file</p>
                                    <small style="color: var(--light-gray);">Max 10MB, PDF, DOC, DOCX</small>
                                </div>
                                <input type="file" id="proposalFile" accept=".pdf,.doc,.docx" style="display: none;" onchange="previewProposalFile()">
                                <div id="proposalFilePreview" class="cv-preview mt-2" style="height: auto; padding: 1rem;"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Contact WhatsApp</label>
                                <input type="text" class="form-control" id="proposalWhatsapp" placeholder="2547XXXXXXXX">
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-full btn-lg">
                                <i class="fas fa-upload"></i> Submit Proposal
                            </button>
                        </form>

                        <!-- Reel Form -->
                        <form id="reelForm" class="post-form">
                            <div class="form-group">
                                <label class="form-label">Reel Title *</label>
                                <input type="text" class="form-control" id="reelTitle" placeholder="e.g., My amazing dance" required>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Description</label>
                                <textarea class="form-control form-textarea" id="reelDescription" placeholder="Tell us about your reel..." rows="3"></textarea>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Upload Video *</label>
                                <div class="upload-area" onclick="document.getElementById('reelVideo').click()">
                                    <i class="fas fa-cloud-upload-alt"></i>
                                    <p>Click to upload reel video</p>
                                    <small style="color: var(--light-gray);">MP4, max 50MB</small>
                                </div>
                                <input type="file" id="reelVideo" accept="video/*" style="display: none;" onchange="previewReelVideo()">
                                <div id="reelVideoPreview" class="media-preview-container mt-2"></div>
                            </div>
                            <button type="submit" class="btn btn-primary w-full btn-lg">
                                <i class="fas fa-upload"></i> Upload Reel
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Dashboard - ENHANCED -->
        <section id="dashboard" class="page">
            <div class="container">
                <!-- Dashboard Header -->
                <div class="profile-header">
                    <div class="profile-avatar-lg" id="profileAvatar">
                        <!-- Avatar loaded by JavaScript -->
                    </div>
                    <div class="profile-info">
                        <h3 id="profileName"></h3>
                        <p id="profileEmail"></p>
                        <p id="profilePhone"></p>
                        <div id="profileStatus"></div>
                        <div id="profileAccountType" class="badge badge-info mt-1" style="margin-bottom: 1rem;"></div>
                        <div style="display: flex; gap: 1rem; margin-top: 1rem;">
                            <button class="btn btn-sm btn-outline" onclick="showPage('profile')">
                                <i class="fas fa-user-edit"></i> Edit Profile
                            </button>
                            <button class="btn btn-sm btn-orange" onclick="showBusinessModal('upgrade')">
                                <i class="fas fa-crown"></i> Upgrade
                            </button>
                            <button class="btn btn-sm btn-accent" onclick="showPage('shop')">
                                <i class="fas fa-store"></i> My Shop
                            </button>
                            <!-- 2FA Toggle -->
                            <button class="btn btn-sm btn-primary" onclick="show2FAModal()">
                                <i class="fas fa-lock"></i> 2FA
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Wallet Balance Card -->
                <div class="wallet-card">
                    <div>
                        <span>Your Wallet Balance</span>
                        <div class="wallet-balance" id="walletBalance">KES 0</div>
                    </div>
                    <button class="deposit-btn" onclick="showDepositModal()">Deposit Funds</button>
                </div>
                
                <!-- Referral Progress Section - Updated -->
                <div class="earnings-card" style="margin-bottom: 2rem;">
                    <h4 style="color: white; margin-bottom: 1rem;">Weekly Bonus Milestone</h4>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 1.5rem;">
                        <div>
                            <p>Referrals: <span id="weeklyReferrals">0</span>/20</p>
                            <div style="background: rgba(255,255,255,0.2); height: 8px; border-radius: 4px;">
                                <div id="weeklyProgress" style="width: 0%; background: var(--whatsapp-green); height: 8px; border-radius: 4px;"></div>
                            </div>
                        </div>
                        <div>
                            <p>Referred Boosts: <span id="weeklyBoosts">0</span>/20</p>
                            <div style="background: rgba(255,255,255,0.2); height: 8px; border-radius: 4px;">
                                <div id="weeklyBoostProgress" style="width: 0%; background: var(--jumia-orange); height: 8px; border-radius: 4px;"></div>
                            </div>
                        </div>
                    </div>
                    <p style="margin-top: 1rem;">When you refer 20 people and they each boost at least one post, you earn KES 300!</p>
                </div>

                <!-- Bonus Milestone Card (Reel) -->
                <div class="bonus-card">
                    <h4>🎯 Reel Bonus Milestone</h4>
                    <div class="bonus-progress-container">
                        <div class="bonus-progress-item">
                            <p>Reel Views: <span id="bonusReelViews">0</span>/1500</p>
                            <div class="bonus-progress-bar">
                                <div id="bonusViewsProgress" class="bonus-progress-fill" style="width: 0%;"></div>
                            </div>
                        </div>
                        <div class="bonus-progress-item">
                            <p>Monthly Referrals: <span id="bonusMonthlyReferrals">0</span>/360</p>
                            <div class="bonus-progress-bar">
                                <div id="bonusReferralsProgress" class="bonus-progress-fill referrals" style="width: 0%;"></div>
                            </div>
                        </div>
                    </div>
                    <div id="bonusStatus" style="margin-top: 1rem; font-weight: 600;"></div>
                </div>
                
                <!-- Quick Actions -->
                <div class="quick-actions">
                    <div class="quick-action-btn" onclick="showPage('create-post')">
                        <i class="fas fa-plus-circle"></i>
                        <span>Create Post</span>
                    </div>
                    <div class="quick-action-btn" onclick="showPage('marketplace')">
                        <i class="fas fa-store"></i>
                        <span>Browse Marketplace</span>
                    </div>
                    <div class="quick-action-btn" onclick="showBusinessModal('analytics')">
                        <i class="fas fa-chart-bar"></i>
                        <span>View Analytics</span>
                    </div>
                    <div class="quick-action-btn" onclick="copyReferralLink()">
                        <i class="fas fa-share-alt"></i>
                        <span>Share Referral</span>
                    </div>
                    <div class="quick-action-btn" onclick="showPage('my-cvs')">
                        <i class="fas fa-file-alt"></i>
                        <span>My CVs</span>
                    </div>
                    <div class="quick-action-btn" onclick="showPage('shop')">
                        <i class="fas fa-store-alt"></i>
                        <span>My Shop</span>
                    </div>
                    <div class="quick-action-btn" onclick="showPage('orders')">
                        <i class="fas fa-truck"></i>
                        <span>My Orders</span>
                    </div>
                    <div class="quick-action-btn" onclick="openChat()">
                        <i class="fas fa-comment-dots"></i>
                        <span>Messages</span>
                        <span class="notification-badge" id="chatBadge" data-count="0"></span>
                    </div>
                </div>
                
                <!-- Quick Stats -->
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(24, 119, 242, 0.2); color: var(--primary-light); border: 1px solid rgba(61, 139, 247, 0.3);">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="myProductsCount">0</div>
                            <div>Active Products</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(228, 64, 95, 0.2); color: var(--instagram-pink); border: 1px solid rgba(228, 64, 95, 0.3);">
                            <i class="fas fa-eye"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="totalViews">0</div>
                            <div>Total Views</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(138, 58, 185, 0.2); color: var(--instagram-purple); border: 1px solid rgba(138, 58, 185, 0.3);">
                            <i class="fas fa-briefcase"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="myJobsCount">0</div>
                            <div>Job Listings</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(37, 211, 102, 0.2); color: var(--whatsapp-green); border: 1px solid rgba(37, 211, 102, 0.3);">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="myEarnings">KES 0</div>
                            <div>Available Balance</div>
                        </div>
                    </div>
                    
                    <!-- New stat for ads -->
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(246, 139, 30, 0.2); color: var(--jumia-orange); border: 1px solid rgba(246, 139, 30, 0.3);">
                            <i class="fas fa-ad"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="myAdsCount">0</div>
                            <div>Active Ads</div>
                        </div>
                    </div>
                    <!-- New stat for commissions from resells -->
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(138, 58, 185, 0.2); color: var(--instagram-purple); border: 1px solid rgba(138, 58, 185, 0.3);">
                            <i class="fas fa-hand-holding-usd"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="resellCommission">KES 0</div>
                            <div>Resell Commissions</div>
                        </div>
                    </div>
                </div>
                
                <!-- Payment Methods Section (Dashboard) -->
                <div class="business-tools-section">
                    <div class="section-header">
                        <h2 class="section-title">Payment Methods</h2>
                        <p style="color: var(--light-gray);">Choose your preferred payment method for subscriptions, boosts, and ads</p>
                    </div>
                    <div class="payment-methods">
                        <div class="payment-method selected" id="dashboardAutomaticPayment">
                            <div class="payment-method-header">
                                <div class="payment-method-icon">
                                    <i class="fas fa-bolt"></i>
                                </div>
                                <div>
                                    <h3 style="color: var(--white);">Automatic (Recommended)</h3>
                                    <p style="color: var(--light-gray);">M-Pesa STK Push</p>
                                </div>
                            </div>
                            <p style="color: var(--light-gray); margin-bottom: 1rem;">
                                Instant payments via M-Pesa. Enter PIN on your phone to complete transactions.
                            </p>
                            <div class="payment-method-features">
                                <div class="payment-method-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Instant subscription activation</span>
                                </div>
                                <div class="payment-method-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>No waiting for admin approval</span>
                                </div>
                                <div class="payment-method-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Secure and convenient</span>
                                </div>
                            </div>
                            <button class="btn btn-orange w-full mt-3" onclick="selectPaymentMethod('automatic')">
                                <i class="fas fa-check"></i> Set as Default
                            </button>
                        </div>
                        
                        <div class="payment-method" id="dashboardManualPayment">
                            <div class="payment-method-header">
                                <div class="payment-method-icon">
                                    <i class="fas fa-mobile-alt"></i>
                                </div>
                                <div>
                                    <h3 style="color: var(--white);">Manual Payment</h3>
                                    <p style="color: var(--light-gray);">Paybill Method</p>
                                </div>
                            </div>
                            <p style="color: var(--light-gray); margin-bottom: 1rem;">
                                Send money via Paybill, then enter transaction code for verification.
                            </p>
                            <div class="payment-method-features">
                                <div class="payment-method-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Paybill: 222111</span>
                                </div>
                                <div class="payment-method-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Account: 5414200</span>
                                </div>
                                <div class="payment-method-feature">
                                    <i class="fas fa-check-circle"></i>
                                    <span>Admin approval required (24hrs)</span>
                                </div>
                            </div>
                            <button class="btn btn-outline w-full mt-3" onclick="selectPaymentMethod('manual')">
                                <i class="fas fa-check"></i> Use This Method
                            </button>
                        </div>
                    </div>
                </div>
                
                <!-- Business Tools Section -->
                <div class="business-tools-section">
                    <div class="section-header">
                        <h2 class="section-title">Business Tools</h2>
                        <p style="color: var(--light-gray);">Advanced tools to manage and grow your business</p>
                    </div>
                    <div class="tools-grid">
                        <div class="tool-card" onclick="showBusinessModal('analytics')">
                            <div class="tool-icon">
                                <i class="fas fa-chart-line"></i>
                            </div>
                            <h3>Advanced Analytics</h3>
                            <p>Detailed insights on post performance and customer engagement</p>
                        </div>
                        
                        <div class="tool-card" onclick="showBusinessModal('inventory')">
                            <div class="tool-icon">
                                <i class="fas fa-warehouse"></i>
                            </div>
                            <h3>Inventory Manager</h3>
                            <p>Track stock levels, set alerts, and manage suppliers</p>
                        </div>
                        
                        <div class="tool-card" onclick="showBusinessModal('bulkUpload')">
                            <div class="tool-icon">
                                <i class="fas fa-file-csv"></i>
                            </div>
                            <h3>Bulk CSV Upload</h3>
                            <p>Upload multiple products/services via CSV file</p>
                        </div>
                        
                        <div class="tool-card" onclick="showBusinessModal('reports')">
                            <div class="tool-icon">
                                <i class="fas fa-file-pdf"></i>
                            </div>
                            <h3>PDF Reports</h3>
                            <p>Generate detailed sales and performance reports</p>
                        </div>
                        
                        <div class="tool-card" onclick="showBusinessModal('scheduler')">
                            <div class="tool-icon">
                                <i class="fas fa-clock"></i>
                            </div>
                            <h3>Content Scheduler</h3>
                            <p>Schedule posts for optimal times automatically</p>
                        </div>
                        
                        <div class="tool-card" onclick="showBusinessModal('marketing')">
                            <div class="tool-icon">
                                <i class="fas fa-bullseye"></i>
                            </div>
                            <h3>Marketing Campaigns</h3>
                            <p>Create and track marketing campaigns</p>
                        </div>

                        <div class="tool-card" onclick="showBusinessModal('calculator')">
                            <div class="tool-icon">
                                <i class="fas fa-calculator"></i>
                            </div>
                            <h3>Business Calculator</h3>
                            <p>Calculate profits, revenue, and costs</p>
                        </div>
                    </div>
                </div>
                
                <!-- Earnings & Referrals Section -->
                <div class="earnings-card">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem; flex-wrap: wrap; gap: 1rem;">
                        <div>
                            <h3 style="color: var(--white); margin-bottom: 0.5rem;">Earnings & Referrals</h3>
                            <p style="opacity: 0.9;">Earn 50% commission on every successful referral</p>
                        </div>
                        <span class="badge badge-secondary">50% Commission</span>
                    </div>
                    
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1.5rem; margin-bottom: 2rem; color: white;">
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--white);">KES 25</div>
                            <div style="font-size: 0.875rem; opacity: 0.8;">Per Referral</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--white);" id="dashboardTotalReferrals">0</div>
                            <div style="font-size: 0.875rem; opacity: 0.8;">Successful Referrals</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--white);" id="earnedAmount">KES 0</div>
                            <div style="font-size: 0.875rem; opacity: 0.8;">Total Earned</div>
                        </div>
                        <div style="text-align: center;">
                            <div style="font-size: 2rem; font-weight: bold; color: var(--white);" id="withdrawnAmount">KES 0</div>
                            <div style="font-size: 0.875rem; opacity: 0.8;">Withdrawn</div>
                        </div>
                    </div>
                    
                    <!-- Referral Link -->
                    <div style="background: rgba(255, 255, 255, 0.05); padding: 1.5rem; border-radius: var(--radius); margin-bottom: 2rem;">
                        <label style="color: white; margin-bottom: 0.5rem; display: block;">Your Referral Link</label>
                        <div style="display: flex; gap: 1rem;">
                            <input type="text" class="form-control" id="referralLink" readonly 
                                   style="background: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.2); color: white;">
                            <button class="btn btn-orange" onclick="copyReferralLink()">
                                <i class="fas fa-copy"></i> Copy
                            </button>
                            <button class="btn btn-outline" onclick="shareReferralLink()">
                                <i class="fas fa-share-alt"></i> Share
                            </button>
                        </div>
                        <small style="color: rgba(255, 255, 255, 0.7); margin-top: 0.5rem; display: block;">
                            Share this link. Earn 50% when friends subscribe or boost.
                        </small>
                    </div>
                    
                    <!-- Withdrawal Form -->
                    <div>
                        <h4 style="color: white; margin-bottom: 1rem;">Withdraw Earnings</h4>
                        <form id="withdrawalForm">
                            <div class="form-group">
                                <input type="number" class="form-control" id="withdrawalAmount" 
                                       placeholder="Amount (KES)" min="100" 
                                       style="background: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.2); color: white;">
                                <small style="color: rgba(255, 255, 255, 0.7);">Minimum: KES 100 (10% fee applies)</small>
                            </div>
                            
                            <div class="form-group">
                                <input type="text" class="form-control" id="withdrawalMpesa" 
                                       placeholder="M-Pesa Number (2547XXXXXXXX)" 
                                       style="background: rgba(255, 255, 255, 0.1); border-color: rgba(255, 255, 255, 0.2); color: white;">
                            </div>
                            
                            <button type="submit" class="btn btn-orange w-full">
                                <i class="fas fa-paper-plane"></i> Request Withdrawal
                            </button>
                        </form>
                    </div>
                </div>
                
                <!-- My Posts Tabs (enhanced) -->
                <div class="content-tabs">
                    <button class="tab-btn active" onclick="showDashboardTab('myProducts')">
                        <i class="fas fa-box"></i> My Products
                    </button>
                    <button class="tab-btn" onclick="showDashboardTab('myDigital')">
                        <i class="fas fa-book"></i> My Digital
                    </button>
                    <button class="tab-btn" onclick="showDashboardTab('myLessons')">
                        <i class="fas fa-chalkboard-teacher"></i> My Lessons
                    </button>
                    <button class="tab-btn" onclick="showDashboardTab('myServices')">
                        <i class="fas fa-concierge-bell"></i> My Services
                    </button>
                    <button class="tab-btn" onclick="showDashboardTab('mySocial')">
                        <i class="fas fa-users"></i> Social Posts
                    </button>
                    <button class="tab-btn" onclick="showDashboardTab('myJobs')">
                        <i class="fas fa-briefcase"></i> My Jobs
                    </button>
                    <button class="tab-btn" onclick="showDashboardTab('myBoosted')">
                        <i class="fas fa-rocket"></i> Boosted
                    </button>
                    <button class="tab-btn" onclick="showDashboardTab('drafts')">
                        <i class="fas fa-file-alt"></i> Drafts
                    </button>
                    <button class="tab-btn" onclick="showDashboardTab('myAds')">
                        <i class="fas fa-ad"></i> My Ads
                    </button>
                    <button class="tab-btn" onclick="showDashboardTab('myProposals')">
                        <i class="fas fa-file-pdf"></i> My Proposals
                    </button>
                    <button class="tab-btn" onclick="showDashboardTab('myReels')">
                        <i class="fas fa-video"></i> My Reels
                    </button>
                    <button class="tab-btn" onclick="showDashboardTab('orders')">
                        <i class="fas fa-truck"></i> Orders
                    </button>
                </div>
                
                <!-- Content Areas -->
                <div id="myProductsTab" class="dashboard-tab">
                    <div class="content-grid grid-3" id="myProductsGrid">
                        <!-- User's products loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="myDigitalTab" class="dashboard-tab" style="display: none;">
                    <div class="content-grid grid-3" id="myDigitalGrid">
                        <!-- User's digital products loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="myLessonsTab" class="dashboard-tab" style="display: none;">
                    <div class="content-grid grid-3" id="myLessonsGrid">
                        <!-- User's lessons loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="myServicesTab" class="dashboard-tab" style="display: none;">
                    <div class="content-grid grid-3" id="myServicesGrid">
                        <!-- User's services loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="mySocialTab" class="dashboard-tab" style="display: none;">
                    <div class="content-grid grid-2" id="mySocialGrid">
                        <!-- User's social posts loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="myJobsTab" class="dashboard-tab" style="display: none;">
                    <div class="content-grid grid-3" id="myJobsGrid">
                        <!-- User's jobs loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="myBoostedTab" class="dashboard-tab" style="display: none;">
                    <div class="content-grid grid-3" id="myBoostedGrid">
                        <!-- User's boosted posts loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="draftsTab" class="dashboard-tab" style="display: none;">
                    <div class="content-grid grid-3" id="draftsGrid">
                        <!-- User's drafts loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="myAdsTab" class="dashboard-tab" style="display: none;">
                    <div class="content-grid grid-3" id="myAdsGrid">
                        <!-- User's ads loaded by JavaScript -->
                    </div>
                </div>

                <div id="myProposalsTab" class="dashboard-tab" style="display: none;">
                    <div class="content-grid grid-3" id="myProposalsGrid">
                        <!-- User's proposals loaded by JavaScript -->
                    </div>
                </div>

                <div id="myReelsTab" class="dashboard-tab" style="display: none;">
                    <div class="content-grid grid-3" id="myReelsGrid">
                        <!-- User's reels loaded by JavaScript -->
                    </div>
                </div>

                <div id="ordersTab" class="dashboard-tab" style="display: none;">
                    <h3>My Orders</h3>
                    <div id="ordersList" class="content-grid grid-3"></div>
                </div>
            </div>
        </section>
        
        <!-- Orders Page (new) -->
        <section id="orders" class="page">
            <div class="container">
                <h2 class="section-title">My Orders</h2>
                <div class="content-tabs">
                    <button class="tab-btn active" onclick="loadOrders('buyer')">As Buyer</button>
                    <button class="tab-btn" onclick="loadOrders('seller')">As Seller</button>
                </div>
                <div id="ordersContainer"></div>
            </div>
        </section>
        
        <!-- Chat Page (new) -->
        <section id="chat" class="page">
            <div class="container">
                <div class="chat-window">
                    <div class="chat-messages-area" id="chatMessages"></div>
                    <div class="chat-input-area">
                        <input type="text" id="chatMessageInput" placeholder="Type your message...">
                        <button class="btn btn-primary" onclick="sendChatMessage()">Send</button>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Leaderboard (gamification) -->
        <section id="leaderboard" class="page">
            <div class="container">
                <h2 class="section-title">Top Referrers</h2>
                <div id="leaderboardList" class="content-grid grid-3"></div>
            </div>
        </section>
        
        <!-- User Profile Page -->
        <section id="user-profile" class="page">
            <div class="container">
                <div id="userProfileContent">
                    <!-- User profile loaded by JavaScript -->
                </div>
            </div>
        </section>
        
        <!-- Shop Page (with rating) -->
        <section id="shop" class="page">
            <div class="container">
                <div class="shop-header" id="shopHeader">
                    <!-- Shop header loaded by JavaScript -->
                </div>
                
                <!-- Shop Rating Display -->
                <div class="shop-rating" id="shopRatingDisplay">
                    <!-- Stars loaded by JavaScript -->
                </div>
                
                <!-- Shop Management Tabs -->
                <div class="content-tabs">
                    <button class="tab-btn active" onclick="showShopTab('products')">
                        <i class="fas fa-box"></i> Shop Products
                    </button>
                    <button class="tab-btn" onclick="showShopTab('services')">
                        <i class="fas fa-concierge-bell"></i> Shop Services
                    </button>
                    <button class="tab-btn" onclick="showShopTab('orders')">
                        <i class="fas fa-shopping-cart"></i> Orders
                    </button>
                    <button class="tab-btn" onclick="showShopTab('customers')">
                        <i class="fas fa-users"></i> Customers
                    </button>
                    <button class="tab-btn" onclick="showShopTab('settings')">
                        <i class="fas fa-cog"></i> Shop Settings
                    </button>
                </div>
                
                <!-- Shop Content -->
                <div id="shopProductsTab" class="dashboard-tab">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h3>Shop Products</h3>
                        <button class="btn btn-primary" onclick="showPage('create-post')">
                            <i class="fas fa-plus"></i> Add Product
                        </button>
                    </div>
                    <div class="shop-products-grid" id="shopProductsGrid">
                        <!-- Shop products loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="shopServicesTab" class="dashboard-tab" style="display: none;">
                    <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                        <h3>Shop Services</h3>
                        <button class="btn btn-primary" onclick="showPage('create-post')">
                            <i class="fas fa-plus"></i> Add Service
                        </button>
                    </div>
                    <div class="shop-products-grid" id="shopServicesGrid">
                        <!-- Shop services loaded by JavaScript -->
                    </div>
                </div>
                
                <div id="shopOrdersTab" class="dashboard-tab" style="display: none;">
                    <div class="empty-state">
                        <i class="fas fa-shopping-cart"></i>
                        <h3 style="color: var(--white);">No Orders Yet</h3>
                        <p>When customers purchase your products/services, orders will appear here</p>
                    </div>
                </div>
                
                <div id="shopCustomersTab" class="dashboard-tab" style="display: none;">
                    <div class="empty-state">
                        <i class="fas fa-users"></i>
                        <h3 style="color: var(--white);">No Customers Yet</h3>
                        <p>Customer information will appear here when they purchase from your shop</p>
                    </div>
                </div>
                
                <div id="shopSettingsTab" class="dashboard-tab" style="display: none;">
                    <div class="form-card">
                        <h3 class="form-title">Shop Settings</h3>
                        <form id="shopSettingsForm">
                            <div class="form-group">
                                <label class="form-label">Shop Name *</label>
                                <input type="text" class="form-control" id="shopName" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Shop Description</label>
                                <textarea class="form-control form-textarea" id="shopDescription" placeholder="Describe your shop..."></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Shop Category</label>
                                <select class="form-control" id="shopCategory">
                                    <option value="">Select Category</option>
                                    <option value="electronics">Electronics</option>
                                    <option value="fashion">Fashion</option>
                                    <option value="home">Home & Garden</option>
                                    <option value="services">Services</option>
                                    <option value="food">Food & Drinks</option>
                                    <option value="other">Other</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Shop Logo</label>
                                <div class="upload-area" onclick="document.getElementById('shopLogo').click()">
                                    <i class="fas fa-camera"></i>
                                    <p>Click to upload shop logo</p>
                                    <small style="color: var(--light-gray);">Max 5MB, JPG/PNG</small>
                                </div>
                                <input type="file" id="shopLogo" accept="image/*" style="display: none;" onchange="previewShopLogo()">
                                <div id="shopLogoPreview" class="mt-2" style="text-align: center;"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Shop Banner</label>
                                <div class="upload-area" onclick="document.getElementById('shopBanner').click()">
                                    <i class="fas fa-image"></i>
                                    <p>Click to upload shop banner</p>
                                    <small style="color: var(--light-gray);">Max 10MB, JPG/PNG</small>
                                </div>
                                <input type="file" id="shopBanner" accept="image/*" style="display: none;" onchange="previewShopBanner()">
                                <div id="shopBannerPreview" class="mt-2" style="text-align: center;"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Contact WhatsApp *</label>
                                <input type="text" class="form-control" id="shopWhatsapp" placeholder="2547XXXXXXXX" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Shop Location</label>
                                <input type="text" class="form-control" id="shopLocation" placeholder="e.g., Nairobi, CBD">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Business Hours</label>
                                <input type="text" class="form-control" id="shopHours" placeholder="e.g., Mon-Fri 9AM-6PM, Sat 10AM-4PM">
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-full">
                                <i class="fas fa-save"></i> Save Shop Settings
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- CV Management Page -->
        <section id="my-cvs" class="page">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">My CVs</h2>
                    <button class="btn btn-primary" onclick="showPage('create-post')">
                        <i class="fas fa-plus"></i> Upload New CV
                    </button>
                </div>
                
                <div class="cv-list" id="cvList">
                    <!-- CVs loaded by JavaScript -->
                </div>
            </div>
        </section>
        
        <!-- Profile Page (with 2FA) -->
        <section id="profile" class="page">
            <div class="container">
                <div class="form-container">
                    <div class="form-card">
                        <h2 class="form-title">Edit Profile</h2>
                        <form id="profileForm">
                            <div class="form-group">
                                <label class="form-label">Profile Picture</label>
                                <div class="upload-area" onclick="document.getElementById('profilePicture').click()">
                                    <i class="fas fa-user-circle"></i>
                                    <p>Click to upload profile picture</p>
                                    <small style="color: var(--light-gray);">Max 5MB, JPG/PNG</small>
                                </div>
                                <input type="file" id="profilePicture" accept="image/*" style="display: none;" onchange="previewProfilePicture()">
                                <div id="profilePicturePreview" class="mt-2" style="text-align: center;"></div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Full Name *</label>
                                <input type="text" class="form-control" id="profileNameInput" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Email Address *</label>
                                <input type="email" class="form-control" id="profileEmailInput" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Phone Number *</label>
                                <input type="text" class="form-control" id="profilePhoneInput" placeholder="2547XXXXXXXX" required>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Location</label>
                                <input type="text" class="form-control" id="profileLocation" placeholder="Your city">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Bio</label>
                                <textarea class="form-control form-textarea" id="profileBio" placeholder="Tell us about yourself..."></textarea>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Business Name (Optional)</label>
                                <input type="text" class="form-control" id="profileBusiness" placeholder="Your business name">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Two‑Factor Authentication</label>
                                <div>
                                    <label><input type="checkbox" id="enable2FA" onchange="toggle2FA()"> Enable 2FA</label>
                                </div>
                                <div id="2faSetup" style="display: none;">
                                    <p>Scan QR code with Google Authenticator or enter code manually:</p>
                                    <p id="2faSecret"></p>
                                    <input type="text" id="2faCode" placeholder="Enter 6-digit code" class="form-control">
                                    <button type="button" class="btn btn-sm btn-primary" onclick="verify2FA()">Verify</button>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Change Password</label>
                                <input type="password" class="form-control" id="profileCurrentPassword" placeholder="Current password">
                                <input type="password" class="form-control mt-2" id="profileNewPassword" placeholder="New password">
                                <input type="password" class="form-control mt-2" id="profileConfirmPassword" placeholder="Confirm new password">
                            </div>
                            
                            <button type="submit" class="btn btn-primary w-full">
                                <i class="fas fa-save"></i> Save Changes
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Admin Panel (unchanged + analytics) -->
        <section id="admin" class="page">
            <div class="container">
                <h2 class="section-title">Admin Panel</h2>
                
                <!-- Admin Stats -->
                <div class="dashboard-grid">
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(24, 119, 242, 0.2); color: var(--primary-light); border: 1px solid rgba(61, 139, 247, 0.3);">
                            <i class="fas fa-users"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="adminUsers">0</div>
                            <div>Total Users</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(228, 64, 95, 0.2); color: var(--instagram-pink); border: 1px solid rgba(228, 64, 95, 0.3);">
                            <i class="fas fa-file-alt"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="adminPosts">0</div>
                            <div>Total Posts</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(138, 58, 185, 0.2); color: var(--instagram-purple); border: 1px solid rgba(138, 58, 185, 0.3);">
                            <i class="fas fa-clock"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="adminPending">0</div>
                            <div>Pending Approvals</div>
                        </div>
                    </div>
                    
                    <div class="stat-card">
                        <div class="stat-icon" style="background: rgba(37, 211, 102, 0.2); color: var(--whatsapp-green); border: 1px solid rgba(37, 211, 102, 0.3);">
                            <i class="fas fa-money-bill-wave"></i>
                        </div>
                        <div class="stat-content">
                            <div class="stat-value" id="adminRevenue">KES 0</div>
                            <div>Total Revenue</div>
                        </div>
                    </div>
                </div>
                
                <!-- Admin Tabs -->
                <div class="content-tabs">
                    <button class="tab-btn active" onclick="showAdminTab('pending')">
                        <i class="fas fa-clock"></i> Pending Approvals
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('withdrawals')">
                        <i class="fas fa-wallet"></i> Pending Withdrawals
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('users')">
                        <i class="fas fa-users"></i> All Users
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('posts')">
                        <i class="fas fa-list"></i> All Posts
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('analytics')">
                        <i class="fas fa-chart-line"></i> Analytics
                    </button>
                    <button class="tab-btn" onclick="showAdminTab('settings')">
                        <i class="fas fa-cog"></i> Settings
                    </button>
                </div>
                
                <!-- Admin Content -->
                <div id="adminContent">
                    <!-- Content loaded by JavaScript -->
                </div>
            </div>
        </section>
        
        <!-- Register Page -->
        <section id="register" class="page">
            <div class="container">
                <div class="form-container">
                    <div class="form-card">
                        <h2 class="form-title">Join SOKOPLUS</h2>
                        <form id="registerForm">
                            <!-- Form loaded by JavaScript -->
                        </form>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Login Page -->
        <section id="login" class="page">
            <div class="container">
                <div class="form-container">
                    <div class="form-card">
                        <h2 class="form-title">Welcome Back</h2>
                        <form id="loginForm">
                            <!-- Form loaded by JavaScript -->
                        </form>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Forgot Password -->
        <section id="forgot-password" class="page">
            <div class="container">
                <div class="form-container">
                    <div class="form-card">
                        <h2 class="form-title">Reset Password</h2>
                        <div id="forgotPasswordForm">
                            <!-- Form loaded by JavaScript -->
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Subscription Page (with auto-renew) -->
        <section id="subscribe" class="page">
            <div class="container">
                <div class="form-container">
                    <div class="form-card">
                        <h2 class="form-title">Subscribe to SOKOPLUS</h2>
                        <p class="text-center mb-3" style="color: var(--light-gray);">Choose your plan</p>
                        
                        <!-- Auto-renew toggle -->
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="autoRenew"> Enable auto‑renewal (weekly)
                            </label>
                        </div>
                        
                        <!-- Plan Selection -->
                        <div class="payment-methods mb-3">
                            <div class="payment-method selected" onclick="selectPlan('individual')" id="planIndividual">
                                <div class="payment-method-header">
                                    <div class="payment-method-icon">
                                        <i class="fas fa-user"></i>
                                    </div>
                                    <div>
                                        <h3 style="color: var(--white);">Individual</h3>
                                        <p style="color: var(--light-gray);">KES 50/week or KES 200/month</p>
                                    </div>
                                </div>
                                <p style="color: var(--light-gray); font-size: 0.875rem;">
                                    Unlimited posts, access to marketplace.
                                </p>
                            </div>
                            
                            <div class="payment-method" onclick="selectPlan('business')" id="planBusiness">
                                <div class="payment-method-header">
                                    <div class="payment-method-icon">
                                        <i class="fas fa-building"></i>
                                    </div>
                                    <div>
                                        <h3 style="color: var(--white);">Business</h3>
                                        <p style="color: var(--light-gray);">KES 100/week or KES 400/month</p>
                                    </div>
                                </div>
                                <p style="color: var(--light-gray); font-size: 0.875rem;">
                                    All individual features + business tools, job posts, shop.
                                </p>
                            </div>
                        </div>

                        <!-- Duration Selection -->
                        <div style="display: flex; gap: 1rem; margin-bottom: 2rem;">
                            <button class="btn btn-outline" onclick="selectDuration('week')" id="durationWeek">Weekly</button>
                            <button class="btn btn-primary" onclick="selectDuration('month')" id="durationMonth">Monthly</button>
                        </div>
                        
                        <!-- Payment Method Selection -->
                        <div class="payment-methods mb-3">
                            <div class="payment-method selected" onclick="selectPaymentMethodForSubscription('automatic')" id="subscriptionAutomatic">
                                <div class="payment-method-header">
                                    <div class="payment-method-icon">
                                        <i class="fas fa-bolt"></i>
                                    </div>
                                    <div>
                                        <h3 style="color: var(--white);">Automatic Payment</h3>
                                        <p style="color: var(--light-gray);">M-Pesa STK Push</p>
                                    </div>
                                </div>
                                <p style="color: var(--light-gray); font-size: 0.875rem;">
                                    Instant subscription via M-Pesa STK Push.
                                </p>
                                <div class="payment-status success" style="margin-top: 1rem;">
                                    <i class="fas fa-bolt"></i>
                                    <span>Recommended</span>
                                </div>
                            </div>
                            
                            <div class="payment-method" onclick="selectPaymentMethodForSubscription('manual')" id="subscriptionManual">
                                <div class="payment-method-header">
                                    <div class="payment-method-icon">
                                        <i class="fas fa-mobile-alt"></i>
                                    </div>
                                    <div>
                                        <h3 style="color: var(--white);">Manual Payment</h3>
                                        <p style="color: var(--light-gray);">Paybill</p>
                                    </div>
                                </div>
                                <p style="color: var(--light-gray); font-size: 0.875rem;">
                                    Pay via Paybill, then enter transaction code. Requires admin approval.
                                </p>
                            </div>
                        </div>
                        
                        <!-- Automatic Payment Flow -->
                        <div id="automaticPaymentFlow" class="automatic-payment-flow">
                            <h4 style="color: var(--white); margin-bottom: 1.5rem; text-align: center;">
                                <i class="fas fa-bolt"></i> Automatic M-Pesa Payment
                            </h4>
                            
                            <div class="payment-step">
                                <div class="step-number">1</div>
                                <div>
                                    <h5 style="color: var(--white);">Confirm Payment</h5>
                                    <p style="color: var(--light-gray); font-size: 0.875rem;">
                                        You will receive an M-Pesa STK Push on your phone <strong id="userPhoneForPayment"></strong>
                                    </p>
                                </div>
                            </div>
                            
                            <div class="payment-step">
                                <div class="step-number">2</div>
                                <div>
                                    <h5 style="color: var(--white);">Enter M-Pesa PIN</h5>
                                    <p style="color: var(--light-gray); font-size: 0.875rem;">
                                        Enter your M-Pesa PIN on your phone to complete payment
                                    </p>
                                    <div class="simulated-phone" style="margin-top: 1rem;">
                                        <div style="padding-top: 2rem;">
                                            <div style="text-align: center; color: white; font-weight: 600; margin-bottom: 1rem;">
                                                Confirm Payment to SOKOPLUS
                                            </div>
                                            <div style="text-align: center; color: var(--jumia-orange); font-size: 1.5rem; font-weight: 700; margin-bottom: 1rem;" id="paymentAmount">
                                                KES 50.00
                                            </div>
                                            <div style="text-align: center; color: var(--light-gray); font-size: 0.875rem;">
                                                Enter your M-Pesa PIN to confirm
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="payment-step">
                                <div class="step-number">3</div>
                                <div>
                                    <h5 style="color: var(--white);">Wait for Confirmation</h5>
                                    <p style="color: var(--light-gray); font-size: 0.875rem;">
                                        Payment processing... This may take a few seconds
                                    </p>
                                    <div class="payment-timer" id="paymentTimer">30s</div>
                                </div>
                            </div>
                            
                            <button class="btn btn-orange w-full" onclick="processAutomaticPayment()" id="startPaymentBtn">
                                <i class="fas fa-bolt"></i> Start Automatic Payment
                            </button>
                        </div>
                        
                        <!-- Manual Payment Flow -->
                        <div id="manualPaymentFlow" class="manual-payment-flow" style="display: none;">
                            <h4 style="color: var(--white); margin-bottom: 1.5rem; text-align: center;">
                                <i class="fas fa-mobile-alt"></i> Manual Paybill Payment
                            </h4>
                            
                            <div class="payment-step">
                                <div class="step-number">1</div>
                                <div>
                                    <h5 style="color: var(--white);">Send Money via M-Pesa</h5>
                                    <p style="color: var(--light-gray); font-size: 0.875rem;">
                                        Go to M-Pesa on your phone and send <span id="manualAmount">KES 50</span> to:
                                    </p>
                                    <div class="payment-details">
                                        <div class="payment-detail">
                                            <span class="payment-detail-label">Paybill Number:</span>
                                            <span class="payment-detail-value">222111</span>
                                            <button class="copy-btn" onclick="copyToClipboard('222111')">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                        <div class="payment-detail">
                                            <span class="payment-detail-label">Account Number:</span>
                                            <span class="payment-detail-value">5414200</span>
                                            <button class="copy-btn" onclick="copyToClipboard('5414200')">
                                                <i class="fas fa-copy"></i>
                                            </button>
                                        </div>
                                        <div class="payment-detail">
                                            <span class="payment-detail-label">Amount:</span>
                                            <span class="payment-detail-value amount" id="manualAmountValue">KES 50</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="payment-step">
                                <div class="step-number">2</div>
                                <div>
                                    <h5 style="color: var(--white);">Enter Transaction Code</h5>
                                    <p style="color: var(--light-gray); font-size: 0.875rem;">
                                        Enter the M-Pesa transaction code you received:
                                    </p>
                                    <input type="text" class="form-control" id="manualTransactionCode" 
                                           placeholder="e.g., RGT6X9B5P2" style="margin-top: 0.5rem;">
                                    <small style="color: var(--light-gray); display: block; margin-top: 0.5rem;">
                                        You will receive a text message with the transaction code
                                    </small>
                                </div>
                            </div>
                            
                            <div class="payment-step">
                                <div class="step-number">3</div>
                                <div>
                                    <h5 style="color: var(--white);">Wait for Approval</h5>
                                    <p style="color: var(--light-gray); font-size: 0.875rem;">
                                        Admin will approve your subscription within 24 hours
                                    </p>
                                    <div class="payment-status pending" id="manualPaymentStatus" style="display: none;">
                                        <i class="fas fa-clock"></i>
                                        <span>Pending Admin Approval</span>
                                    </div>
                                </div>
                            </div>
                            
                            <button class="btn btn-primary w-full" onclick="submitManualPayment()">
                                <i class="fas fa-check"></i> Submit Transaction Code
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Boost Payment Page -->
        <section id="boost-payment" class="page">
            <div class="container">
                <div class="form-container">
                    <div class="form-card">
                        <h2 class="form-title">Boost Your Post</h2>
                        <p class="text-center mb-3" style="color: var(--light-gray);">KES 100 to boost your post for maximum visibility</p>
                        
                        <!-- Payment Method Selection -->
                        <div class="payment-methods mb-3">
                            <div class="payment-method selected" onclick="selectPaymentMethodForBoost('automatic')" id="boostAutomatic">
                                <div class="payment-method-header">
                                    <div class="payment-method-icon">
                                        <i class="fas fa-bolt"></i>
                                    </div>
                                    <div>
                                        <h3 style="color: var(--white);">Automatic Boost</h3>
                                        <p style="color: var(--light-gray);">Instant activation</p>
                                    </div>
                                </div>
                                <p style="color: var(--light-gray); font-size: 0.875rem;">
                                    Pay KES 100 via M-Pesa STK Push. Your post gets boosted immediately.
                                </p>
                            </div>
                            
                            <div class="payment-method" onclick="selectPaymentMethodForBoost('manual')" id="boostManual">
                                <div class="payment-method-header">
                                    <div class="payment-method-icon">
                                        <i class="fas fa-mobile-alt"></i>
                                    </div>
                                    <div>
                                        <h3 style="color: var(--white);">Manual Boost</h3>
                                        <p style="color: var(--light-gray);">Paybill payment</p>
                                    </div>
                                </div>
                                <p style="color: var(--light-gray); font-size: 0.875rem;">
                                    Pay via Paybill, then enter transaction code. Boost activates after admin approval.
                                </p>
                            </div>
                        </div>
                        
                        <div id="boostPaymentContent">
                            <!-- Payment content loaded based on selection -->
                        </div>
                        
                        <div class="mt-3" style="text-align: center;">
                            <a href="#" onclick="showPage('dashboard'); return false;" style="color: var(--light-gray);">
                                <i class="fas fa-arrow-left"></i> Back to Dashboard
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        
        <!-- Ad Payment Page -->
        <section id="ad-payment" class="page">
            <div class="container">
                <div class="form-container">
                    <div class="form-card">
                        <h2 class="form-title">Pay for Your Ad</h2>
                        <p class="text-center mb-3" style="color: var(--light-gray);">KES 299/week to display your ad on the homepage</p>
                        
                        <div id="adPaymentDetails">
                            <!-- Payment details will be inserted here -->
                        </div>
                        
                        <div class="mt-3" style="text-align: center;">
                            <a href="#" onclick="showPage('dashboard'); return false;" style="color: var(--light-gray);">
                                <i class="fas fa-arrow-left"></i> Back to Dashboard
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>
    
    <!-- Chatbot -->
    <div class="chatbot-toggle" id="chatbotToggle">
        <i class="fas fa-comments"></i>
    </div>
    
    <div class="chatbot-container" id="chatbotContainer">
        <div class="chatbot-header">
            <div>
                <h4 style="margin: 0; color: var(--white);">SOKOPLUS Assistant</h4>
                <small style="opacity: 0.8; color: var(--light-gray);">Online 24/7</small>
            </div>
            <button class="chatbot-close" id="chatbotClose">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="chatbot-messages" id="chatbotMessages">
            <!-- Messages loaded by JavaScript -->
        </div>
        <div class="quick-questions">
            <button class="quick-question" onclick="sendQuickQuestion('How do I pay automatically?')">Auto payment?</button>
            <button class="quick-question" onclick="sendQuickQuestion('How to pay manually?')">Manual payment?</button>
            <button class="quick-question" onclick="sendQuickQuestion('Subscription cost?')">Subscription?</button>
            <button class="quick-question" onclick="sendQuickQuestion('How to create an ad?')">Create ad</button>
            <button class="quick-question" onclick="sendQuickQuestion('Contact admin')">Contact admin</button>
            <button class="quick-question" onclick="sendQuickQuestion('Referral bonuses?')">Referral bonuses</button>
            <button class="quick-question" onclick="sendQuickQuestion('Business calculator')">Calculator</button>
            <button class="quick-question" onclick="sendQuickQuestion('Digital products')">Digital products</button>
            <button class="quick-question" onclick="sendQuickQuestion('Resell products')">Resell products</button>
            <button class="quick-question" onclick="sendQuickQuestion('Tip a creator')">Tip a creator</button>
        </div>
        <div class="chatbot-input">
            <input type="text" id="chatbotInput" placeholder="Type your question...">
            <button class="btn btn-primary" onclick="sendChatMessage()">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>
    
    <!-- Footer -->
    <footer class="footer">
        <div class="container">
            <div class="footer-grid">
                <div>
                    <div class="logo" style="margin-bottom: 1rem;">
                        <div class="logo-icon" style="width: 40px; height: 40px; font-size: 1rem;">S+</div>
                        <div class="logo-text" style="font-size: 1.5rem;">
                            SOKO<span>PLUS</span>
                            <span class="logo-tagline">Marketplace & Business Hub</span>
                        </div>
                    </div>
                    <p style="color: var(--light-gray); font-size: 0.875rem;">
                        Kenyans fastest growing marketplace. Sell products, post jobs, share updates, and advertise your business. Earn through referrals and business tools.
                    </p>
                </div>
                
                <div>
                    <h4 style="color: var(--jumia-orange); margin-bottom: 1.5rem;">Quick Links</h4>
                    <ul style="list-style: none;">
                        <li><a href="#" onclick="showPage('home'); return false;" style="color: var(--light-gray); text-decoration: none; transition: var(--transition-fast); display: block; margin-bottom: 0.75rem;">Home</a></li>
                        <li><a href="#" onclick="showPage('marketplace'); return false;" style="color: var(--light-gray); text-decoration: none; transition: var(--transition-fast); display: block; margin-bottom: 0.75rem;">Marketplace</a></li>
                        <li><a href="#" onclick="showPage('create-post'); return false;" style="color: var(--light-gray); text-decoration: none; transition: var(--transition-fast); display: block; margin-bottom: 0.75rem;">Create Post</a></li>
                        <li><a href="#" onclick="showPage('dashboard'); return false;" style="color: var(--light-gray); text-decoration: none; transition: var(--transition-fast); display: block; margin-bottom: 0.75rem;">Dashboard</a></li>
                        <li><a href="#" onclick="showPage('leaderboard'); return false;" style="color: var(--light-gray); text-decoration: none; transition: var(--transition-fast); display: block; margin-bottom: 0.75rem;">Leaderboard</a></li>
                    </ul>
                </div>
                
                <div>
                    <h4 style="color: var(--jumia-orange); margin-bottom: 1.5rem;">Payment Methods</h4>
                    <ul style="list-style: none;">
                        <li style="color: var(--light-gray); margin-bottom: 0.75rem;"><i class="fas fa-bolt" style="color: var(--primary); margin-right: 0.5rem;"></i> <strong>Automatic:</strong> M-Pesa STK Push</li>
                        <li style="color: var(--light-gray); margin-bottom: 0.75rem;"><i class="fas fa-mobile-alt" style="color: var(--primary); margin-right: 0.5rem;"></i> <strong>Manual:</strong> Paybill 222111</li>
                        <li style="color: var(--light-gray); margin-bottom: 0.75rem;"><strong>Account:</strong> 5414200</li>
                        <li style="color: var(--light-gray); margin-bottom: 0.75rem;"><strong>Individual:</strong> KES 50/week or 200/month</li>
                        <li style="color: var(--light-gray); margin-bottom: 0.75rem;"><strong>Business:</strong> KES 100/week or 400/month</li>
                        <li style="color: var(--light-gray); margin-bottom: 0.75rem;"><strong>Boost:</strong> KES 100/post</li>
                        <li style="color: var(--light-gray); margin-bottom: 0.75rem;"><strong>Ad:</strong> KES 299/week</li>
                    </ul>
                </div>
                
                <div>
                    <h4 style="color: var(--jumia-orange); margin-bottom: 1.5rem;">Contact Info</h4>
                    <ul style="list-style: none;">
                        <li style="color: var(--light-gray); margin-bottom: 0.75rem;"><strong>WhatsApp Support:</strong> +254 712 883849</li>
                        <li style="color: var(--light-gray); margin-bottom: 0.75rem;"><strong>Email:</strong> sokoplus254@gmail.com</li>
                        <li style="color: var(--light-gray); margin-bottom: 0.75rem;"><strong>Auto Payments:</strong> 24/7</li>
                        <li style="color: var(--light-gray); margin-bottom: 0.75rem;"><strong>Manual Approvals:</strong> Within 24hrs</li>
                    </ul>
                </div>
            </div>
            
            <div class="footer-bottom">
                &copy; 2026 SOKOPLUS. All rights reserved. | WhatsApp Support: +254 712 883849 | Email: sokoplus254@gmail.com
            </div>
        </div>
    </footer>
    
    <!-- Modals -->
    <div class="modal" id="postModal">
        <div class="modal-content">
            <!-- Modal content loaded by JavaScript -->
        </div>
    </div>
    
    <div class="modal" id="paymentModal">
        <div class="modal-content">
            <!-- Payment modal loaded by JavaScript -->
        </div>
    </div>
    
    <div class="modal" id="businessModal">
        <div class="modal-content">
            <!-- Business tools modal loaded by JavaScript -->
        </div>
    </div>
    
    <!-- Deposit Modal -->
    <div class="modal" id="depositModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('depositModal')">&times;</button>
            <h3 style="color: var(--white); margin-bottom: 1rem;">Deposit Funds</h3>
            <form id="depositForm">
                <div class="form-group">
                    <label class="form-label">Amount (KES) *</label>
                    <input type="number" class="form-control" id="depositAmount" placeholder="e.g., 1000" min="100" required>
                </div>
                <div class="form-group">
                    <label class="form-label">Payment Method</label>
                    <div style="display: flex; gap: 1rem;">
                        <label style="color: var(--white);"><input type="radio" name="depositMethod" value="automatic" checked> Automatic (STK Push)</label>
                        <label style="color: var(--white);"><input type="radio" name="depositMethod" value="manual"> Manual (Paybill)</label>
                    </div>
                </div>
                <div id="depositManualFields" style="display: none;">
                    <p style="color: var(--light-gray);">Send to Paybill: 222111, Account: 5414200, then enter transaction code below.</p>
                    <div class="form-group">
                        <label class="form-label">Transaction Code</label>
                        <input type="text" class="form-control" id="depositTransactionCode" placeholder="e.g., RGT6X9B5P2">
                    </div>
                </div>
                <button type="submit" class="btn btn-primary w-full">Deposit</button>
            </form>
        </div>
    </div>
    
    <!-- Purchase Confirmation Modal (enhanced with escrow & shipping) -->
    <div class="modal" id="purchaseModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('purchaseModal')">&times;</button>
            <h3 style="color: var(--white); margin-bottom: 1rem;" id="purchaseTitle">Confirm Purchase</h3>
            <p style="color: var(--light-gray);" id="purchaseDetails"></p>
            <div style="margin: 1.5rem 0;">
                <p>Price: <strong id="purchasePrice"></strong></p>
                <p>Your Balance: <strong id="purchaseBalance"></strong></p>
                <label><input type="checkbox" id="useEscrow"> Use Escrow (funds released after delivery)</label>
            </div>
            <!-- Shipping Address (if physical product) -->
            <div id="shippingSection" style="display: none;">
                <h4>Shipping Address</h4>
                <div class="shipping-form">
                    <input type="text" id="shippingName" placeholder="Full Name" class="form-control">
                    <input type="text" id="shippingPhone" placeholder="Phone Number" class="form-control">
                    <input type="text" id="shippingAddress" placeholder="Address" class="form-control">
                    <input type="text" id="shippingCity" placeholder="City" class="form-control">
                </div>
                <div id="shippingOptions"></div>
            </div>
            <button class="btn btn-orange w-full" id="confirmPurchaseBtn">Pay with Wallet</button>
            <p class="text-center mt-2"><small style="color: var(--light-gray);">Alternatively, deposit funds first</small></p>
        </div>
    </div>
    
    <!-- Tip Modal -->
    <div class="modal" id="tipModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('tipModal')">&times;</button>
            <h3 style="color: var(--white); margin-bottom: 1rem;">Send a Tip</h3>
            <p style="color: var(--light-gray);" id="tipCreatorName"></p>
            <div class="form-group">
                <label class="form-label">Amount (KES)</label>
                <input type="number" class="form-control" id="tipAmount" min="10" placeholder="e.g., 50">
            </div>
            <button class="btn btn-orange w-full" onclick="sendTip()">Send Tip</button>
        </div>
    </div>
    
    <!-- Resell Modal -->
    <div class="modal" id="resellModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('resellModal')">&times;</button>
            <h3 style="color: var(--white); margin-bottom: 1rem;">Resell This Product</h3>
            <p style="color: var(--light-gray);">You will get a unique resell link. When someone buys through it, you earn commission.</p>
            <div class="form-group">
                <label class="form-label">Your Resell Link</label>
                <div style="display: flex; gap: 0.5rem;">
                    <input type="text" class="form-control" id="resellLink" readonly>
                    <button class="btn btn-primary" onclick="copyResellLink()">Copy</button>
                </div>
            </div>
            <p style="color: var(--light-gray);">Share this link with your audience. You'll earn <span id="resellCommissionPercent">10</span>% commission on each sale.</p>
        </div>
    </div>
    
    <!-- Rating Modal -->
    <div class="modal" id="ratingModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('ratingModal')">&times;</button>
            <h3 style="color: var(--white); margin-bottom: 1rem;">Rate This Shop</h3>
            <div class="rating-stars" style="text-align: center; font-size: 2rem;">
                <i class="fas fa-star star" onclick="setRating(1)"></i>
                <i class="fas fa-star star" onclick="setRating(2)"></i>
                <i class="fas fa-star star" onclick="setRating(3)"></i>
                <i class="fas fa-star star" onclick="setRating(4)"></i>
                <i class="fas fa-star star" onclick="setRating(5)"></i>
            </div>
            <textarea class="form-control mt-2" id="ratingComment" placeholder="Leave a comment (optional)"></textarea>
            <button class="btn btn-primary w-full mt-3" onclick="submitRating()">Submit Rating</button>
        </div>
    </div>
    
    <!-- Order Details Modal -->
    <div class="modal" id="orderModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('orderModal')">&times;</button>
            <div id="orderDetails"></div>
            <button class="btn btn-primary w-full" onclick="closeModal('orderModal')">Close</button>
        </div>
    </div>
    
    <!-- Chat Modal (for quick chat) -->
    <div class="modal" id="chatModal">
        <div class="modal-content" style="max-width: 500px;">
            <button class="modal-close" onclick="closeModal('chatModal')">&times;</button>
            <h3 style="color: var(--white); margin-bottom: 1rem;">Chat with Seller</h3>
            <div class="chat-window" style="height: 400px;">
                <div class="chat-messages-area" id="modalChatMessages"></div>
                <div class="chat-input-area">
                    <input type="text" id="modalChatInput" placeholder="Type your message...">
                    <button class="btn btn-primary" onclick="sendModalChatMessage()">Send</button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- 2FA Modal -->
    <div class="modal" id="twoFAModal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal('twoFAModal')">&times;</button>
            <h3 style="color: var(--white); margin-bottom: 1rem;">Two‑Factor Authentication</h3>
            <p id="twoFAStatus"></p>
            <input type="text" id="twoFACodeInput" class="form-control" placeholder="Enter code">
            <button class="btn btn-primary w-full mt-3" onclick="verify2FALogin()">Verify</button>
        </div>
    </div>
    
    <!-- Ad Popup -->
    <div class="ad-popup" id="adPopup">
        <button class="ad-popup-close" onclick="closeAdPopup()">&times;</button>
        <div id="adPopupContent">
            <!-- Ad content loaded by JavaScript -->
        </div>
    </div>
    
    <!-- Notification Container -->
    <div id="notificationContainer"></div>
    
    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="spinner" style="display: none;"></div>
    
    <script>
        // ============================================
        // SOKOPLUS LIVE APPLICATION - FRONTEND (FULLY UPDATED)
        // ============================================
        
        const API_BASE_URL = window.location.hostname === 'localhost' 
            ? 'http://localhost:3000/api'
            : 'https://' + window.location.hostname + '/api';
        
        let currentUser = null;
        let authToken = null;
        let selectedPaymentMethod = 'automatic';
        let selectedPlan = 'individual';
        let selectedDuration = 'week';
        let paymentTimer = null;
        let paymentTimeLeft = 30;
        let currentProductForPurchase = null;
        let currentReelForTip = null;
        let currentShopForRating = null;
        let currentResellProduct = null;
        let adPopupInterval = null;
        let translations = {
            en: {},
            sw: {}
        };
        let currentLanguage = 'en';
        let notificationPermission = false;
        let chatPartnerId = null;
        let chatInterval = null;
        let chartInstances = {}; // Store chart instances to destroy before recreating
        
        // ============================================
        // INITIALIZATION
        // ============================================
        
        document.addEventListener('DOMContentLoaded', function() {
            initApp();
            initMobileNavigation();
            initEventListeners();
            initChatbot();
            checkAuth();
            requestNotificationPermission();
            loadTranslations();
        });
        
        function initApp() {
            authToken = localStorage.getItem('sokoplus_token');
            const userData = localStorage.getItem('sokoplus_user');
            if (userData) {
                try {
                    currentUser = JSON.parse(userData);
                    // Normalize subscription object
                    if (currentUser && typeof currentUser.subscription_active !== 'undefined') {
                        currentUser.subscription = {
                            active: currentUser.subscription_active,
                            expiresAt: currentUser.subscription_expires_at
                        };
                    }
                    if (!currentUser.accountType) {
                        currentUser.accountType = currentUser.business_name ? 'company' : 'individual';
                    }
                } catch (e) {
                    console.error('Failed to parse user data', e);
                }
                selectedPaymentMethod = currentUser?.paymentMethod || 'automatic';
            }
            updateNavigation('home');
            loadHomeContent();
        }
        
        function initMobileNavigation() {
            const mobileBtn = document.getElementById('mobileMenuBtn');
            const navMenu = document.getElementById('navMenu');
            
            if (mobileBtn) {
                mobileBtn.addEventListener('click', (e) => {
                    e.stopPropagation();
                    mobileBtn.classList.toggle('active');
                    navMenu.classList.toggle('active');
                });
                
                document.addEventListener('click', (e) => {
                    if (!navMenu.contains(e.target) && !mobileBtn.contains(e.target)) {
                        mobileBtn.classList.remove('active');
                        navMenu.classList.remove('active');
                    }
                });

                document.querySelectorAll('.nav-link').forEach(link => {
                    link.addEventListener('click', () => {
                        mobileBtn.classList.remove('active');
                        navMenu.classList.remove('active');
                    });
                });
            }
        }
        
        function initEventListeners() {
            // Form submissions
            document.getElementById('productForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                createProductPost();
            });
            
            document.getElementById('digitalForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                createDigitalProduct();
            });
            
            document.getElementById('lessonForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                createLesson();
            });
            
            document.getElementById('socialForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                createSocialPost();
            });
            
            document.getElementById('jobForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                createJobPost();
            });
            
            document.getElementById('serviceForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                createServicePost();
            });
            
            document.getElementById('cvForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                uploadCV();
            });
            
            document.getElementById('adForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                createAd();
            });

            document.getElementById('proposalForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                createProposal();
            });

            document.getElementById('reelForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                createReel();
            });
            
            document.getElementById('withdrawalForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                requestWithdrawal();
            });
            
            document.getElementById('profileForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                updateProfile();
            });
            
            document.getElementById('shopSettingsForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                updateShopSettings();
            });

            document.getElementById('depositForm')?.addEventListener('submit', function(e) {
                e.preventDefault();
                processDeposit();
            });
            
            // Deposit method toggle
            document.querySelectorAll('input[name="depositMethod"]').forEach(radio => {
                radio.addEventListener('change', function() {
                    document.getElementById('depositManualFields').style.display = this.value === 'manual' ? 'block' : 'none';
                });
            });
            
            // Ad form payment method selection
            document.getElementById('adDuration')?.addEventListener('change', updateAdAmount);
            
            // Chatbot
            document.getElementById('chatbotToggle')?.addEventListener('click', toggleChatbot);
            document.getElementById('chatbotClose')?.addEventListener('click', toggleChatbot);
            document.getElementById('chatbotInput')?.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendChatMessage();
            });
            
            // Marketplace filters with debounce
            let searchTimeout;
            document.getElementById('marketplaceSearch')?.addEventListener('input', function() {
                clearTimeout(searchTimeout);
                searchTimeout = setTimeout(() => loadMarketplace(), 300);
            });
            document.getElementById('marketplaceCategory')?.addEventListener('change', loadMarketplace);
            document.getElementById('marketplaceSort')?.addEventListener('change', loadMarketplace);
            
            // Modal close buttons
            document.addEventListener('click', function(e) {
                if (e.target.classList.contains('modal')) {
                    closeModal(e.target.id);
                }
            });

            // Lesson type toggle
            window.toggleLessonType = function() {
                const type = document.getElementById('lessonType').value;
                document.getElementById('lessonVideoGroup').style.display = type === 'single' ? 'block' : 'none';
                document.getElementById('lessonPlaylistGroup').style.display = type === 'playlist' ? 'block' : 'none';
            };
        }
        
        // ============================================
        // NOTIFICATIONS
        // ============================================
        
        function requestNotificationPermission() {
            if (typeof Notification !== 'undefined') {
                if (Notification.permission !== 'granted' && Notification.permission !== 'denied') {
                    Notification.requestPermission().then(perm => {
                        notificationPermission = perm === 'granted';
                    });
                } else {
                    notificationPermission = Notification.permission === 'granted';
                }
            } else {
                notificationPermission = false;
            }
        }
        
        function showBrowserNotification(title, body, icon = '/favicon.png') {
            if (!notificationPermission) return;
            new Notification(title, { body, icon });
        }
        
        // ============================================
        // LANGUAGE
        // ============================================
        
        function loadTranslations() {
            translations = {
                en: {
                    home: 'Home',
                    marketplace: 'Marketplace',
                    createPost: 'Create Post',
                    dashboard: 'Dashboard',
                    admin: 'Admin',
                    login: 'Login',
                    register: 'Register',
                    logout: 'Logout',
                    // Add more as needed
                },
                sw: {
                    home: 'Nyumbani',
                    marketplace: 'Soko',
                    createPost: 'Tuma Tangazo',
                    dashboard: 'Dashibodi',
                    admin: 'Msimamizi',
                    login: 'Ingia',
                    register: 'Jisajili',
                    logout: 'Toka',
                }
            };
        }
        
        function setLanguage(lang) {
            currentLanguage = lang;
            document.querySelectorAll('.language-switcher button').forEach(btn => {
                btn.classList.toggle('active', btn.textContent.toLowerCase() === lang);
            });
            // Translate static elements with data-i18n attribute
            document.querySelectorAll('[data-i18n]').forEach(el => {
                const key = el.getAttribute('data-i18n');
                if (translations[lang][key]) {
                    el.textContent = translations[lang][key];
                }
            });
            // Update navigation
            updateNavigation();
        }
        
        // ============================================
        // 2FA
        // ============================================
        
        function toggle2FA() {
            const enabled = document.getElementById('enable2FA').checked;
            document.getElementById('2faSetup').style.display = enabled ? 'block' : 'none';
            if (enabled) {
                // Generate secret (mock)
                document.getElementById('2faSecret').textContent = 'ABCDEFGHIJKLMNOP';
            }
        }
        
        function verify2FA() {
            const code = document.getElementById('2faCode').value;
            // In production: send to backend
            if (code.length === 6) {
                showNotification('2FA enabled successfully', 'success');
            } else {
                showNotification('Invalid code', 'error');
            }
        }
        
        function show2FAModal() {
            document.getElementById('twoFAStatus').textContent = 'Enter the 6‑digit code from your authenticator app.';
            document.getElementById('twoFAModal').classList.add('active');
        }
        
        function verify2FALogin() {
            const code = document.getElementById('twoFACodeInput').value;
            // Mock verification
            if (code === '123456') {
                closeModal('twoFAModal');
                showNotification('2FA verified', 'success');
            } else {
                showNotification('Invalid code', 'error');
            }
        }
        
        // ============================================
        // MISSING FUNCTIONS DEFINED
        // ============================================
        
        function showAdminTab(tabName) {
            document.querySelectorAll('#admin .tab-btn').forEach(btn => btn.classList.remove('active'));
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            }
            loadAdminContent(tabName);
        }

        function showBusinessModal(modalType) {
            const modal = document.getElementById('businessModal');
            const content = modal.querySelector('.modal-content');
            let html = '';
            
            if (modalType === 'calculator') {
                html = `
                    <button class="modal-close" onclick="closeModal('businessModal')">&times;</button>
                    <h3 style="color: var(--white); margin-bottom: 1rem;">Business Calculators</h3>
                    <div class="calculator-tabs">
                        <button class="calculator-tab active" onclick="showCalculatorTab('profit')">Profit</button>
                        <button class="calculator-tab" onclick="showCalculatorTab('cost')">Cost</button>
                        <button class="calculator-tab" onclick="showCalculatorTab('roi')">ROI</button>
                        <button class="calculator-tab" onclick="showCalculatorTab('pricing')">Pricing</button>
                    </div>
                    
                    <div id="profitCalculator" class="calculator-pane active">
                        <div class="calculator-input-group">
                            <label>Revenue (KES)</label>
                            <input type="number" id="calcRevenue" placeholder="e.g., 100000">
                        </div>
                        <div class="calculator-input-group">
                            <label>Cost of Goods (KES)</label>
                            <input type="number" id="calcCost" placeholder="e.g., 60000">
                        </div>
                        <div class="calculator-input-group">
                            <label>Other Expenses (KES)</label>
                            <input type="number" id="calcExpenses" placeholder="e.g., 10000">
                        </div>
                        <button class="btn btn-primary" onclick="calculateProfit()">Calculate Profit</button>
                        <div id="profitResult" class="calculator-result" style="display: none;"></div>
                    </div>
                    
                    <div id="costCalculator" class="calculator-pane">
                        <div class="calculator-input-group">
                            <label>Fixed Costs (KES)</label>
                            <input type="number" id="calcFixedCost" placeholder="e.g., 20000">
                        </div>
                        <div class="calculator-input-group">
                            <label>Variable Cost per Unit (KES)</label>
                            <input type="number" id="calcVarCost" placeholder="e.g., 500">
                        </div>
                        <div class="calculator-input-group">
                            <label>Number of Units</label>
                            <input type="number" id="calcUnits" placeholder="e.g., 100">
                        </div>
                        <button class="btn btn-primary" onclick="calculateCost()">Calculate Total Cost</button>
                        <div id="costResult" class="calculator-result" style="display: none;"></div>
                    </div>
                    
                    <div id="roiCalculator" class="calculator-pane">
                        <div class="calculator-input-group">
                            <label>Initial Investment (KES)</label>
                            <input type="number" id="calcInvestment" placeholder="e.g., 50000">
                        </div>
                        <div class="calculator-input-group">
                            <label>Final Value (KES)</label>
                            <input type="number" id="calcFinalValue" placeholder="e.g., 75000">
                        </div>
                        <button class="btn btn-primary" onclick="calculateROI()">Calculate ROI</button>
                        <div id="roiResult" class="calculator-result" style="display: none;"></div>
                    </div>
                    
                    <div id="pricingCalculator" class="calculator-pane">
                        <div class="calculator-input-group">
                            <label>Cost per Unit (KES)</label>
                            <input type="number" id="calcUnitCost" placeholder="e.g., 1000">
                        </div>
                        <div class="calculator-input-group">
                            <label>Desired Margin (%)</label>
                            <input type="number" id="calcMargin" placeholder="e.g., 30">
                        </div>
                        <button class="btn btn-primary" onclick="calculatePrice()">Calculate Selling Price</button>
                        <div id="priceResult" class="calculator-result" style="display: none;"></div>
                    </div>
                `;
            } else if (modalType === 'analytics') {
                const chartId = 'analyticsChart-' + Date.now();
                html = `
                    <button class="modal-close" onclick="closeModal('businessModal')">&times;</button>
                    <h3 style="color: var(--white); margin-bottom: 1rem;">Analytics</h3>
                    <p style="color: var(--light-gray);">Post performance, views, engagement.</p>
                    <canvas id="${chartId}" width="400" height="200"></canvas>
                `;
                content.innerHTML = html;
                modal.classList.add('active');
                // Wait for canvas to be added to DOM
                setTimeout(() => {
                    const canvas = document.getElementById(chartId);
                    if (canvas) {
                        const ctx = canvas.getContext('2d');
                        if (ctx) {
                            // Destroy previous chart if exists
                            if (chartInstances[modalType]) chartInstances[modalType].destroy();
                            chartInstances[modalType] = new Chart(ctx, {
                                type: 'line',
                                data: {
                                    labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                                    datasets: [{
                                        label: 'Views',
                                        data: [12, 19, 3, 5, 2, 3, 7],
                                        borderColor: 'rgb(75, 192, 192)',
                                        tension: 0.1
                                    }]
                                }
                            });
                        }
                    }
                }, 100);
                return; // already set content
            } else if (modalType === 'inventory') {
                html = `
                    <button class="modal-close" onclick="closeModal('businessModal')">&times;</button>
                    <h3 style="color: var(--white); margin-bottom: 1rem;">Inventory Management</h3>
                    <p style="color: var(--light-gray);">Track stock levels, low stock alerts.</p>
                `;
            } else if (modalType === 'bulkUpload') {
                html = `
                    <button class="modal-close" onclick="closeModal('businessModal')">&times;</button>
                    <h3 style="color: var(--white); margin-bottom: 1rem;">Bulk CSV Upload</h3>
                    <p style="color: var(--light-gray);">Upload multiple products via CSV.</p>
                    <input type="file" accept=".csv">
                `;
            } else if (modalType === 'reports') {
                html = `
                    <button class="modal-close" onclick="closeModal('businessModal')">&times;</button>
                    <h3 style="color: var(--white); margin-bottom: 1rem;">Generate Report</h3>
                    <button class="btn btn-primary">Download PDF</button>
                `;
            } else if (modalType === 'scheduler') {
                html = `
                    <button class="modal-close" onclick="closeModal('businessModal')">&times;</button>
                    <h3 style="color: var(--white); margin-bottom: 1rem;">Post Scheduler</h3>
                    <p style="color: var(--light-gray);">Schedule your posts for later.</p>
                `;
            } else if (modalType === 'marketing') {
                html = `
                    <button class="modal-close" onclick="closeModal('businessModal')">&times;</button>
                    <h3 style="color: var(--white); margin-bottom: 1rem;">Marketing Campaigns</h3>
                    <p style="color: var(--light-gray);">Create and track campaigns.</p>
                `;
            } else if (modalType === 'upgrade') {
                html = `
                    <button class="modal-close" onclick="closeModal('businessModal')">&times;</button>
                    <h3 style="color: var(--white); margin-bottom: 1rem;">Upgrade to Premium</h3>
                    <p style="color: var(--light-gray);">KES 200/month for businesses, KES 400/month for companies.</p>
                    <button class="btn btn-orange" onclick="processUpgrade()">Upgrade Now</button>
                `;
            }
            
            content.innerHTML = html;
            modal.classList.add('active');
        }

        function showCalculatorTab(tabName) {
            document.querySelectorAll('.calculator-tab').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.calculator-pane').forEach(pane => pane.classList.remove('active'));
            if (tabName === 'profit') {
                document.querySelectorAll('.calculator-tab')[0].classList.add('active');
                document.getElementById('profitCalculator').classList.add('active');
            } else if (tabName === 'cost') {
                document.querySelectorAll('.calculator-tab')[1].classList.add('active');
                document.getElementById('costCalculator').classList.add('active');
            } else if (tabName === 'roi') {
                document.querySelectorAll('.calculator-tab')[2].classList.add('active');
                document.getElementById('roiCalculator').classList.add('active');
            } else if (tabName === 'pricing') {
                document.querySelectorAll('.calculator-tab')[3].classList.add('active');
                document.getElementById('pricingCalculator').classList.add('active');
            }
        }

        function calculateProfit() {
            const revenue = parseFloat(document.getElementById('calcRevenue').value) || 0;
            const cost = parseFloat(document.getElementById('calcCost').value) || 0;
            const expenses = parseFloat(document.getElementById('calcExpenses').value) || 0;
            const profit = revenue - cost - expenses;
            const margin = revenue ? (profit / revenue * 100).toFixed(2) : 0;
            const resultDiv = document.getElementById('profitResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                Profit: KES ${profit.toFixed(2)}<br>
                Margin: ${margin}%
            `;
        }

        function calculateCost() {
            const fixed = parseFloat(document.getElementById('calcFixedCost').value) || 0;
            const varCost = parseFloat(document.getElementById('calcVarCost').value) || 0;
            const units = parseFloat(document.getElementById('calcUnits').value) || 0;
            const totalCost = fixed + (varCost * units);
            const resultDiv = document.getElementById('costResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                Total Cost: KES ${totalCost.toFixed(2)}<br>
                Cost per Unit: KES ${(totalCost / (units || 1)).toFixed(2)}
            `;
        }

        function calculateROI() {
            const investment = parseFloat(document.getElementById('calcInvestment').value) || 0;
            const finalValue = parseFloat(document.getElementById('calcFinalValue').value) || 0;
            const profit = finalValue - investment;
            const roi = investment ? (profit / investment * 100).toFixed(2) : 0;
            const resultDiv = document.getElementById('roiResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                Profit: KES ${profit.toFixed(2)}<br>
                ROI: ${roi}%
            `;
        }

        function calculatePrice() {
            const cost = parseFloat(document.getElementById('calcUnitCost').value) || 0;
            const margin = parseFloat(document.getElementById('calcMargin').value) || 0;
            const price = cost / (1 - margin / 100);
            const resultDiv = document.getElementById('priceResult');
            resultDiv.style.display = 'block';
            resultDiv.innerHTML = `
                Selling Price: KES ${price.toFixed(2)}<br>
                Profit per Unit: KES ${(price - cost).toFixed(2)}
            `;
        }

        function selectPlan(plan) {
            selectedPlan = plan;
            document.getElementById('planIndividual').classList.toggle('selected', plan === 'individual');
            document.getElementById('planBusiness').classList.toggle('selected', plan === 'business');
            updatePaymentAmount();
        }

        function selectDuration(duration) {
            selectedDuration = duration;
            document.getElementById('durationWeek').classList.toggle('btn-primary', duration === 'week');
            document.getElementById('durationWeek').classList.toggle('btn-outline', duration !== 'week');
            document.getElementById('durationMonth').classList.toggle('btn-primary', duration === 'month');
            document.getElementById('durationMonth').classList.toggle('btn-outline', duration !== 'month');
            updatePaymentAmount();
        }

        function updatePaymentAmount() {
            let amount = 0;
            if (selectedPlan === 'individual') {
                amount = selectedDuration === 'week' ? 50 : 200;
            } else {
                amount = selectedDuration === 'week' ? 100 : 400;
            }
            document.getElementById('paymentAmount').innerText = `KES ${amount}.00`;
            document.getElementById('manualAmountValue').innerText = `KES ${amount}`;
            document.getElementById('manualAmount').innerText = `KES ${amount}`;
        }

        // ============================================
        // AD FUNCTIONS
        // ============================================
        
        let selectedAdPaymentMethod = 'auto';
        
        function selectAdPaymentMethod(method) {
            selectedAdPaymentMethod = method;
            document.getElementById('adAutoPayment').classList.toggle('selected', method === 'auto');
            document.getElementById('adManualPayment').classList.toggle('selected', method === 'manual');
            document.getElementById('adManualPaymentFields').style.display = method === 'manual' ? 'block' : 'none';
        }
        
        function updateAdAmount() {
            const weeks = parseInt(document.getElementById('adDuration').value);
            const amount = weeks * 299;
            document.getElementById('adSubmitAmount').innerText = amount;
            document.getElementById('adTotalAmount').innerText = `KES ${amount}`;
        }
        
        function previewAdImage() {
            const file = document.getElementById('adImage').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.getElementById('adImagePreview');
                    preview.innerHTML = `<img src="${e.target.result}" style="max-width: 200px; border-radius: var(--radius);">`;
                };
                reader.readAsDataURL(file);
            }
        }

        function previewProposalFile() {
            const file = document.getElementById('proposalFile').files[0];
            const preview = document.getElementById('proposalFilePreview');
            if (file) {
                preview.innerHTML = `<i class="fas fa-file-pdf"></i> ${escapeHtml(file.name)} (${(file.size/1024).toFixed(2)} KB)`;
            } else {
                preview.innerHTML = `<i class="fas fa-file-alt"></i> No file chosen`;
            }
        }

        function previewReelVideo() {
            const file = document.getElementById('reelVideo').files[0];
            const preview = document.getElementById('reelVideoPreview');
            preview.innerHTML = '';
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const video = document.createElement('video');
                    video.src = e.target.result;
                    video.controls = true;
                    video.style.maxWidth = '100%';
                    video.style.maxHeight = '200px';
                    preview.appendChild(video);
                };
                reader.readAsDataURL(file);
            }
        }

        function previewDigitalCover() {
            const file = document.getElementById('digitalCover').files[0];
            const preview = document.getElementById('digitalCoverPreview');
            preview.innerHTML = '';
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.maxWidth = '200px';
                    img.style.maxHeight = '200px';
                    preview.appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        }

        function previewDigitalFile() {
            const file = document.getElementById('digitalFile').files[0];
            const preview = document.getElementById('digitalFilePreview');
            if (file) {
                preview.innerHTML = `<i class="fas fa-file"></i> ${escapeHtml(file.name)} (${(file.size/1024).toFixed(2)} KB)`;
            } else {
                preview.innerHTML = '';
            }
        }

        function previewLessonThumbnail() {
            const file = document.getElementById('lessonThumbnail').files[0];
            const preview = document.getElementById('lessonThumbnailPreview');
            preview.innerHTML = '';
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const img = document.createElement('img');
                    img.src = e.target.result;
                    img.style.maxWidth = '200px';
                    img.style.maxHeight = '200px';
                    preview.appendChild(img);
                };
                reader.readAsDataURL(file);
            }
        }

        function previewLessonVideo() {
            const file = document.getElementById('lessonVideo').files[0];
            const preview = document.getElementById('lessonVideoPreview');
            preview.innerHTML = '';
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const video = document.createElement('video');
                    video.src = e.target.result;
                    video.controls = true;
                    video.style.maxWidth = '100%';
                    video.style.maxHeight = '200px';
                    preview.appendChild(video);
                };
                reader.readAsDataURL(file);
            }
        }

        function previewLessonPlaylist() {
            const files = document.getElementById('lessonPlaylist').files;
            const preview = document.getElementById('lessonPlaylistPreview');
            preview.innerHTML = '';
            for (let i = 0; i < files.length; i++) {
                const div = document.createElement('div');
                div.className = 'media-preview';
                div.innerHTML = `<i class="fas fa-video"></i> ${escapeHtml(files[i].name)}`;
                preview.appendChild(div);
            }
        }
        
        async function createAd() {
            if (!currentUser) {
                showNotification('Please login to create an ad', 'error');
                showPage('login');
                return;
            }

            if (currentUser.status !== 'active') {
                showNotification('Your account is deactivated. Please contact admin or subscribe again.', 'error');
                return;
            }
            
            const title = document.getElementById('adTitle').value;
            const description = document.getElementById('adDescription').value;
            const whatsapp = document.getElementById('adWhatsapp').value;
            const url = document.getElementById('adUrl').value;
            const weeks = parseInt(document.getElementById('adDuration').value);
            const amount = weeks * 299;
            const mediaFiles = document.getElementById('adMedia').files;
            
            if (!title || !description || !whatsapp || !url) {
                showNotification('Please fill all required fields', 'error');
                return;
            }
            
            const formData = new FormData();
            formData.append('type', 'ad');
            formData.append('title', title);
            formData.append('description', description);
            formData.append('whatsapp', whatsapp);
            formData.append('target_url', url);
            formData.append('duration_weeks', weeks);
            formData.append('amount', amount);
            formData.append('payment_method', selectedAdPaymentMethod);
            
            if (currentUser.role === 'admin') {
                const offerTitle = document.getElementById('adOfferTitle')?.value;
                const offerDesc = document.getElementById('adOfferDesc')?.value;
                if (offerTitle) formData.append('offer_title', offerTitle);
                if (offerDesc) formData.append('offer_desc', offerDesc);
            }
            
            for (let i = 0; i < mediaFiles.length; i++) {
                formData.append('files', mediaFiles[i]);
            }
            
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/posts/ad`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showNotification('Ad created! Redirecting to payment.', 'success');
                    if (selectedAdPaymentMethod === 'auto') {
                        setTimeout(() => showPage('ad-payment'), 1500);
                    } else {
                        setTimeout(() => showPage('dashboard'), 1500);
                    }
                } else {
                    showNotification(data.message || 'Failed to create ad', 'error');
                }
            } catch (error) {
                console.error('Error creating ad:', error);
                showNotification('Network error', 'error');
            } finally {
                hideLoading();
            }
        }

        async function createProposal() {
            if (!currentUser) {
                showNotification('Please login', 'error');
                return;
            }

            if (currentUser.status !== 'active') {
                showNotification('Your account is deactivated. Please contact admin or subscribe again.', 'error');
                return;
            }
            
            const title = document.getElementById('proposalTitle').value;
            const desc = document.getElementById('proposalDesc').value;
            const budget = document.getElementById('proposalBudget').value;
            const whatsapp = document.getElementById('proposalWhatsapp').value;
            const file = document.getElementById('proposalFile').files[0];
            
            if (!title || !desc) {
                showNotification('Title and description required', 'error');
                return;
            }
            
            const formData = new FormData();
            formData.append('type', 'proposal');
            formData.append('title', title);
            formData.append('description', desc);
            if (budget) formData.append('budget', budget);
            if (whatsapp) formData.append('whatsapp', whatsapp);
            if (file) formData.append('file', file);
            
            showLoading();
            
            try {
                const response = await fetch(`${API_BASE_URL}/posts/proposal`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showNotification('Proposal submitted successfully!', 'success');
                    showPage('dashboard');
                } else {
                    showNotification(data.message || 'Failed to submit', 'error');
                }
            } catch (error) {
                console.error('Proposal error:', error);
                showNotification('Network error', 'error');
            } finally {
                hideLoading();
            }
        }

        async function createReel() {
            if (!currentUser) {
                showNotification('Please login', 'error');
                return;
            }

            if (currentUser.status !== 'active') {
                showNotification('Your account is deactivated. Please contact admin or subscribe again.', 'error');
                return;
            }

            if (!currentUser.subscription?.active) {
                showNotification('Subscription required to upload reels', 'error');
                showPage('subscribe');
                return;
            }

            const title = document.getElementById('reelTitle').value;
            const description = document.getElementById('reelDescription').value;
            const videoFile = document.getElementById('reelVideo').files[0];

            if (!title || !videoFile) {
                showNotification('Title and video are required', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('files', videoFile);

            showLoading();
            try {
                const uploadRes = await fetch(`${API_BASE_URL}/upload`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                const uploadData = await uploadRes.json();
                if (!uploadData.success) throw new Error('Upload failed');
                const videoUrl = uploadData.file.url;

                const reelData = {
                    type: 'reel',
                    title,
                    description,
                    media: [videoUrl]
                };

                const response = await fetch(`${API_BASE_URL}/posts`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(reelData)
                });
                const data = await response.json();
                if (response.ok) {
                    showNotification('Reel uploaded successfully!', 'success');
                    showPage('dashboard');
                } else {
                    showNotification(data.message || 'Failed to upload reel', 'error');
                }
            } catch (error) {
                console.error('Error creating reel:', error);
                showNotification('Network error', 'error');
            } finally {
                hideLoading();
            }
        }

        async function createDigitalProduct() {
            if (!currentUser) {
                showNotification('Please login', 'error');
                return;
            }

            if (currentUser.status !== 'active') {
                showNotification('Your account is deactivated.', 'error');
                return;
            }

            if (!currentUser.subscription?.active) {
                showNotification('Subscription required to sell digital products', 'error');
                showPage('subscribe');
                return;
            }

            const title = document.getElementById('digitalTitle').value;
            const description = document.getElementById('digitalDescription').value;
            const price = parseFloat(document.getElementById('digitalPrice').value);
            const category = document.getElementById('digitalCategory').value;
            const coverFile = document.getElementById('digitalCover').files[0];
            const productFile = document.getElementById('digitalFile').files[0];

            if (!title || !description || !price || !category || !coverFile || !productFile) {
                showNotification('All fields are required', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('title', title);
            formData.append('description', description);
            formData.append('price', price);
            formData.append('category', category);
            formData.append('cover', coverFile);
            formData.append('file', productFile);

            showLoading();
            try {
                const response = await fetch(`${API_BASE_URL}/digital-products`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                const data = await response.json();
                if (response.ok) {
                    showNotification('Digital product listed successfully!', 'success');
                    showPage('dashboard');
                } else {
                    showNotification(data.message || 'Failed to create product', 'error');
                }
            } catch (error) {
                console.error('Error creating digital product:', error);
                showNotification('Network error', 'error');
            } finally {
                hideLoading();
            }
        }

        async function createLesson() {
            if (!currentUser) {
                showNotification('Please login', 'error');
                return;
            }

            if (currentUser.status !== 'active') {
                showNotification('Your account is deactivated.', 'error');
                return;
            }

            if (!currentUser.subscription?.active) {
                showNotification('Subscription required to sell lessons', 'error');
                showPage('subscribe');
                return;
            }

            const title = document.getElementById('lessonTitle').value;
            const description = document.getElementById('lessonDescription').value;
            const price = parseFloat(document.getElementById('lessonPrice').value);
            const type = document.getElementById('lessonType').value;
            const thumbnailFile = document.getElementById('lessonThumbnail').files[0];
            const videoFile = type === 'single' ? document.getElementById('lessonVideo').files[0] : null;
            const playlistFiles = type === 'playlist' ? document.getElementById('lessonPlaylist').files : null;

            if (!title || !description || !price || !thumbnailFile) {
                showNotification('All fields are required', 'error');
                return;
            }
            if (type === 'single' && !videoFile) {
                showNotification('Please upload a video', 'error');
                return;
            }
            if (type === 'playlist' && (!playlistFiles || playlistFiles.length === 0)) {
                showNotification('Please upload at least one video', 'error');
                return;
            }

            const formData = new FormData();
            formData.append('title', title);
            formData.append('description', description);
            formData.append('price', price);
            formData.append('type', type);
            formData.append('thumbnail', thumbnailFile);
            if (type === 'single') {
                formData.append('video', videoFile);
            } else {
                for (let i = 0; i < playlistFiles.length; i++) {
                    formData.append('videos', playlistFiles[i]);
                }
            }

            showLoading();
            try {
                const response = await fetch(`${API_BASE_URL}/lessons`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                const data = await response.json();
                if (response.ok) {
                    showNotification('Lesson created successfully!', 'success');
                    showPage('dashboard');
                } else {
                    showNotification(data.message || 'Failed to create lesson', 'error');
                }
            } catch (error) {
                console.error('Error creating lesson:', error);
                showNotification('Network error', 'error');
            } finally {
                hideLoading();
            }
        }
        
        // ============================================
        // PAYMENT METHOD FUNCTIONS
        // ============================================
        
        function selectPaymentMethod(method) {
            selectedPaymentMethod = method;
            
            // Update homepage payment method cards
            document.querySelectorAll('#home .payment-method').forEach(el => {
                el.classList.remove('selected');
            });
            document.querySelectorAll('#dashboard .payment-method').forEach(el => {
                el.classList.remove('selected');
            });
            
            if (method === 'automatic') {
                document.getElementById('homeAutomaticPayment')?.classList.add('selected');
                document.getElementById('dashboardAutomaticPayment')?.classList.add('selected');
                document.getElementById('homeManualPayment')?.classList.remove('selected');
                document.getElementById('dashboardManualPayment')?.classList.remove('selected');
            } else {
                document.getElementById('homeManualPayment')?.classList.add('selected');
                document.getElementById('dashboardManualPayment')?.classList.add('selected');
                document.getElementById('homeAutomaticPayment')?.classList.remove('selected');
                document.getElementById('dashboardAutomaticPayment')?.classList.remove('selected');
            }
            
            if (currentUser) {
                savePaymentPreference(method);
            }
            
            showNotification(`Payment method set to: ${method === 'automatic' ? 'Automatic (M-Pesa STK Push)' : 'Manual (Paybill)'}`, 'success');
        }
        
        function selectPaymentMethodForSubscription(method) {
            selectedPaymentMethod = method;
            
            document.querySelectorAll('#subscribe .payment-method').forEach(el => {
                el.classList.remove('selected');
            });
            
            if (method === 'automatic') {
                document.getElementById('subscriptionAutomatic').classList.add('selected');
                document.getElementById('automaticPaymentFlow').style.display = 'block';
                document.getElementById('manualPaymentFlow').style.display = 'none';
                
                if (currentUser && currentUser.phone) {
                    document.getElementById('userPhoneForPayment').textContent = currentUser.phone;
                }
            } else {
                document.getElementById('subscriptionManual').classList.add('selected');
                document.getElementById('automaticPaymentFlow').style.display = 'none';
                document.getElementById('manualPaymentFlow').style.display = 'block';
            }
        }
        
        function selectPaymentMethodForBoost(method) {
            selectedPaymentMethod = method;
            
            document.querySelectorAll('#boost-payment .payment-method').forEach(el => {
                el.classList.remove('selected');
            });
            
            const content = document.getElementById('boostPaymentContent');
            
            if (method === 'automatic') {
                document.getElementById('boostAutomatic').classList.add('selected');
                content.innerHTML = `
                    <div class="automatic-payment-flow">
                        <h4 style="color: var(--white); margin-bottom: 1.5rem; text-align: center;">
                            <i class="fas fa-rocket"></i> Automatic Post Boost
                        </h4>
                        
                        <div class="payment-step">
                            <div class="step-number">1</div>
                            <div>
                                <h5 style="color: var(--white);">Confirm Payment</h5>
                                <p style="color: var(--light-gray); font-size: 0.875rem;">
                                    You will receive an M-Pesa STK Push on your phone to pay KES 100
                                </p>
                            </div>
                        </div>
                        
                        <div class="payment-step">
                            <div class="step-number">2</div>
                            <div>
                                <h5 style="color: var(--white);">Enter M-Pesa PIN</h5>
                                <p style="color: var(--light-gray); font-size: 0.875rem;">
                                    Enter your M-Pesa PIN on your phone to complete payment
                                </p>
                            </div>
                        </div>
                        
                        <div class="payment-step">
                            <div class="step-number">3</div>
                            <div>
                                <h5 style="color: var(--white);">Instant Boost</h5>
                                <p style="color: var(--light-gray); font-size: 0.875rem;">
                                    Your post will be boosted immediately after payment
                                </p>
                            </div>
                        </div>
                        
                        <button class="btn btn-orange w-full" onclick="processBoostPayment()">
                            <i class="fas fa-bolt"></i> Boost Now (KES 100)
                        </button>
                    </div>
                `;
            } else {
                document.getElementById('boostManual').classList.add('selected');
                content.innerHTML = `
                    <div class="manual-payment-flow">
                        <h4 style="color: var(--white); margin-bottom: 1.5rem; text-align: center;">
                            <i class="fas fa-mobile-alt"></i> Manual Boost Payment
                        </h4>
                        
                        <div class="payment-step">
                            <div class="step-number">1</div>
                            <div>
                                <h5 style="color: var(--white);">Send Money via M-Pesa</h5>
                                <p style="color: var(--light-gray); font-size: 0.875rem;">
                                    Go to M-Pesa on your phone and send KES 100 to:
                                </p>
                                <div class="payment-details">
                                    <div class="payment-detail">
                                        <span class="payment-detail-label">Paybill Number:</span>
                                        <span class="payment-detail-value">222111</span>
                                        <button class="copy-btn" onclick="copyToClipboard('222111')">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="payment-detail">
                                        <span class="payment-detail-label">Account Number:</span>
                                        <span class="payment-detail-value">5414200</span>
                                        <button class="copy-btn" onclick="copyToClipboard('5414200')">
                                            <i class="fas fa-copy"></i>
                                        </button>
                                    </div>
                                    <div class="payment-detail">
                                        <span class="payment-detail-label">Amount:</span>
                                        <span class="payment-detail-value amount">KES 100</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="payment-step">
                            <div class="step-number">2</div>
                            <div>
                                <h5 style="color: var(--white);">Enter Transaction Code</h5>
                                <p style="color: var(--light-gray); font-size: 0.875rem;">
                                    Enter the M-Pesa transaction code:
                                </p>
                                <input type="text" class="form-control" id="boostTransactionCode" 
                                       placeholder="e.g., RGT6X9B5P2" style="margin-top: 0.5rem;">
                            </div>
                        </div>
                        
                        <button class="btn btn-primary w-full" onclick="submitBoostPayment()">
                            <i class="fas fa-rocket"></i> Submit Boost Payment
                        </button>
                    </div>
                `;
            }
        }
        
        async function savePaymentPreference(method) {
            try {
                const response = await apiRequest('/users/payment-method', {
                    method: 'PUT',
                    body: JSON.stringify({ paymentMethod: method })
                });
                
                if (response) {
                    currentUser.paymentMethod = method;
                    localStorage.setItem('sokoplus_user', JSON.stringify(currentUser));
                }
            } catch (error) {
                console.error('Error saving payment preference:', error);
            }
        }
        
        function copyToClipboard(text) {
            if (navigator.clipboard && navigator.clipboard.writeText) {
                navigator.clipboard.writeText(text).then(() => {
                    showNotification('Copied to clipboard!', 'success');
                }).catch(() => {
                    fallbackCopyToClipboard(text);
                });
            } else {
                fallbackCopyToClipboard(text);
            }
        }
        
        function fallbackCopyToClipboard(text) {
            const textarea = document.createElement('textarea');
            textarea.value = text;
            textarea.style.position = 'fixed';
            textarea.style.opacity = '0';
            document.body.appendChild(textarea);
            textarea.select();
            try {
                document.execCommand('copy');
                showNotification('Copied to clipboard!', 'success');
            } catch (err) {
                showNotification('Failed to copy', 'error');
            }
            document.body.removeChild(textarea);
        }
        
        // ============================================
        // AUTOMATIC PAYMENT FUNCTIONS
        // ============================================
        
        function processAutomaticPayment() {
            if (!currentUser || !currentUser.phone) {
                showNotification('Please complete your profile with phone number', 'error');
                return;
            }
            
            const btn = document.getElementById('startPaymentBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Processing...';
            
            fetch(`${API_BASE_URL}/payments/automatic`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify({
                    amount: selectedPlan === 'individual' ? (selectedDuration === 'week' ? 50 : 200) : (selectedDuration === 'week' ? 100 : 400),
                    type: 'subscription',
                    phone: currentUser.phone
                })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    showNotification('M-Pesa STK Push sent to your phone. Please check your phone.', 'success');
                    startPaymentTimer();
                } else {
                    showNotification(data.message || 'Payment initiation failed', 'error');
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fas fa-bolt"></i> Start Automatic Payment';
                }
            })
            .catch(error => {
                console.error('Error initiating payment:', error);
                showNotification('Network error. Please try again.', 'error');
                btn.disabled = false;
                btn.innerHTML = '<i class="fas fa-bolt"></i> Start Automatic Payment';
            });
        }
        
        function startPaymentTimer() {
            paymentTimeLeft = 30;
            const timerElement = document.getElementById('paymentTimer');
            
            paymentTimer = setInterval(() => {
                paymentTimeLeft--;
                timerElement.textContent = `${paymentTimeLeft}s`;
                
                if (paymentTimeLeft <= 0) {
                    clearInterval(paymentTimer);
                    paymentTimer = null;
                    timerElement.textContent = 'Payment expired';
                    showNotification('Payment timed out. Please try again.', 'error');
                    
                    const btn = document.getElementById('startPaymentBtn');
                    btn.disabled = false;
                    btn.innerHTML = '<i class="fas fa-bolt"></i> Try Again';
                }
            }, 1000);
        }
        
        function processBoostPayment() {
            showNotification('M-Pesa STK Push sent to your phone. Please check your phone.', 'success');
            
            setTimeout(() => {
                showNotification('Payment successful! Your post has been boosted.', 'success');
                setTimeout(() => showPage('dashboard'), 1500);
            }, 3000);
        }
        
        // ============================================
        // MANUAL PAYMENT FUNCTIONS
        // ============================================
        
        function submitManualPayment() {
            const transactionCode = document.getElementById('manualTransactionCode')?.value.trim();
            
            if (!transactionCode || transactionCode.length < 8) {
                showNotification('Please enter a valid transaction code', 'error');
                return;
            }
            
            fetch(`${API_BASE_URL}/payments/manual`, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                    'Authorization': `Bearer ${authToken}`
                },
                body: JSON.stringify({
                    amount: selectedPlan === 'individual' ? (selectedDuration === 'week' ? 50 : 200) : (selectedDuration === 'week' ? 100 : 400),
                    type: 'subscription',
                    transactionCode: transactionCode
                })
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    document.getElementById('manualPaymentStatus').style.display = 'flex';
                    showNotification('Payment submitted! Admin will approve within 24 hours.', 'success');
                    setTimeout(() => showPage('dashboard'), 1500);
                } else {
                    showNotification(data.message || 'Submission failed', 'error');
                }
            })
            .catch(error => {
                console.error('Error submitting manual payment:', error);
                showNotification('Network error', 'error');
            });
        }
        
        function submitBoostPayment() {
            const transactionCode = document.getElementById('boostTransactionCode')?.value.trim();
            
            if (!transactionCode || transactionCode.length < 8) {
                showNotification('Please enter a valid transaction code', 'error');
                return;
            }
            
            showNotification('Boost payment submitted! Admin will approve within 24 hours.', 'success');
            setTimeout(() => showPage('dashboard'), 1500);
        }

        // ============================================
        // DEPOSIT FUNCTIONS
        // ============================================
        
        function showDepositModal() {
            document.getElementById('depositModal').classList.add('active');
        }

        async function processDeposit() {
            const amount = parseFloat(document.getElementById('depositAmount').value);
            const method = document.querySelector('input[name="depositMethod"]:checked').value;
            const transactionCode = document.getElementById('depositTransactionCode').value;

            if (!amount || amount < 100) {
                showNotification('Minimum deposit is KES 100', 'error');
                return;
            }

            if (method === 'manual' && (!transactionCode || transactionCode.length < 8)) {
                showNotification('Please enter a valid transaction code', 'error');
                return;
            }

            const depositData = {
                amount,
                method,
                transactionCode: method === 'manual' ? transactionCode : undefined
            };

            showLoading();
            try {
                const response = await fetch(`${API_BASE_URL}/wallet/deposit`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify(depositData)
                });
                const data = await response.json();
                if (data.success) {
                    showNotification(method === 'automatic' ? 'STK Push sent to your phone' : 'Deposit submitted for approval', 'success');
                    closeModal('depositModal');
                    setTimeout(() => loadDashboard(), 2000);
                } else {
                    showNotification(data.message || 'Deposit failed', 'error');
                }
            } catch (error) {
                console.error('Deposit error:', error);
                showNotification('Network error', 'error');
            } finally {
                hideLoading();
            }
        }

        // ============================================
        // PURCHASE FUNCTIONS (Product/Digital/Lesson)
        // ============================================
        
        function showPurchaseModal(product) {
            currentProductForPurchase = product;
            document.getElementById('purchaseTitle').innerText = product.title;
            document.getElementById('purchaseDetails').innerText = product.description || '';
            document.getElementById('purchasePrice').innerText = formatPrice(product.price);
            document.getElementById('purchaseBalance').innerText = formatPrice(currentUser?.earnings_balance || 0);
            document.getElementById('purchaseModal').classList.add('active');
            // Show shipping section if physical product
            if (product.category !== 'digital' && product.type !== 'lesson') {
                document.getElementById('shippingSection').style.display = 'block';
                loadShippingOptions();
            } else {
                document.getElementById('shippingSection').style.display = 'none';
            }
        }

        function loadShippingOptions() {
            // Mock shipping options
            const options = [
                { courier: 'G4S', cost: 250, days: 2 },
                { courier: 'Sendy', cost: 150, days: 3 }
            ];
            let html = '<h4>Shipping Options</h4>';
            options.forEach(opt => {
                html += `<label><input type="radio" name="shipping" value="${opt.courier}"> ${opt.courier} - KES ${opt.cost} (${opt.days} days)</label><br>`;
            });
            document.getElementById('shippingOptions').innerHTML = html;
        }

        async function confirmPurchase() {
            if (!currentProductForPurchase) return;
            const productId = currentProductForPurchase.id;
            const price = currentProductForPurchase.price;
            const useEscrow = document.getElementById('useEscrow').checked;

            if (currentUser.earnings_balance < price) {
                showNotification('Insufficient balance. Please deposit funds.', 'error');
                closeModal('purchaseModal');
                showDepositModal();
                return;
            }

            let shippingData = null;
            if (document.getElementById('shippingSection').style.display === 'block') {
                shippingData = {
                    name: document.getElementById('shippingName').value,
                    phone: document.getElementById('shippingPhone').value,
                    address: document.getElementById('shippingAddress').value,
                    city: document.getElementById('shippingCity').value,
                    courier: document.querySelector('input[name="shipping"]:checked')?.value
                };
                if (!shippingData.name || !shippingData.phone || !shippingData.address || !shippingData.city || !shippingData.courier) {
                    showNotification('Please fill shipping details', 'error');
                    return;
                }
            }

            showLoading();
            try {
                const response = await fetch(`${API_BASE_URL}/products/${productId}/purchase`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({
                        useEscrow,
                        shipping: shippingData
                    })
                });
                const data = await response.json();
                if (data.success) {
                    showNotification('Purchase successful!', 'success');
                    closeModal('purchaseModal');
                    // Refresh user data to update balance
                    const userRes = await apiRequest('/auth/profile');
                    if (userRes) {
                        currentUser = userRes.user;
                        localStorage.setItem('sokoplus_user', JSON.stringify(currentUser));
                        document.getElementById('walletBalance').innerText = formatPrice(currentUser.earnings_balance);
                    }
                    // Create order
                    if (data.order) {
                        showBrowserNotification('Order Placed', `Order #${data.order.id} has been created.`);
                    }
                } else {
                    showNotification(data.message || 'Purchase failed', 'error');
                }
            } catch (error) {
                console.error('Purchase error:', error);
                showNotification('Network error', 'error');
            } finally {
                hideLoading();
            }
        }

        document.getElementById('confirmPurchaseBtn').addEventListener('click', confirmPurchase);
        
        // ============================================
        // RESELL FUNCTIONS
        // ============================================
        
        function showResellModal(product) {
            currentResellProduct = product;
            const resellLink = `${window.location.origin}/product/${product.id}?ref=${currentUser.referralCode}`;
            document.getElementById('resellLink').value = resellLink;
            document.getElementById('resellCommissionPercent').innerText = product.commissionRate || 10;
            document.getElementById('resellModal').classList.add('active');
        }

        function copyResellLink() {
            const link = document.getElementById('resellLink');
            link.select();
            copyToClipboard(link.value);
        }

        // ============================================
        // TIPPING FUNCTIONS
        // ============================================
        
        function showTipModal(reelId, creatorName) {
            currentReelForTip = { id: reelId, creator: creatorName };
            document.getElementById('tipCreatorName').innerText = `Send tip to ${creatorName}`;
            document.getElementById('tipModal').classList.add('active');
        }

        async function sendTip() {
            if (!currentReelForTip) return;
            const amount = parseFloat(document.getElementById('tipAmount').value);
            if (!amount || amount < 10) {
                showNotification('Minimum tip is KES 10', 'error');
                return;
            }
            if (currentUser.earnings_balance < amount) {
                showNotification('Insufficient balance', 'error');
                closeModal('tipModal');
                showDepositModal();
                return;
            }

            showLoading();
            try {
                const response = await fetch(`${API_BASE_URL}/reels/${currentReelForTip.id}/tip`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ amount })
                });
                const data = await response.json();
                if (data.success) {
                    showNotification(`Tip of KES ${amount} sent!`, 'success');
                    closeModal('tipModal');
                    // Update balance
                    const userRes = await apiRequest('/auth/profile');
                    if (userRes) {
                        currentUser = userRes.user;
                        localStorage.setItem('sokoplus_user', JSON.stringify(currentUser));
                        document.getElementById('walletBalance').innerText = formatPrice(currentUser.earnings_balance);
                    }
                } else {
                    showNotification(data.message || 'Tip failed', 'error');
                }
            } catch (error) {
                console.error('Tip error:', error);
                showNotification('Network error', 'error');
            } finally {
                hideLoading();
            }
        }

        // ============================================
        // SHOP RATING FUNCTIONS
        // ============================================
        
        let selectedRating = 0;

        function showRatingModal(shopId) {
            currentShopForRating = shopId;
            selectedRating = 0;
            document.querySelectorAll('#ratingModal .star').forEach(star => star.classList.add('inactive'));
            document.getElementById('ratingComment').value = '';
            document.getElementById('ratingModal').classList.add('active');
        }

        function setRating(rating) {
            selectedRating = rating;
            document.querySelectorAll('#ratingModal .star').forEach((star, index) => {
                if (index < rating) {
                    star.classList.remove('inactive');
                } else {
                    star.classList.add('inactive');
                }
            });
        }

        async function submitRating() {
            if (!currentShopForRating || selectedRating === 0) {
                showNotification('Please select a rating', 'error');
                return;
            }
            const comment = document.getElementById('ratingComment').value;

            showLoading();
            try {
                const response = await fetch(`${API_BASE_URL}/shops/${currentShopForRating}/rate`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: JSON.stringify({ rating: selectedRating, comment })
                });
                const data = await response.json();
                if (data.success) {
                    showNotification('Rating submitted!', 'success');
                    closeModal('ratingModal');
                } else {
                    showNotification(data.message || 'Rating failed', 'error');
                }
            } catch (error) {
                console.error('Rating error:', error);
                showNotification('Network error', 'error');
            } finally {
                hideLoading();
            }
        }

        // ============================================
        // ADS POPUP
        // ============================================
        
        async function loadAdsPopup() {
            try {
                const response = await apiRequest('/ads/active?limit=1');
                if (response && response.ads && response.ads.length > 0) {
                    const ad = response.ads[0];
                    const popup = document.getElementById('adPopup');
                    const content = document.getElementById('adPopupContent');
                    content.innerHTML = `
                        <img src="${ad.image}" alt="${escapeHtml(ad.title)}" class="ad-popup-image">
                        <h3>${escapeHtml(ad.title)}</h3>
                        <p>${escapeHtml(ad.description)}</p>
                        ${ad.offer ? `<p style="color: var(--whatsapp-green);">${escapeHtml(ad.offer)}</p>` : ''}
                        <a href="${ad.url}" target="_blank" class="btn btn-primary w-full">Learn More</a>
                    `;
                    popup.classList.add('active');
                    setTimeout(closeAdPopup, 10000); // Auto close after 10 seconds
                }
            } catch (error) {
                console.error('Error loading ad popup:', error);
            }
        }

        function closeAdPopup() {
            document.getElementById('adPopup').classList.remove('active');
        }

        // Trigger popup on page load if user is logged in (home or dashboard)
        function maybeShowAdPopup() {
            if (currentUser && (document.getElementById('home').classList.contains('active') || document.getElementById('dashboard').classList.contains('active'))) {
                loadAdsPopup();
            }
        }

        // Call after page change
        setInterval(maybeShowAdPopup, 60000); // Check every minute, but popup will only show if new ad available
        
        // ============================================
        // AUTHENTICATION FUNCTIONS
        // ============================================
        
        function checkAuth() {
            if (!authToken && !window.location.href.includes('register') && !window.location.href.includes('login')) {
                showPage('home');
            }
        }
        
        async function loginUser(email, password) {
            try {
                const response = await fetch(`${API_BASE_URL}/auth/login`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ email, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    currentUser = data.user;
                    authToken = data.token;
                    localStorage.setItem('sokoplus_token', authToken);
                    if (currentUser && typeof currentUser.subscription_active !== 'undefined') {
                        currentUser.subscription = {
                            active: currentUser.subscription_active,
                            expiresAt: currentUser.subscription_expires_at
                        };
                    }
                    if (!currentUser.accountType) {
                        currentUser.accountType = currentUser.business_name ? 'company' : 'individual';
                    }
                    localStorage.setItem('sokoplus_user', JSON.stringify(currentUser));
                    selectedPaymentMethod = currentUser.paymentMethod || 'automatic';
                    
                    showNotification('Login successful!', 'success');
                    showPage('dashboard');
                    return true;
                } else {
                    showNotification(data.message || 'Login failed', 'error');
                    return false;
                }
            } catch (error) {
                console.error('Login error:', error);
                showNotification('Network error. Please try again.', 'error');
                return false;
            }
        }
        
        async function registerUser(userData) {
            try {
                const response = await fetch(`${API_BASE_URL}/auth/register`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(userData)
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showNotification('Registration successful! Please login.', 'success');
                    showPage('login');
                    return true;
                } else {
                    showNotification(data.message || 'Registration failed', 'error');
                    return false;
                }
            } catch (error) {
                console.error('Registration error:', error);
                showNotification('Network error. Please try again.', 'error');
                return false;
            }
        }
        
        function logout() {
            currentUser = null;
            authToken = null;
            localStorage.removeItem('sokoplus_token');
            localStorage.removeItem('sokoplus_user');
            showNotification('Logged out successfully', 'success');
            showPage('home');
        }
        
        // ============================================
        // NAVIGATION & UI FUNCTIONS
        // ============================================
        
        function showPage(pageName) {
            const mobileBtn = document.getElementById('mobileMenuBtn');
            const navMenu = document.getElementById('navMenu');
            
            if (mobileBtn && navMenu) {
                mobileBtn.classList.remove('active');
                navMenu.classList.remove('active');
            }
            
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            
            updateNavigation(pageName);
            
            const page = document.getElementById(pageName);
            if (page) {
                page.classList.add('active');
                loadPageContent(pageName);
            }
            
            window.scrollTo({ top: 0, behavior: 'smooth' });
            return false;
        }
        
        function updateNavigation(activePage) {
            const navLinks = document.getElementById('navLinks');
            const userSection = document.getElementById('userSection');
            const heroActions = document.getElementById('heroActions');
            
            if (!navLinks) return;
            
            if (currentUser) {
                const isAdmin = currentUser.role === 'admin';
                
                navLinks.innerHTML = `
                    <a href="#" class="nav-link ${activePage === 'home' ? 'active' : ''}" onclick="return showPage('home')">
                        <i class="fas fa-home"></i> <span data-i18n="home">Home</span>
                    </a>
                    <a href="#" class="nav-link ${activePage === 'marketplace' ? 'active' : ''}" onclick="return showPage('marketplace')">
                        <i class="fas fa-store"></i> <span data-i18n="marketplace">Marketplace</span>
                    </a>
                    <a href="#" class="nav-link ${activePage === 'create-post' ? 'active' : ''}" onclick="return showPage('create-post')">
                        <i class="fas fa-plus-circle"></i> <span data-i18n="createPost">Create Post</span>
                    </a>
                    <a href="#" class="nav-link ${activePage === 'dashboard' ? 'active' : ''}" onclick="return showPage('dashboard')">
                        <i class="fas fa-chart-line"></i> <span data-i18n="dashboard">Dashboard</span>
                    </a>
                    <a href="#" class="nav-link ${activePage === 'leaderboard' ? 'active' : ''}" onclick="return showPage('leaderboard')">
                        <i class="fas fa-trophy"></i> <span>Leaderboard</span>
                    </a>
                    ${isAdmin ? `
                        <a href="#" class="nav-link ${activePage === 'admin' ? 'active' : ''}" onclick="return showPage('admin')">
                            <i class="fas fa-shield-alt"></i> <span data-i18n="admin">Admin</span>
                        </a>
                    ` : ''}
                `;
                
                userSection.innerHTML = `
                    <div class="user-avatar" onclick="return showPage('dashboard')" title="${escapeHtml(currentUser.name)}">
                        ${currentUser.name.charAt(0).toUpperCase()}
                    </div>
                    <button class="btn btn-outline" onclick="logout()">
                        <i class="fas fa-sign-out-alt"></i> <span data-i18n="logout">Logout</span>
                    </button>
                `;
                
                if (heroActions) {
                    heroActions.innerHTML = `
                        <button class="btn btn-primary" onclick="return showPage('create-post')">
                            <i class="fas fa-plus-circle"></i> Create Post
                        </button>
                        <button class="btn btn-secondary" onclick="return showPage('dashboard')">
                            <i class="fas fa-chart-line"></i> My Dashboard
                        </button>
                        <button class="btn btn-outline" onclick="return showPage('marketplace')">
                            <i class="fas fa-search"></i> Browse
                        </button>
                    `;
                }
            } else {
                navLinks.innerHTML = `
                    <a href="#" class="nav-link ${activePage === 'home' ? 'active' : ''}" onclick="return showPage('home')">
                        <i class="fas fa-home"></i> <span data-i18n="home">Home</span>
                    </a>
                    <a href="#" class="nav-link ${activePage === 'marketplace' ? 'active' : ''}" onclick="return showPage('marketplace')">
                        <i class="fas fa-store"></i> <span data-i18n="marketplace">Marketplace</span>
                    </a>
                    <a href="#" class="nav-link ${activePage === 'register' ? 'active' : ''}" onclick="return showPage('register')">
                        <i class="fas fa-user-plus"></i> <span data-i18n="register">Register</span>
                    </a>
                    <a href="#" class="nav-link ${activePage === 'login' ? 'active' : ''}" onclick="return showPage('login')">
                        <i class="fas fa-sign-in-alt"></i> <span data-i18n="login">Login</span>
                    </a>
                `;
                
                userSection.innerHTML = `
                    <button class="btn btn-outline" onclick="return showPage('login')">
                        <i class="fas fa-sign-in-alt"></i> <span data-i18n="login">Login</span>
                    </button>
                    <button class="btn btn-primary" onclick="return showPage('register')">
                        <i class="fas fa-user-plus"></i> <span data-i18n="register">Register</span>
                    </button>
                `;
                
                if (heroActions) {
                    heroActions.innerHTML = `
                        <button class="btn btn-primary" onclick="return showPage('register')">
                            <i class="fas fa-rocket"></i> Get Started Free
                        </button>
                        <button class="btn btn-outline" onclick="return showPage('marketplace')">
                            <i class="fas fa-store"></i> Browse Marketplace
                        </button>
                        <button class="btn btn-accent" onclick="toggleChatbot()">
                            <i class="fas fa-question-circle"></i> Live Help
                        </button>
                    `;
                }
            }
        }
        
        async function loadPageContent(pageName) {
            switch(pageName) {
                case 'home':
                    await loadHomeContent();
                    break;
                case 'marketplace':
                    await loadMarketplace();
                    break;
                case 'create-post':
                    await loadCreatePost();
                    if (currentUser && currentUser.role === 'admin') {
                        document.getElementById('adminOfferFields').style.display = 'block';
                    }
                    break;
                case 'dashboard':
                    await loadDashboard();
                    break;
                case 'profile':
                    await loadProfile();
                    break;
                case 'admin':
                    await loadAdminPanel();
                    break;
                case 'register':
                    loadRegisterForm();
                    break;
                case 'login':
                    loadLoginForm();
                    break;
                case 'forgot-password':
                    loadForgotPasswordForm();
                    break;
                case 'subscribe':
                    loadSubscriptionForm();
                    break;
                case 'shop':
                    await loadShop();
                    break;
                case 'my-cvs':
                    await loadMyCVs();
                    break;
                case 'user-profile':
                    const urlParams = new URLSearchParams(window.location.search);
                    const userId = urlParams.get('id');
                    if (userId) {
                        await loadUserProfile(userId);
                    }
                    break;
                case 'boost-payment':
                    selectPaymentMethodForBoost('automatic');
                    break;
                case 'ad-payment':
                    document.getElementById('adPaymentDetails').innerHTML = `
                        <div class="automatic-payment-flow">
                            <h4 style="color: var(--white); margin-bottom: 1.5rem; text-align: center;">
                                <i class="fas fa-ad"></i> Pay for Your Ad
                            </h4>
                            <div class="payment-step">
                                <div class="step-number">1</div>
                                <div>
                                    <h5 style="color: var(--white);">Confirm Payment</h5>
                                    <p style="color: var(--light-gray);">M-Pesa STK Push sent to ${currentUser?.phone || 'your phone'}</p>
                                </div>
                            </div>
                            <div class="payment-step">
                                <div class="step-number">2</div>
                                <div>
                                    <h5 style="color: var(--white);">Enter M-Pesa PIN</h5>
                                    <p style="color: var(--light-gray);">Check your phone and enter PIN</p>
                                </div>
                            </div>
                            <div class="payment-step">
                                <div class="step-number">3</div>
                                <div>
                                    <h5 style="color: var(--white);">Ad Activated</h5>
                                    <p style="color: var(--light-gray);">Your ad will appear on homepage immediately</p>
                                </div>
                            </div>
                            <button class="btn btn-orange w-full" onclick="processAdPayment()">
                                <i class="fas fa-bolt"></i> Complete Payment
                            </button>
                        </div>
                    `;
                    break;
                case 'orders':
                    loadOrders('buyer');
                    break;
                case 'chat':
                    loadChat();
                    break;
                case 'leaderboard':
                    loadLeaderboard();
                    break;
            }
            maybeShowAdPopup();
        }
        
        // ============================================
        // UTILITY FUNCTIONS
        // ============================================
        
        function formatPrice(price) {
            return 'KES ' + parseFloat(price || 0).toLocaleString('en-KE');
        }
        
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diff = now - date;
            
            const minutes = Math.floor(diff / 60000);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (minutes < 60) return `${minutes}m ago`;
            if (hours < 24) return `${hours}h ago`;
            if (days < 7) return `${days}d ago`;
            
            return date.toLocaleDateString();
        }
        
        function formatCountdown(dateString) {
            const diff = new Date(dateString) - new Date();
            if (diff <= 0) return 'Expired';
            const days = Math.floor(diff / (1000*60*60*24));
            const hours = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
            return `${days}d ${hours}h`;
        }
        
        // Simple HTML escape to prevent XSS
        function escapeHtml(unsafe) {
            if (!unsafe) return '';
            return unsafe
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#039;");
        }
        
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `notification`;
            notification.style.background = type === 'success' ? 'var(--whatsapp-green)' : 
                                          type === 'error' ? 'var(--danger)' : 
                                          type === 'warning' ? 'var(--jumia-orange)' : 'var(--primary)';
            
            notification.innerHTML = `
                <div style="display: flex; align-items: center; gap: 0.75rem;">
                    <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : type === 'warning' ? 'exclamation-triangle' : 'info-circle'}"></i>
                    <span>${escapeHtml(message)}</span>
                </div>
            `;
            
            const container = document.getElementById('notificationContainer');
            container.appendChild(notification);
            
            // Browser notification if page not active
            if (document.visibilityState !== 'visible') {
                showBrowserNotification('SOKOPLUS', message);
            }
            
            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease';
                setTimeout(() => container.removeChild(notification), 300);
            }, 5000);
            
            if (!document.querySelector('#slideOutAnimation')) {
                const style = document.createElement('style');
                style.id = 'slideOutAnimation';
                style.textContent = `
                    @keyframes slideOut {
                        from { transform: translateX(0); opacity: 1; }
                        to { transform: translateX(100%); opacity: 0; }
                    }
                `;
                document.head.appendChild(style);
            }
        }
        
        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
            }
        }
        
        function showLoading() {
            document.getElementById('loadingSpinner').style.display = 'block';
        }
        
        function hideLoading() {
            document.getElementById('loadingSpinner').style.display = 'none';
        }
        
        // ============================================
        // API REQUEST FUNCTIONS
        // ============================================
        
        async function apiRequest(endpoint, options = {}) {
            const url = `${API_BASE_URL}${endpoint}`;
            const headers = {
                'Content-Type': 'application/json',
                ...options.headers
            };
            
            if (authToken) {
                headers['Authorization'] = `Bearer ${authToken}`;
            }
            
            showLoading();
            try {
                const response = await fetch(url, {
                    ...options,
                    headers
                });
                
                if (response.status === 401) {
                    logout();
                    showNotification('Session expired. Please login again.', 'error');
                    return null;
                }
                
                const data = await response.json();
                
                if (!response.ok) {
                    throw new Error(data.message || 'Request failed');
                }
                
                return data;
            } catch (error) {
                console.error('API Request error:', error);
                showNotification(error.message || 'Network error. Please try again.', 'error');
                return null;
            } finally {
                hideLoading();
            }
        }
        
        // ============================================
        // HOME PAGE FUNCTIONS
        // ============================================
        
        async function loadHomeContent() {
            try {
                const stats = await apiRequest('/stats');
                if (stats) {
                    updateHomeStats(stats);
                }
                
                await loadHomeTabContent('featured');
                await loadAds();
                await loadFeaturedShops();
                await loadRecentUsers();
                await loadReels();
                await loadRecommendations();
                
                selectPaymentMethod(selectedPaymentMethod);
            } catch (error) {
                console.error('Error loading home content:', error);
            }
        }

        async function loadRecommendations() {
            if (!currentUser) return;
            try {
                // Mock recommendations
                const response = { posts: [] };
                const container = document.getElementById('recommendedContent');
                if (response && response.posts && response.posts.length > 0) {
                    container.innerHTML = response.posts.map(item => {
                        if (item.type === 'product') return createProductCard(item);
                        if (item.type === 'digital') return createDigitalCard(item);
                        if (item.type === 'lesson') return createLessonCard(item);
                        if (item.type === 'service') return createServiceCard(item);
                        if (item.type === 'job') return createJobCard(item);
                        return '';
                    }).join('');
                } else {
                    container.innerHTML = '<div class="empty-state">No recommendations yet</div>';
                }
            } catch (error) {
                console.error('Error loading recommendations:', error);
            }
        }

        async function loadReels() {
            try {
                // Mock reels
                const response = { reels: [] };
                const container = document.getElementById('reelsGrid');
                if (response && response.reels && response.reels.length > 0) {
                    container.innerHTML = response.reels.map(reel => `
                        <div class="reel-card">
                            <video src="${reel.media[0]}" muted loop onmouseover="this.play()" onmouseout="this.pause();this.currentTime=0;"></video>
                            <div class="reel-views"><i class="far fa-eye"></i> ${reel.views || 0}</div>
                            <div class="reel-info">
                                <h4>${escapeHtml(reel.title)}</h4>
                                <p style="color: var(--light-gray); font-size: 0.8rem;">${reel.user?.name || 'User'}</p>
                            </div>
                            ${currentUser ? `<button class="reel-tip-btn" onclick="showTipModal('${reel.id}', '${escapeHtml(reel.user?.name)}')"><i class="fas fa-gift"></i></button>` : ''}
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<div class="empty-state">No reels yet. Be the first to upload!</div>';
                }
            } catch (error) {
                console.error('Error loading reels:', error);
            }
        }
        
        async function loadRecentUsers() {
            try {
                const response = await apiRequest('/users/recent?limit=6');
                const container = document.getElementById('recentMembers');
                if (response && response.users && response.users.length > 0) {
                    container.innerHTML = response.users.map(user => `
                        <div class="member-card" onclick="viewUserProfile('${user.id}')">
                            <div class="member-avatar">
                                ${user.profile_picture ? `<img src="${user.profile_picture}" alt="${escapeHtml(user.name)}">` : `<i class="fas fa-user"></i>`}
                            </div>
                            <h4 style="color: var(--white);">${escapeHtml(user.name)}</h4>
                            <p style="color: var(--light-gray); font-size: 0.8rem;">Joined ${formatDate(user.created_at)}</p>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = '<div class="empty-state">No recent users</div>';
                }
            } catch (error) {
                console.error('Error loading recent users:', error);
            }
        }
        
        function viewUserProfile(userId) {
            window.location.hash = `user-profile?id=${userId}`;
            showPage('user-profile');
            loadUserProfile(userId);
        }
        
        async function loadUserProfile(userId) {
            try {
                const response = await apiRequest(`/users/${userId}/profile`);
                if (response && response.user) {
                    const user = response.user;
                    const posts = response.posts || [];
                    const container = document.getElementById('userProfileContent');
                    
                    let profileHTML = `
                        <div class="user-profile-header">
                            <div class="user-profile-avatar-lg">
                                ${user.profile_picture ? `<img src="${user.profile_picture}" alt="${escapeHtml(user.name)}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">` : `<i class="fas fa-user"></i>`}
                            </div>
                            <div class="user-profile-info">
                                <h2>${escapeHtml(user.name)}</h2>
                                <div class="user-profile-meta">
                                    <span><i class="fas fa-map-marker-alt"></i> ${user.location || 'Location not set'}</span>
                                    <span><i class="fas fa-calendar-alt"></i> Joined ${formatDate(user.created_at)}</span>
                                    ${user.business_name ? `<span><i class="fas fa-store"></i> ${escapeHtml(user.business_name)}</span>` : ''}
                                </div>
                                <p style="color: var(--light-gray);">${escapeHtml(user.bio || 'No bio provided.')}</p>
                                <div style="margin-top: 1rem;">
                                    <span class="badge ${user.verified ? 'badge-success' : 'badge-info'}">
                                        ${user.verified ? 'Verified' : 'Unverified'}
                                    </span>
                                    ${user.badges ? user.badges.map(b => `<span class="badge badge-${b}">${b}</span>`).join('') : ''}
                                </div>
                            </div>
                        </div>
                    `;
                    
                    profileHTML += `
                        <div class="section-header">
                            <h2 class="section-title">${escapeHtml(user.name)}'s Posts</h2>
                        </div>
                        <div class="content-grid grid-3" id="userPostsGrid">
                            ${posts.map(post => {
                                if (post.type === 'product') return createProductCard(post);
                                if (post.type === 'social') return createSocialCard(post);
                                if (post.type === 'job') return createJobCard(post);
                                if (post.type === 'service') return createServiceCard(post);
                                if (post.type === 'proposal') return createProposalCard(post);
                                if (post.type === 'reel') return createReelCard(post);
                                return '';
                            }).join('')}
                        </div>
                    `;
                    
                    if (posts.length === 0) {
                        profileHTML += `
                            <div class="empty-state">
                                <i class="fas fa-box-open"></i>
                                <h3>No posts yet</h3>
                                <p>This user hasn't posted anything.</p>
                            </div>
                        `;
                    }
                    
                    container.innerHTML = profileHTML;
                } else {
                    document.getElementById('userProfileContent').innerHTML = '<div class="empty-state">User not found</div>';
                }
            } catch (error) {
                console.error('Error loading user profile:', error);
                showNotification('Failed to load user profile', 'error');
            }
        }
        
        async function loadFeaturedShops() {
            try {
                // Mock shops
                const response = { shops: [] };
                const shopsContainer = document.getElementById('featuredShops');
                if (response && response.shops && response.shops.length > 0) {
                    shopsContainer.innerHTML = response.shops.map(shop => `
                        <div class="shop-card" onclick="showShop('${shop.id}')">
                            <div class="shop-logo">
                                ${shop.logo ? `<img src="${shop.logo}" alt="${escapeHtml(shop.name)}">` : `<i class="fas fa-store"></i>`}
                            </div>
                            <h4 style="color: var(--white);">${escapeHtml(shop.name)}</h4>
                            <div class="shop-rating">
                                ${Array.from({length: 5}, (_, i) => `<i class="fas fa-star ${i < Math.round(shop.rating) ? '' : 'inactive'}"></i>`).join('')}
                                <span style="color: var(--light-gray); margin-left: 0.5rem;">(${shop.rating || 0})</span>
                            </div>
                        </div>
                    `).join('');
                } else {
                    shopsContainer.innerHTML = '<div class="empty-state">No shops yet</div>';
                }
            } catch (error) {
                console.error('Error loading shops:', error);
            }
        }
        
        async function loadAds() {
            try {
                const response = await apiRequest('/posts?type=ad&status=active&limit=6');
                const adsContainer = document.getElementById('sponsoredAds');
                if (response && response.posts && response.posts.length > 0) {
                    adsContainer.innerHTML = response.posts.map(ad => `
                        <div class="ad-card" onclick="window.open('${ad.target_url}', '_blank')">
                            <div class="ad-image">
                                ${ad.media && ad.media[0] ? 
                                    (ad.media[0].type?.startsWith('video/') ? 
                                        `<video src="${ad.media[0].url}" muted loop></video>` : 
                                        `<img src="${ad.media[0].url}" alt="${escapeHtml(ad.title)}">`
                                    ) : 
                                    `<img src="https://via.placeholder.com/800x400?text=Ad" alt="${escapeHtml(ad.title)}">`
                                }
                            </div>
                            <div class="ad-content">
                                ${ad.offer_title ? `<span class="ad-offer">${escapeHtml(ad.offer_title)}</span>` : ''}
                                <h3 class="ad-title">${escapeHtml(ad.title)}</h3>
                                <p class="ad-description">${escapeHtml(ad.description)}</p>
                                ${ad.offer_desc ? `<p style="color: var(--whatsapp-green); font-size: 0.8rem;">${escapeHtml(ad.offer_desc)}</p>` : ''}
                                ${ad.whatsapp ? `<p style="color: var(--light-gray); font-size: 0.8rem;"><i class="fab fa-whatsapp"></i> ${ad.whatsapp}</p>` : ''}
                                <a href="${ad.target_url}" class="ad-link" target="_blank">Learn More</a>
                            </div>
                            <div class="ad-badge">Ad</div>
                        </div>
                    `).join('');
                } else {
                    adsContainer.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-ad"></i>
                            <h3>No Ads Yet</h3>
                            <p>Be the first to advertise here</p>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading ads:', error);
            }
        }
        
        function updateHomeStats(stats) {
            document.getElementById('totalUsers').textContent = stats.totalUsers || '0';
            document.getElementById('totalPosts').textContent = stats.totalPosts || '0';
            document.getElementById('totalEarnings').textContent = formatPrice(stats.totalEarnings || 0);
            document.getElementById('activeTransactions').textContent = stats.activeTransactions || '0';
        }
        
        function filterMarketplace(category) {
            showPage('marketplace');
            setTimeout(() => {
                document.getElementById('marketplaceCategory').value = category;
                loadMarketplace();
            }, 100);
        }
        
        function showHomeTab(tabName) {
            document.querySelectorAll('#homeContentTabs .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.querySelectorAll('#homeContentTabs .tab-btn').forEach(btn => {
                if (btn.textContent.toLowerCase().includes(tabName)) {
                    btn.classList.add('active');
                }
            });
            
            document.querySelectorAll('.content-tab').forEach(tab => {
                tab.style.display = 'none';
            });
            
            const tab = document.getElementById(`${tabName}Tab`);
            if (tab) {
                tab.style.display = 'block';
                loadHomeTabContent(tabName);
            }
        }
        
        async function loadHomeTabContent(tabName) {
            try {
                let endpoint = '';
                switch(tabName) {
                    case 'featured':
                        endpoint = '/posts/featured';
                        break;
                    case 'products':
                        endpoint = '/posts?type=product&limit=6';
                        break;
                    case 'digital':
                        endpoint = '/digital-products?limit=6';
                        break;
                    case 'lessons':
                        endpoint = '/lessons?limit=6';
                        break;
                    case 'social':
                        endpoint = '/posts?type=social&limit=4';
                        break;
                    case 'jobs':
                        endpoint = '/posts?type=job&limit=6';
                        break;
                    case 'boosted':
                        endpoint = '/posts?boosted=true&limit=6';
                        break;
                    case 'proposals':
                        endpoint = '/posts?type=proposal&limit=6';
                        break;
                }
                
                const response = await apiRequest(endpoint);
                if (response) {
                    const containerId = `featured${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`;
                    const container = document.getElementById(containerId);
                    
                    if (container) {
                        container.innerHTML = (response.posts || response.products || response.lessons || []).map(item => {
                            if (item.type === 'product') return createProductCard(item);
                            if (item.type === 'digital' || item.category) return createDigitalCard(item);
                            if (item.type === 'lesson') return createLessonCard(item);
                            if (item.type === 'social') return createSocialCard(item);
                            if (item.type === 'job') return createJobCard(item);
                            if (item.type === 'service') return createServiceCard(item);
                            if (item.type === 'proposal') return createProposalCard(item);
                            if (item.type === 'reel') return createReelCard(item);
                            return '';
                        }).join('');
                        
                        if ((response.posts || response.products || response.lessons || []).length === 0) {
                            container.innerHTML = `
                                <div class="empty-state">
                                    <i class="fas fa-${tabName === 'products' ? 'box' : tabName === 'digital' ? 'book' : tabName === 'lessons' ? 'chalkboard-teacher' : tabName === 'social' ? 'users' : tabName === 'jobs' ? 'briefcase' : 'file-alt'}"></i>
                                    <h3 style="color: var(--white);">No ${tabName} posts yet</h3>
                                    <p>Be the first to create a ${tabName} post!</p>
                                </div>
                            `;
                        }
                    }
                } else if (tabName === 'digital' || tabName === 'lessons') {
                    const container = document.getElementById(`featured${tabName.charAt(0).toUpperCase() + tabName.slice(1)}`);
                    if (container) {
                        container.innerHTML = '<div class="empty-state">Coming soon!</div>';
                    }
                }
            } catch (error) {
                console.error(`Error loading ${tabName}:`, error);
            }
        }
        
        // ============================================
        // CARD CREATION FUNCTIONS (enhanced with ratings & escaping)
        // ============================================
        
        function createProductCard(post) {
            const countdownHtml = post.countdown ? `<div class="countdown">Expires in: ${formatCountdown(post.countdown)}</div>` : '';
            const ratingHtml = post.rating ? `
                <div class="star-rating">
                    ${Array.from({length: 5}, (_, i) => `<i class="fas fa-star ${i < Math.round(post.rating) ? '' : 'inactive'}"></i>`).join('')}
                    <span style="color: var(--light-gray); font-size: 0.8rem;">(${post.rating.toFixed(1)})</span>
                </div>
            ` : '';
            
            return `
                <div class="card product-card">
                    <div class="card-image">
                        ${post.images && post.images.length > 0 ? 
                            `<img src="${post.images[0]}" alt="${escapeHtml(post.title)}">` :
                            `<div style="width: 100%; height: 100%; background: linear-gradient(45deg, var(--instagram-purple), var(--instagram-pink)); display: flex; align-items: center; justify-content: center; color: var(--white); font-size: 3rem;">
                                <i class="fas fa-box"></i>
                            </div>`
                        }
                        ${post.boosted ? '<span class="boost-badge"><i class="fas fa-rocket"></i> BOOSTED</span>' : ''}
                        ${countdownHtml}
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">${escapeHtml(post.title)}</h3>
                        ${ratingHtml}
                        <div class="card-price">${formatPrice(post.price)}</div>
                        <div style="display: flex; justify-content: space-between; align-items: center; margin-top: 1rem;">
                            <span style="color: var(--light-gray); font-size: 0.875rem;">
                                <i class="fas fa-map-marker-alt"></i> ${escapeHtml(post.location || 'N/A')}
                            </span>
                            <span style="color: var(--light-gray); font-size: 0.875rem;">
                                ${post.user?.name ? escapeHtml(post.user.name) : 'User'}
                            </span>
                        </div>
                        <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                            ${currentUser && currentUser.id !== post.user_id ? `<button class="btn btn-sm btn-primary" onclick="showPurchaseModal(${JSON.stringify(post).replace(/"/g, '&quot;')})">Buy</button>` : ''}
                            ${currentUser ? `<button class="btn btn-sm btn-outline" onclick="showResellModal(${JSON.stringify(post).replace(/"/g, '&quot;')})">Resell</button>` : ''}
                            ${currentUser && currentUser.id !== post.user_id ? `<button class="btn btn-sm btn-outline" onclick="openChatWithUser('${post.user_id}')"><i class="fas fa-comment"></i> Chat</button>` : ''}
                            <button class="btn btn-sm btn-outline" onclick="sharePost('${post.id}')"><i class="fas fa-share"></i></button>
                        </div>
                        <div style="color: var(--light-gray); font-size: 0.75rem; margin-top: 0.5rem;">
                            <i class="far fa-eye"></i> ${post.views || 0} views
                        </div>
                    </div>
                </div>
            `;
        }
        
        function createDigitalCard(product) {
            return `
                <div class="card digital-card">
                    <div class="card-image">
                        ${product.cover ? 
                            `<img src="${product.cover}" alt="${escapeHtml(product.title)}" style="width: 100%; height: 100%; object-fit: cover;">` :
                            `<div style="background: linear-gradient(135deg, var(--instagram-purple), var(--instagram-pink)); width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; color: white; font-size: 3rem;"><i class="fas fa-book"></i></div>`
                        }
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">${escapeHtml(product.title)}</h3>
                        <div class="card-price">${formatPrice(product.price)}</div>
                        <p style="color: var(--light-gray); font-size: 0.8rem;">by ${product.seller?.name ? escapeHtml(product.seller.name) : 'Unknown'}</p>
                        <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                            ${currentUser && currentUser.id !== product.seller_id ? `<button class="btn btn-sm btn-primary" onclick="showPurchaseModal(${JSON.stringify(product).replace(/"/g, '&quot;')})">Buy</button>` : ''}
                            ${currentUser ? `<button class="btn btn-sm btn-outline" onclick="showResellModal(${JSON.stringify(product).replace(/"/g, '&quot;')})">Resell</button>` : ''}
                        </div>
                    </div>
                </div>
            `;
        }

        function createLessonCard(lesson) {
            return `
                <div class="card lesson-card">
                    <div class="card-image">
                        <img src="${lesson.thumbnail}" alt="${escapeHtml(lesson.title)}">
                        ${lesson.type === 'playlist' ? '<span class="playlist-badge">Playlist</span>' : ''}
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">${escapeHtml(lesson.title)}</h3>
                        <div class="card-price">${formatPrice(lesson.price)}</div>
                        <p style="color: var(--light-gray); font-size: 0.8rem;">by ${lesson.instructor?.name ? escapeHtml(lesson.instructor.name) : 'Unknown'}</p>
                        <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                            ${currentUser && currentUser.id !== lesson.instructor_id ? `<button class="btn btn-sm btn-primary" onclick="showPurchaseModal(${JSON.stringify(lesson).replace(/"/g, '&quot;')})">Buy</button>` : ''}
                            ${currentUser ? `<button class="btn btn-sm btn-outline" onclick="showResellModal(${JSON.stringify(lesson).replace(/"/g, '&quot;')})">Resell</button>` : ''}
                        </div>
                    </div>
                </div>
            `;
        }
        
        function createSocialCard(post) {
            const content = post.content.length > 150 ? post.content.substring(0, 150) + '...' : post.content;
            
            return `
                <div class="card social-card">
                    <div class="card-header">
                        ${post.user?.profile_picture ? 
                            `<img src="${post.user.profile_picture}" alt="${escapeHtml(post.user.name)}" style="width: 40px; height: 40px; border-radius: 50%; object-fit: cover;">` :
                            `<div class="user-avatar-sm">
                                ${post.user?.name?.charAt(0)?.toUpperCase() || 'U'}
                            </div>`
                        }
                        <div>
                            <div style="font-weight: 600; color: var(--white);">${escapeHtml(post.user?.name || 'User')}</div>
                            <div style="color: var(--light-gray); font-size: 0.875rem;">
                                ${formatDate(post.created_at)}
                            </div>
                        </div>
                    </div>
                    <div class="post-content">
                        <p>${escapeHtml(content)}</p>
                        ${post.images && post.images.length > 0 ? 
                            `<div style="margin-top: 1rem; display: grid; grid-template-columns: repeat(2, 1fr); gap: 0.5rem;">
                                ${post.images.slice(0, 2).map(image => 
                                    `<img src="${image}" alt="Post media" style="width: 100%; height: 100px; object-fit: cover; border-radius: var(--radius);">`
                                ).join('')}
                                ${post.images.length > 2 ? 
                                    `<div style="background: var(--dark); border-radius: var(--radius); display: flex; align-items: center; justify-content: center; color: var(--light-gray);">
                                        +${post.images.length - 2} more
                                    </div>` : ''
                                }
                            </div>` : ''
                        }
                    </div>
                    <div class="post-actions">
                        <button class="post-action" onclick="likePost('${post.id}')">
                            <i class="far fa-heart"></i> ${post.likes || 0}
                        </button>
                        <button class="post-action" onclick="sharePost('${post.id}')">
                            <i class="fas fa-share"></i> Share
                        </button>
                        ${post.boosted ? 
                            `<span class="badge badge-secondary" style="font-size: 0.75rem;">
                                <i class="fas fa-rocket"></i> Boosted
                            </span>` : ''
                        }
                    </div>
                </div>
            `;
        }
        
        function createJobCard(post) {
            return `
                <div class="card job-card">
                    <div class="card-header">
                        <span class="job-type">${post.jobType?.toUpperCase() || 'FULL-TIME'}</span>
                        <h3 class="card-title">${escapeHtml(post.title)}</h3>
                        <div style="color: var(--light-gray); font-size: 0.875rem; margin-top: 0.5rem;">
                            <i class="fas fa-building"></i> ${escapeHtml(post.company || '')}
                        </div>
                    </div>
                    <div class="card-content">
                        <p style="color: var(--light-gray); margin-bottom: 1rem;">
                            ${post.description?.length > 100 ? escapeHtml(post.description.substring(0, 100)) + '...' : escapeHtml(post.description || '')}
                        </p>
                        <div class="job-salary">
                            ${formatPrice(post.salaryMin)} - ${formatPrice(post.salaryMax)}
                        </div>
                        <div style="color: var(--light-gray); font-size: 0.875rem;">
                            <i class="fas fa-map-marker-alt"></i> ${escapeHtml(post.location || '')}
                        </div>
                        <div style="color: var(--light-gray); font-size: 0.75rem; margin-top: 0.5rem;">
                            <i class="far fa-eye"></i> ${post.views || 0} views
                        </div>
                    </div>
                </div>
            `;
        }
        
        function createServiceCard(post) {
            return `
                <div class="card product-card">
                    <div class="card-image">
                        <div style="width: 100%; height: 100%; background: linear-gradient(45deg, var(--glovo-teal), var(--glovo-teal-dark)); display: flex; align-items: center; justify-content: center; color: var(--white); font-size: 3rem;">
                            <i class="fas fa-concierge-bell"></i>
                        </div>
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">${escapeHtml(post.title)}</h3>
                        <div class="card-price">${formatPrice(post.priceMin)} - ${formatPrice(post.priceMax)}</div>
                        <div style="color: var(--light-gray); font-size: 0.875rem; margin: 0.5rem 0;">
                            <i class="fas fa-map-marker-alt"></i> ${escapeHtml(post.location || '')}
                        </div>
                        <div style="color: var(--light-gray); font-size: 0.75rem;">
                            <i class="far fa-eye"></i> ${post.views || 0} views
                        </div>
                    </div>
                </div>
            `;
        }

        function createProposalCard(post) {
            return `
                <div class="card proposal-card">
                    <div class="proposal-title">${escapeHtml(post.title)}</div>
                    <div class="proposal-budget">Budget: ${formatPrice(post.budget || 0)}</div>
                    <p style="color: var(--light-gray);">${post.description?.substring(0, 100) ? escapeHtml(post.description.substring(0, 100)) + '...' : ''}</p>
                    <div style="color: var(--light-gray); font-size: 0.75rem;">
                        ${formatDate(post.created_at)}
                    </div>
                </div>
            `;
        }

        function createReelCard(reel) {
            return `
                <div class="card product-card">
                    <div class="card-image" style="height: 300px;">
                        <video src="${reel.media[0]}" style="width: 100%; height: 100%; object-fit: cover;"></video>
                    </div>
                    <div class="card-content">
                        <h3 class="card-title">${escapeHtml(reel.title)}</h3>
                        <div style="color: var(--light-gray); font-size: 0.75rem;">
                            <i class="far fa-eye"></i> ${reel.views || 0} views
                        </div>
                    </div>
                </div>
            `;
        }
        
        // ============================================
        // MARKETPLACE FUNCTIONS
        // ============================================
        
        async function loadMarketplace(page = 1) {
            const search = document.getElementById('marketplaceSearch')?.value || '';
            const category = document.getElementById('marketplaceCategory')?.value || '';
            const sort = document.getElementById('marketplaceSort')?.value || 'newest';
            
            let endpoint = `/posts?page=${page}&limit=12`;
            
            if (search) endpoint += `&search=${encodeURIComponent(search)}`;
            if (category) endpoint += `&category=${category}`;
            if (sort) endpoint += `&sort=${sort}`;
            
            try {
                const response = await apiRequest(endpoint);
                if (response) {
                    const container = document.getElementById('marketplaceContent');
                    if (container) {
                        container.innerHTML = response.posts.map(post => {
                            if (post.type === 'product') return createProductCard(post);
                            if (post.type === 'digital') return createDigitalCard(post);
                            if (post.type === 'lesson') return createLessonCard(post);
                            if (post.type === 'social') return createSocialCard(post);
                            if (post.type === 'job') return createJobCard(post);
                            if (post.type === 'service') return createServiceCard(post);
                            if (post.type === 'ad') return createAdCard(post);
                            if (post.type === 'proposal') return createProposalCard(post);
                            if (post.type === 'reel') return createReelCard(post);
                            return '';
                        }).join('');
                        
                        if (response.posts.length === 0) {
                            container.innerHTML = `
                                <div class="empty-state">
                                    <i class="fas fa-search"></i>
                                    <h3 style="color: var(--white);">No posts found</h3>
                                    <p>Try changing your search criteria</p>
                                </div>
                            `;
                        }
                    }
                    
                    if (response.pagination) {
                        updatePagination(response.pagination.pages, response.pagination.page);
                    }
                }
            } catch (error) {
                console.error('Error loading marketplace:', error);
            }
        }
        
        function createAdCard(ad) {
            return `
                <div class="ad-card" onclick="window.open('${ad.target_url}', '_blank')">
                    <div class="ad-image">
                        ${ad.media && ad.media[0] ? 
                            (ad.media[0].type?.startsWith('video/') ? 
                                `<video src="${ad.media[0].url}" muted loop></video>` : 
                                `<img src="${ad.media[0].url}" alt="${escapeHtml(ad.title)}">`
                            ) : 
                            `<img src="https://via.placeholder.com/800x400?text=Ad" alt="${escapeHtml(ad.title)}">`
                        }
                    </div>
                    <div class="ad-content">
                        ${ad.offer_title ? `<span class="ad-offer">${escapeHtml(ad.offer_title)}</span>` : ''}
                        <h3 class="ad-title">${escapeHtml(ad.title)}</h3>
                        <p class="ad-description">${escapeHtml(ad.description)}</p>
                        ${ad.offer_desc ? `<p style="color: var(--whatsapp-green); font-size: 0.8rem;">${escapeHtml(ad.offer_desc)}</p>` : ''}
                        ${ad.whatsapp ? `<p style="color: var(--light-gray); font-size: 0.8rem;"><i class="fab fa-whatsapp"></i> ${ad.whatsapp}</p>` : ''}
                        <a href="${ad.target_url}" class="ad-link" target="_blank">Learn More</a>
                    </div>
                    <div class="ad-badge">Ad</div>
                </div>
            `;
        }
        
        function updatePagination(totalPages, currentPage) {
            const container = document.getElementById('marketplacePagination');
            if (!container) return;
            
            container.innerHTML = '';
            
            if (totalPages <= 1) return;
            
            if (currentPage > 1) {
                const prevBtn = document.createElement('button');
                prevBtn.className = 'btn btn-outline btn-sm';
                prevBtn.innerHTML = '<i class="fas fa-chevron-left"></i>';
                prevBtn.onclick = () => loadMarketplace(currentPage - 1);
                container.appendChild(prevBtn);
            }
            
            for (let i = 1; i <= totalPages; i++) {
                if (i === 1 || i === totalPages || (i >= currentPage - 2 && i <= currentPage + 2)) {
                    const pageBtn = document.createElement('button');
                    pageBtn.className = `btn btn-sm ${i === currentPage ? 'btn-primary' : 'btn-outline'}`;
                    pageBtn.textContent = i;
                    pageBtn.onclick = () => loadMarketplace(i);
                    container.appendChild(pageBtn);
                } else if (i === currentPage - 3 || i === currentPage + 3) {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'btn btn-sm btn-outline';
                    ellipsis.textContent = '...';
                    ellipsis.style.cursor = 'default';
                    container.appendChild(ellipsis);
                }
            }
            
            if (currentPage < totalPages) {
                const nextBtn = document.createElement('button');
                nextBtn.className = 'btn btn-outline btn-sm';
                nextBtn.innerHTML = '<i class="fas fa-chevron-right"></i>';
                nextBtn.onclick = () => loadMarketplace(currentPage + 1);
                container.appendChild(nextBtn);
            }
        }
        
        // ============================================
        // POST CREATION FUNCTIONS
        // ============================================
        
        function showPostForm(formType) {
            document.querySelectorAll('.post-form').forEach(form => {
                form.classList.remove('active');
            });
            document.querySelectorAll('.post-tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            document.getElementById(`${formType}Form`).classList.add('active');
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            }
        }
        
        function previewMedia(inputId, previewId) {
            const input = document.getElementById(inputId);
            const preview = document.getElementById(previewId);
            preview.innerHTML = '';
            
            Array.from(input.files).forEach((file, index) => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const mediaDiv = document.createElement('div');
                    mediaDiv.className = 'media-preview';
                    
                    if (file.type.startsWith('image/')) {
                        mediaDiv.innerHTML = `
                            <img src="${e.target.result}" alt="Preview">
                            <button class="remove-media" onclick="removeMedia(${index}, '${inputId}')">×</button>
                        `;
                    } else if (file.type.startsWith('video/')) {
                        mediaDiv.innerHTML = `
                            <video controls>
                                <source src="${e.target.result}" type="${file.type}">
                            </video>
                            <button class="remove-media" onclick="removeMedia(${index}, '${inputId}')">×</button>
                        `;
                    }
                    
                    preview.appendChild(mediaDiv);
                };
                reader.readAsDataURL(file);
            });
        }
        
        function removeMedia(index, inputId) {
            const input = document.getElementById(inputId);
            const dt = new DataTransfer();
            
            Array.from(input.files).forEach((file, i) => {
                if (i !== index) dt.items.add(file);
            });
            
            input.files = dt.files;
            previewMedia(inputId, inputId + 'Preview');
        }
        
        function previewCV() {
            const fileInput = document.getElementById('cvFile');
            const preview = document.getElementById('cvPreview');
            
            if (fileInput.files.length > 0) {
                const file = fileInput.files[0];
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    preview.innerHTML = `
                        <i class="fas fa-file-pdf"></i>
                        <h4>${escapeHtml(file.name)}</h4>
                        <p>${(file.size / 1024 / 1024).toFixed(2)} MB</p>
                        <small style="color: var(--light-gray);">Ready to upload</small>
                    `;
                };
                
                reader.readAsDataURL(file);
            }
        }
        
        async function createProductPost() {
            if (!currentUser) {
                showNotification('Please login to create a post', 'error');
                showPage('login');
                return;
            }
            
            if (currentUser.status !== 'active') {
                showNotification('Your account is deactivated. Please contact admin or subscribe again.', 'error');
                return;
            }
            
            if (!currentUser.subscription?.active) {
                showNotification('You need an active subscription to post. Please subscribe first.', 'error');
                showPage('subscribe');
                return;
            }
            
            const postData = {
                type: 'product',
                title: document.getElementById('productTitle').value,
                description: document.getElementById('productDescription').value,
                price: parseInt(document.getElementById('productPrice').value),
                category: document.getElementById('productCategory').value,
                location: document.getElementById('productLocation').value,
                whatsapp: document.getElementById('productWhatsapp').value,
                boosted: document.getElementById('boostProduct').checked,
                countdown: document.getElementById('productCountdown').value || null
            };
            
            try {
                const response = await apiRequest('/posts', {
                    method: 'POST',
                    body: JSON.stringify(postData)
                });
                
                if (response) {
                    showNotification('Product posted successfully!', 'success');
                    
                    const files = document.getElementById('productMedia').files;
                    if (files.length > 0) {
                        await uploadPostMedia(response.post.id, files);
                    }
                    
                    if (document.getElementById('boostProduct').checked) {
                        showPage('boost-payment');
                    } else {
                        showPage('dashboard');
                    }
                }
            } catch (error) {
                console.error('Error creating product post:', error);
            }
        }
        
        async function createSocialPost() {
            if (!currentUser) return;
            
            if (currentUser.status !== 'active') {
                showNotification('Your account is deactivated. Please contact admin or subscribe again.', 'error');
                return;
            }
            
            if (!currentUser.subscription?.active) {
                showNotification('You need an active subscription to post. Please subscribe first.', 'error');
                showPage('subscribe');
                return;
            }
            
            const postData = {
                type: 'social',
                content: document.getElementById('socialContent').value,
                boosted: document.getElementById('boostSocial').checked
            };
            
            try {
                const response = await apiRequest('/posts', {
                    method: 'POST',
                    body: JSON.stringify(postData)
                });
                
                if (response) {
                    showNotification('Social post created successfully!', 'success');
                    
                    const files = document.getElementById('socialMedia').files;
                    if (files.length > 0) {
                        await uploadPostMedia(response.post.id, files);
                    }
                    
                    if (document.getElementById('boostSocial').checked) {
                        showPage('boost-payment');
                    } else {
                        showPage('dashboard');
                    }
                }
            } catch (error) {
                console.error('Error creating social post:', error);
            }
        }
        
        async function createJobPost() {
            if (!currentUser) return;
            
            if (currentUser.status !== 'active') {
                showNotification('Your account is deactivated. Please contact admin or subscribe again.', 'error');
                return;
            }
            
            if (!currentUser.subscription?.active) {
                showNotification('You need an active subscription to post. Please subscribe first.', 'error');
                showPage('subscribe');
                return;
            }
            
            const postData = {
                type: 'job',
                title: document.getElementById('jobTitle').value,
                company: document.getElementById('jobCompany').value,
                description: document.getElementById('jobDescription').value,
                jobType: document.getElementById('jobType').value,
                salaryMin: parseInt(document.getElementById('jobSalaryMin').value),
                salaryMax: parseInt(document.getElementById('jobSalaryMax').value),
                location: document.getElementById('jobLocation').value,
                whatsapp: document.getElementById('jobWhatsapp').value,
                applyLink: document.getElementById('jobApply').value,
                boosted: document.getElementById('boostJob').checked
            };
            
            try {
                const response = await apiRequest('/posts', {
                    method: 'POST',
                    body: JSON.stringify(postData)
                });
                
                if (response) {
                    showNotification('Job posted successfully!', 'success');
                    
                    const files = document.getElementById('jobMedia').files;
                    if (files.length > 0) {
                        await uploadPostMedia(response.post.id, files);
                    }
                    
                    if (document.getElementById('boostJob').checked) {
                        showPage('boost-payment');
                    } else {
                        showPage('dashboard');
                    }
                }
            } catch (error) {
                console.error('Error creating job post:', error);
            }
        }
        
        async function createServicePost() {
            if (!currentUser) return;
            
            if (currentUser.status !== 'active') {
                showNotification('Your account is deactivated. Please contact admin or subscribe again.', 'error');
                return;
            }
            
            if (!currentUser.subscription?.active) {
                showNotification('You need an active subscription to post. Please subscribe first.', 'error');
                showPage('subscribe');
                return;
            }
            
            const postData = {
                type: 'service',
                title: document.getElementById('serviceTitle').value,
                description: document.getElementById('serviceDescription').value,
                category: document.getElementById('serviceCategory').value,
                priceMin: parseInt(document.getElementById('servicePriceMin').value),
                priceMax: parseInt(document.getElementById('servicePriceMax').value),
                location: document.getElementById('serviceLocation').value,
                whatsapp: document.getElementById('serviceWhatsapp').value
            };
            
            try {
                const response = await apiRequest('/posts', {
                    method: 'POST',
                    body: JSON.stringify(postData)
                });
                
                if (response) {
                    showNotification('Service listed successfully!', 'success');
                    
                    const files = document.getElementById('serviceMedia').files;
                    if (files.length > 0) {
                        await uploadPostMedia(response.post.id, files);
                    }
                    
                    showPage('dashboard');
                }
            } catch (error) {
                console.error('Error creating service post:', error);
            }
        }
        
        async function uploadPostMedia(postId, files) {
            const formData = new FormData();
            Array.from(files).forEach(file => {
                formData.append('files', file);
            });
            
            try {
                const response = await fetch(`${API_BASE_URL}/upload/multiple`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                
                const data = await response.json();
                if (response.ok && data.files) {
                    // Attach media URLs to post
                    const mediaUrls = data.files.map(f => f.url);
                    await apiRequest(`/posts/${postId}/attach-media`, {
                        method: 'PUT',
                        body: JSON.stringify({ media: mediaUrls })
                    });
                } else {
                    throw new Error('Failed to upload images');
                }
            } catch (error) {
                console.error('Error uploading images:', error);
                showNotification('Post created but images failed to upload', 'warning');
            }
        }
        
        async function uploadCV() {
            if (!currentUser) {
                showNotification('Please login to upload CV', 'error');
                showPage('login');
                return;
            }
            
            if (currentUser.status !== 'active') {
                showNotification('Your account is deactivated. Please contact admin or subscribe again.', 'error');
                return;
            }
            
            const fileInput = document.getElementById('cvFile');
            if (fileInput.files.length === 0) {
                showNotification('Please select a CV file', 'error');
                return;
            }
            
            const formData = new FormData();
            formData.append('cv', fileInput.files[0]);
            formData.append('title', document.getElementById('cvTitle').value);
            formData.append('summary', document.getElementById('cvSummary').value);
            formData.append('skills', document.getElementById('cvSkills').value);
            formData.append('experience', document.getElementById('cvExperience').value);
            formData.append('salary', document.getElementById('cvSalary').value);
            formData.append('location', document.getElementById('cvLocation').value);
            
            try {
                const response = await fetch(`${API_BASE_URL}/cvs`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    showNotification('CV uploaded successfully!', 'success');
                    showPage('my-cvs');
                } else {
                    showNotification(data.message || 'Failed to upload CV', 'error');
                }
            } catch (error) {
                console.error('Error uploading CV:', error);
                showNotification('Network error. Please try again.', 'error');
            }
        }
        
        // ============================================
        // DASHBOARD FUNCTIONS
        // ============================================
        
        async function loadDashboard() {
            if (!currentUser) {
                showNotification('Please login to view dashboard', 'error');
                showPage('login');
                return;
            }
            
            try {
                const stats = await apiRequest('/users/stats');
                if (stats) {
                    updateDashboardStats(stats);
                }
                
                updateProfileHeader();
                updateReferralLink();
                selectPaymentMethod(selectedPaymentMethod);
                showDashboardTab('myProducts');
                
                await loadReferralProgress();
                await loadBonusStatus();
                document.getElementById('walletBalance').innerText = formatPrice(currentUser.earnings_balance || 0);
                document.getElementById('resellCommission').innerText = formatPrice(stats.resellCommission || 0);
                loadUnreadChatCount();
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        async function loadReferralProgress() {
            try {
                const response = await apiRequest('/referrals/stats');
                if (response) {
                    const weekly = response.weeklyReferrals || 0;
                    const weeklyBoosts = response.weeklyBoosts || 0;
                    document.getElementById('weeklyReferrals').textContent = weekly;
                    document.getElementById('weeklyBoosts').textContent = weeklyBoosts;
                    document.getElementById('weeklyProgress').style.width = `${Math.min(weekly/20*100, 100)}%`;
                    document.getElementById('weeklyBoostProgress').style.width = `${Math.min(weeklyBoosts/20*100, 100)}%`;
                }
            } catch (error) {
                console.error('Error loading referral progress:', error);
            }
        }

        async function loadBonusStatus() {
            try {
                const response = await apiRequest('/user/bonus-status');
                if (response && response.success) {
                    document.getElementById('bonusReelViews').textContent = response.reelViews;
                    document.getElementById('bonusMonthlyReferrals').textContent = response.monthlyReferrals;
                    const viewsPercent = Math.min((response.reelViews / 1500) * 100, 100);
                    const refPercent = Math.min((response.monthlyReferrals / 360) * 100, 100);
                    document.getElementById('bonusViewsProgress').style.width = viewsPercent + '%';
                    document.getElementById('bonusReferralsProgress').style.width = refPercent + '%';

                    const statusEl = document.getElementById('bonusStatus');
                    if (response.bonusEarned) {
                        statusEl.innerHTML = '<span class="badge badge-success">Bonus already claimed!</span>';
                    } else if (response.canEarn) {
                        statusEl.innerHTML = '<span class="badge badge-success">You have qualified! Please contact admin to claim KES 10,000.</span>';
                    } else {
                        statusEl.innerHTML = 'Keep going to earn KES 10,000!';
                    }
                }
            } catch (error) {
                console.error('Error loading bonus status:', error);
            }
        }
        
        function updateDashboardStats(stats) {
            document.getElementById('myProductsCount').textContent = stats.productsCount || 0;
            document.getElementById('myJobsCount').textContent = stats.jobsCount || 0;
            document.getElementById('myEarnings').textContent = formatPrice(stats.availableBalance || 0);
            document.getElementById('totalViews').textContent = stats.totalViews || 0;
            document.getElementById('dashboardTotalReferrals').textContent = stats.totalReferrals || 0;
            document.getElementById('earnedAmount').textContent = formatPrice(stats.totalEarned || 0);
            document.getElementById('withdrawnAmount').textContent = formatPrice(stats.totalWithdrawn || 0);
            document.getElementById('myAdsCount').textContent = stats.adsCount || 0;
        }
        
        function updateProfileHeader() {
            if (currentUser) {
                document.getElementById('profileName').textContent = currentUser.name;
                document.getElementById('profileEmail').textContent = currentUser.email;
                document.getElementById('profilePhone').textContent = currentUser.phone;
                
                const avatar = document.getElementById('profileAvatar');
                if (currentUser.profile_picture) {
                    avatar.innerHTML = `<img src="${currentUser.profile_picture}" alt="${escapeHtml(currentUser.name)}" style="width: 100%; height: 100%; border-radius: 50%; object-fit: cover;">`;
                } else {
                    avatar.textContent = currentUser.name.charAt(0).toUpperCase();
                }
                
                const status = document.getElementById('profileStatus');
                status.innerHTML = `
                    <span class="badge ${currentUser.subscription?.active ? 'badge-success' : 'badge-warning'}">
                        ${currentUser.subscription?.active ? 'Active Subscription' : 'No Subscription'}
                    </span>
                    <span class="badge ${currentUser.status === 'active' ? 'badge-success' : 'badge-danger'} ml-2">
                        ${currentUser.status === 'active' ? 'Active' : 'Deactivated'}
                    </span>
                    ${currentUser.verified ? '<span class="badge badge-info ml-2">Verified</span>' : ''}
                    ${currentUser.upgraded ? '<span class="badge badge-secondary ml-2">Premium</span>' : ''}
                `;

                const accountTypeEl = document.getElementById('profileAccountType');
                if (currentUser.accountType === 'company') {
                    accountTypeEl.textContent = 'Company Account';
                    accountTypeEl.style.display = 'inline-block';
                } else {
                    accountTypeEl.textContent = 'Individual Account';
                    accountTypeEl.style.display = 'inline-block';
                }
            }
        }
        
        function showDashboardTab(tabName) {
            document.querySelectorAll('.dashboard-tab').forEach(tab => {
                tab.style.display = 'none';
            });
            document.querySelectorAll('.content-tabs .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const tab = document.getElementById(`${tabName}Tab`);
            if (tab) tab.style.display = 'block';
            
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            }
            loadDashboardTabContent(tabName);
        }
        
        async function loadDashboardTabContent(tabName) {
            try {
                let endpoint = '';
                switch(tabName) {
                    case 'myProducts':
                        endpoint = `/posts?userId=${currentUser.id}&type=product`;
                        break;
                    case 'myDigital':
                        endpoint = `/digital-products?user_id=${currentUser.id}`;
                        break;
                    case 'myLessons':
                        endpoint = `/lessons?user_id=${currentUser.id}`;
                        break;
                    case 'myServices':
                        endpoint = `/posts?userId=${currentUser.id}&type=service`;
                        break;
                    case 'mySocial':
                        endpoint = `/posts?userId=${currentUser.id}&type=social`;
                        break;
                    case 'myJobs':
                        endpoint = `/posts?userId=${currentUser.id}&type=job`;
                        break;
                    case 'myBoosted':
                        endpoint = `/posts?userId=${currentUser.id}&boosted=true`;
                        break;
                    case 'myAds':
                        endpoint = `/posts?userId=${currentUser.id}&type=ad`;
                        break;
                    case 'myProposals':
                        endpoint = `/posts?userId=${currentUser.id}&type=proposal`;
                        break;
                    case 'myReels':
                        endpoint = `/posts?userId=${currentUser.id}&type=reel`;
                        break;
                    case 'orders':
                        endpoint = `/orders?user_id=${currentUser.id}`;
                        break;
                }
                
                const response = await apiRequest(endpoint);
                if (response) {
                    const container = document.getElementById(`${tabName}Grid`);
                    if (container) {
                        container.innerHTML = (response.posts || response.products || response.lessons || response.orders || []).map(item => {
                            if (item.type === 'product') return createProductCard(item);
                            if (item.type === 'digital' || item.category) return createDigitalCard(item);
                            if (item.type === 'lesson') return createLessonCard(item);
                            if (item.type === 'social') return createSocialCard(item);
                            if (item.type === 'job') return createJobCard(item);
                            if (item.type === 'service') return createServiceCard(item);
                            if (item.type === 'ad') return createAdCard(item);
                            if (item.type === 'proposal') return createProposalCard(item);
                            if (item.type === 'reel') return createReelCard(item);
                            if (item.id) return createOrderItem(item);
                            return '';
                        }).join('');
                        
                        if ((response.posts || response.products || response.lessons || response.orders || []).length === 0) {
                            container.innerHTML = `
                                <div class="empty-state">
                                    <i class="fas fa-${tabName === 'myProducts' ? 'box' : tabName === 'myDigital' ? 'book' : tabName === 'myLessons' ? 'chalkboard-teacher' : tabName === 'myServices' ? 'concierge-bell' : tabName === 'mySocial' ? 'users' : tabName === 'myAds' ? 'ad' : tabName === 'myProposals' ? 'file-alt' : tabName === 'myReels' ? 'video' : 'briefcase'}"></i>
                                    <h3 style="color: var(--white);">No ${tabName.replace('my', '')} yet</h3>
                                    <p>Create your first ${tabName.replace('my', '')}!</p>
                                </div>
                            `;
                        }
                    }
                }
            } catch (error) {
                console.error(`Error loading ${tabName}:`, error);
            }
        }

        function createOrderItem(order) {
            return `
                <div class="order-item" onclick="viewOrder('${order.id}')">
                    <h4>Order #${order.id.substring(0,8)}</h4>
                    <p>Amount: ${formatPrice(order.amount)}</p>
                    <p>Status: <span class="badge badge-${order.status}">${order.status}</span></p>
                    <p>Date: ${formatDate(order.created_at)}</p>
                </div>
            `;
        }

        function viewOrder(orderId) {
            document.getElementById('orderDetails').innerHTML = `Order details for ${orderId}`;
            document.getElementById('orderModal').classList.add('active');
        }
        
        // ============================================
        // REFERRAL & WITHDRAWAL FUNCTIONS
        // ============================================
        
        function copyReferralLink() {
            const link = document.getElementById('referralLink');
            link.select();
            link.setSelectionRange(0, 99999);
            copyToClipboard(link.value);
        }
        
        function updateReferralLink() {
            if (currentUser && currentUser.referralCode) {
                const link = `${window.location.origin}?ref=${currentUser.referralCode}`;
                document.getElementById('referralLink').value = link;
            }
        }
        
        function shareReferralLink() {
            const link = document.getElementById('referralLink').value;
            const text = `Join me on SOKOPLUS - Kenyans fastest growing marketplace! Use my referral link: ${link}`;
            
            if (navigator.share) {
                navigator.share({
                    title: 'Join SOKOPLUS',
                    text: text,
                    url: link
                });
            } else {
                copyToClipboard(text);
                showNotification('Referral message copied to clipboard! Share it on WhatsApp, Facebook, etc.', 'success');
            }
        }
        
        async function requestWithdrawal() {
            const amount = parseInt(document.getElementById('withdrawalAmount').value);
            const mpesaNumber = document.getElementById('withdrawalMpesa').value;
            
            if (!amount || amount < 100) {
                showNotification('Minimum withdrawal is KES 100', 'error');
                return;
            }
            
            if (!/^254[17]\d{8}$/.test(mpesaNumber)) {
                showNotification('Invalid M-Pesa number. Use format: 2547XXXXXXXX or 2541XXXXXXXX', 'error');
                return;
            }
            
            try {
                const response = await apiRequest('/withdrawals', {
                    method: 'POST',
                    body: JSON.stringify({
                        amount,
                        mpesaNumber
                    })
                });
                
                if (response) {
                    showNotification(`Withdrawal request of KES ${amount} submitted for admin approval`, 'success');
                    document.getElementById('withdrawalAmount').value = '';
                    document.getElementById('withdrawalMpesa').value = '';
                    
                    const stats = await apiRequest('/users/stats');
                    if (stats) {
                        updateDashboardStats(stats);
                    }
                }
            } catch (error) {
                console.error('Error requesting withdrawal:', error);
            }
        }
        
        // ============================================
        // CHAT FUNCTIONS
        // ============================================
        
        function openChatWithUser(userId) {
            chatPartnerId = userId;
            document.getElementById('chatModal').classList.add('active');
            loadChatMessages(userId);
            if (chatInterval) clearInterval(chatInterval);
            chatInterval = setInterval(() => loadChatMessages(userId), 3000);
        }

        function openChat() {
            showPage('chat');
            loadConversations();
        }

        async function loadChatMessages(userId) {
            const response = await apiRequest(`/messages?conversation_with=${userId}`);
            const container = document.getElementById('modalChatMessages');
            if (response && response.messages) {
                container.innerHTML = response.messages.map(m => `
                    <div class="chat-message ${m.sender_id === currentUser.id ? 'user' : 'bot'}">
                        <div class="message-bubble ${m.sender_id === currentUser.id ? 'user' : 'bot'}">
                            ${escapeHtml(m.message)}
                        </div>
                    </div>
                `).join('');
                container.scrollTop = container.scrollHeight;
            }
        }

        function sendModalChatMessage() {
            const message = document.getElementById('modalChatInput').value;
            if (!message || !chatPartnerId) return;
            apiRequest('/messages', {
                method: 'POST',
                body: JSON.stringify({
                    receiver_id: chatPartnerId,
                    message
                })
            }).then(() => {
                document.getElementById('modalChatInput').value = '';
                loadChatMessages(chatPartnerId);
            });
        }

        async function loadConversations() {
            const response = await apiRequest('/conversations');
            // Render conversation list
        }

        function loadUnreadChatCount() {
            // Update badge
        }
        
        // ============================================
        // ORDERS FUNCTIONS
        // ============================================
        
        async function loadOrders(role = 'buyer') {
            const response = await apiRequest(`/orders?role=${role}`);
            const container = document.getElementById('ordersContainer');
            if (response && response.orders) {
                container.innerHTML = response.orders.map(createOrderItem).join('');
            }
        }
        
        // ============================================
        // LEADERBOARD
        // ============================================
        
        async function loadLeaderboard() {
            const response = await apiRequest('/leaderboard');
            const container = document.getElementById('leaderboardList');
            if (response && response.users) {
                container.innerHTML = response.users.map((user, index) => `
                    <div class="member-card">
                        <div class="member-avatar">${user.name.charAt(0)}</div>
                        <h4>${escapeHtml(user.name)}</h4>
                        <p>Referrals: ${user.referrals}</p>
                        <p>Earnings: ${formatPrice(user.earnings)}</p>
                        <span class="badge badge-${index === 0 ? 'gold' : index === 1 ? 'silver' : index === 2 ? 'bronze' : 'info'}">#${index+1}</span>
                    </div>
                `).join('');
            }
        }
        
        // ============================================
        // SHOP FUNCTIONS
        // ============================================
        
        async function loadShop() {
            if (!currentUser) {
                showNotification('Please login to view shop', 'error');
                showPage('login');
                return;
            }
            
            try {
                const response = await apiRequest('/shops/me');
                if (response) {
                    updateShopHeader(response.shop);
                    loadShopRating(response.shop);
                    showShopTab('products');
                }
            } catch (error) {
                console.error('Error loading shop:', error);
            }
        }
        
        function updateShopHeader(shop) {
            const header = document.getElementById('shopHeader');
            if (!shop) {
                header.innerHTML = `
                    <div style="width: 100%; text-align: center; padding: 2rem;">
                        <div class="shop-avatar-lg" style="margin: 0 auto 1rem;">
                            <i class="fas fa-store"></i>
                        </div>
                        <h2>Create Your Shop</h2>
                        <p style="color: var(--light-gray); margin-bottom: 2rem;">Start selling your products and services in your own shop</p>
                        <button class="btn btn-primary" onclick="showShopTab('settings')">
                            <i class="fas fa-plus"></i> Create Shop
                        </button>
                    </div>
                `;
            } else {
                header.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 2rem; width: 100%;">
                        ${shop.logo ? 
                            `<img src="${shop.logo}" alt="${escapeHtml(shop.name)}" style="width: 120px; height: 120px; border-radius: var(--radius-xl); object-fit: cover; border: 3px solid var(--jumia-orange);">` :
                            `<div class="shop-avatar-lg">
                                <i class="fas fa-store"></i>
                            </div>`
                        }
                        <div style="flex: 1;">
                            <h2>${escapeHtml(shop.name)}</h2>
                            <p style="color: var(--light-gray); margin-bottom: 1rem;">${escapeHtml(shop.description || 'No description')}</p>
                            <div class="shop-stats">
                                <div class="shop-stat">
                                    <span class="shop-stat-value">${shop.productsCount || 0}</span>
                                    <span class="shop-stat-label">Products</span>
                                </div>
                                <div class="shop-stat">
                                    <span class="shop-stat-value">${shop.servicesCount || 0}</span>
                                    <span class="shop-stat-label">Services</span>
                                </div>
                                <div class="shop-stat">
                                    <span class="shop-stat-value">${shop.totalSales || 0}</span>
                                    <span class="shop-stat-label">Sales</span>
                                </div>
                                <div class="shop-stat">
                                    <span class="shop-stat-value">${shop.rating || '0.0'}</span>
                                    <span class="shop-stat-label">Rating</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            }
        }

        function loadShopRating(shop) {
            const ratingDisplay = document.getElementById('shopRatingDisplay');
            ratingDisplay.innerHTML = `
                <div class="shop-rating">
                    ${Array.from({length: 5}, (_, i) => `<i class="fas fa-star ${i < Math.round(shop.rating) ? '' : 'inactive'}"></i>`).join('')}
                    <span style="color: var(--light-gray); margin-left: 0.5rem;">(${shop.rating || 0})</span>
                    ${currentUser && currentUser.id !== shop.user_id ? `<button class="btn btn-sm btn-outline" onclick="showRatingModal('${shop.id}')">Rate Shop</button>` : ''}
                </div>
            `;
        }
        
        function showShopTab(tabName) {
            document.querySelectorAll('.dashboard-tab').forEach(tab => {
                tab.style.display = 'none';
            });
            document.querySelectorAll('.content-tabs .tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            const tab = document.getElementById(`shop${tabName.charAt(0).toUpperCase() + tabName.slice(1)}Tab`);
            if (tab) tab.style.display = 'block';
            
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            }
            loadShopTabContent(tabName);
        }
        
        async function loadShopTabContent(tabName) {
            try {
                if (tabName === 'products') {
                    const response = await apiRequest(`/posts?userId=${currentUser.id}&type=product`);
                    if (response) {
                        const container = document.getElementById('shopProductsGrid');
                        if (container) {
                            container.innerHTML = response.posts.map(createProductCard).join('');
                        }
                    }
                } else if (tabName === 'services') {
                    const response = await apiRequest(`/posts?userId=${currentUser.id}&type=service`);
                    if (response) {
                        const container = document.getElementById('shopServicesGrid');
                        if (container) {
                            container.innerHTML = response.posts.map(createServiceCard).join('');
                        }
                    }
                }
            } catch (error) {
                console.error(`Error loading shop ${tabName}:`, error);
            }
        }
        
        async function updateShopSettings() {
            const formData = {
                name: document.getElementById('shopName').value,
                description: document.getElementById('shopDescription').value,
                category: document.getElementById('shopCategory').value,
                whatsapp: document.getElementById('shopWhatsapp').value,
                location: document.getElementById('shopLocation').value,
                hours: document.getElementById('shopHours').value
            };
            
            try {
                const response = await apiRequest('/shops/me', {
                    method: 'PUT',
                    body: JSON.stringify(formData)
                });
                
                if (response) {
                    showNotification('Shop settings saved successfully!', 'success');
                    
                    const logoFile = document.getElementById('shopLogo').files[0];
                    if (logoFile) {
                        await uploadShopLogo(logoFile);
                    }
                    
                    const bannerFile = document.getElementById('shopBanner').files[0];
                    if (bannerFile) {
                        await uploadShopBanner(bannerFile);
                    }
                    
                    await loadShop();
                }
            } catch (error) {
                console.error('Error updating shop settings:', error);
            }
        }
        
        async function uploadShopLogo(file) {
            const formData = new FormData();
            formData.append('files', file);
            
            try {
                const response = await fetch(`${API_BASE_URL}/upload`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                
                const data = await response.json();
                if (response.ok && data.file) {
                    await apiRequest('/shops/logo', {
                        method: 'PUT',
                        body: JSON.stringify({ logo: data.file.url })
                    });
                } else {
                    throw new Error('Failed to upload logo');
                }
            } catch (error) {
                console.error('Error uploading shop logo:', error);
            }
        }
        
        async function uploadShopBanner(file) {
            const formData = new FormData();
            formData.append('files', file);
            
            try {
                const response = await fetch(`${API_BASE_URL}/upload`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                
                const data = await response.json();
                if (response.ok && data.file) {
                    await apiRequest('/shops/banner', {
                        method: 'PUT',
                        body: JSON.stringify({ banner: data.file.url })
                    });
                } else {
                    throw new Error('Failed to upload banner');
                }
            } catch (error) {
                console.error('Error uploading shop banner:', error);
            }
        }
        
        // ============================================
        // CV MANAGEMENT FUNCTIONS
        // ============================================
        
        async function loadMyCVs() {
            if (!currentUser) {
                showNotification('Please login to view CVs', 'error');
                showPage('login');
                return;
            }
            
            try {
                const response = await apiRequest(`/cvs?user_id=${currentUser.id}`);
                const container = document.getElementById('cvList');
                
                if (response && response.cvs && response.cvs.length > 0) {
                    container.innerHTML = response.cvs.map(cv => `
                        <div class="cv-item" onclick="viewCV('${cv.id}')">
                            <div class="cv-item-header">
                                <div class="cv-item-icon">
                                    <i class="fas fa-file-pdf"></i>
                                </div>
                                <div>
                                    <h4 style="color: var(--white);">${escapeHtml(cv.title)}</h4>
                                    <p style="color: var(--light-gray); font-size: 0.875rem;">
                                        Uploaded: ${formatDate(cv.uploaded_at)}
                                    </p>
                                </div>
                            </div>
                            <div>
                                <p style="color: var(--light-gray); font-size: 0.875rem;">
                                    ${escapeHtml(cv.summary || 'No summary provided')}
                                </p>
                                <div style="margin-top: 0.5rem;">
                                    ${cv.skills ? cv.skills.split(',').slice(0, 3).map(skill => 
                                        `<span class="badge badge-primary" style="margin-right: 0.25rem; margin-bottom: 0.25rem;">${escapeHtml(skill.trim())}</span>`
                                    ).join('') : ''}
                                </div>
                            </div>
                        </div>
                    `).join('');
                } else {
                    container.innerHTML = `
                        <div class="empty-state" style="grid-column: 1 / -1;">
                            <i class="fas fa-file-alt"></i>
                            <h3 style="color: var(--white);">No CVs Uploaded</h3>
                            <p>Upload your CV to showcase your skills to potential employers</p>
                            <button class="btn btn-primary mt-3" onclick="showPage('create-post')">
                                <i class="fas fa-upload"></i> Upload CV
                            </button>
                        </div>
                    `;
                }
            } catch (error) {
                console.error('Error loading CVs:', error);
            }
        }
        
        // ============================================
        // PROFILE FUNCTIONS
        // ============================================
        
        async function loadProfile() {
            if (!currentUser) {
                showNotification('Please login to edit profile', 'error');
                showPage('login');
                return;
            }
            
            document.getElementById('profileNameInput').value = currentUser.name;
            document.getElementById('profileEmailInput').value = currentUser.email;
            document.getElementById('profilePhoneInput').value = currentUser.phone;
            document.getElementById('profileLocation').value = currentUser.location || '';
            document.getElementById('profileBio').value = currentUser.bio || '';
            document.getElementById('profileBusiness').value = currentUser.business_name || '';
            document.getElementById('enable2FA').checked = currentUser.twoFA || false;
            if (currentUser.twoFA) {
                document.getElementById('2faSetup').style.display = 'block';
            }
        }
        
        async function updateProfile() {
            const formData = {
                name: document.getElementById('profileNameInput').value,
                email: document.getElementById('profileEmailInput').value,
                phone: document.getElementById('profilePhoneInput').value,
                location: document.getElementById('profileLocation').value,
                bio: document.getElementById('profileBio').value,
                business_name: document.getElementById('profileBusiness').value,
                twoFA: document.getElementById('enable2FA').checked
            };
            
            const currentPassword = document.getElementById('profileCurrentPassword').value;
            const newPassword = document.getElementById('profileNewPassword').value;
            const confirmPassword = document.getElementById('profileConfirmPassword').value;
            
            if (currentPassword && newPassword) {
                if (newPassword !== confirmPassword) {
                    showNotification('New passwords do not match', 'error');
                    return;
                }
                formData.currentPassword = currentPassword;
                formData.newPassword = newPassword;
            }
            
            try {
                const response = await apiRequest('/auth/profile', {
                    method: 'PUT',
                    body: JSON.stringify(formData)
                });
                
                if (response) {
                    currentUser = { ...currentUser, ...response.user };
                    localStorage.setItem('sokoplus_user', JSON.stringify(currentUser));
                    
                    showNotification('Profile updated successfully!', 'success');
                    
                    const pictureFile = document.getElementById('profilePicture').files[0];
                    if (pictureFile) {
                        await uploadProfilePicture(pictureFile);
                    }
                    
                    document.getElementById('profileCurrentPassword').value = '';
                    document.getElementById('profileNewPassword').value = '';
                    document.getElementById('profileConfirmPassword').value = '';
                }
            } catch (error) {
                console.error('Error updating profile:', error);
            }
        }
        
        async function uploadProfilePicture(file) {
            const formData = new FormData();
            formData.append('files', file);
            
            try {
                const response = await fetch(`${API_BASE_URL}/upload`, {
                    method: 'POST',
                    headers: {
                        'Authorization': `Bearer ${authToken}`
                    },
                    body: formData
                });
                
                const data = await response.json();
                if (response.ok && data.file) {
                    const updateRes = await apiRequest('/auth/profile', {
                        method: 'PUT',
                        body: JSON.stringify({ profile_picture: data.file.url })
                    });
                    if (updateRes) {
                        currentUser.profile_picture = data.file.url;
                        localStorage.setItem('sokoplus_user', JSON.stringify(currentUser));
                        showNotification('Profile picture updated!', 'success');
                    }
                }
            } catch (error) {
                console.error('Error uploading profile picture:', error);
            }
        }
        
        // ============================================
        // CHATBOT FUNCTIONS
        // ============================================
        
        function initChatbot() {
            addBotMessage("Hello! I'm SOKOPLUS Assistant. How can I help you with our marketplace today?");
        }
        
        function toggleChatbot() {
            const chatbot = document.getElementById('chatbotContainer');
            chatbot.classList.toggle('active');
            
            if (chatbot.classList.contains('active')) {
                setTimeout(() => {
                    const messages = document.getElementById('chatbotMessages');
                    messages.scrollTop = messages.scrollHeight;
                }, 100);
            }
        }
        
        function addBotMessage(text) {
            const messages = document.getElementById('chatbotMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message bot';
            messageDiv.innerHTML = `
                <div class="message-bubble bot">${escapeHtml(text)}</div>
            `;
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
        }
        
        function addUserMessage(text) {
            const messages = document.getElementById('chatbotMessages');
            const messageDiv = document.createElement('div');
            messageDiv.className = 'chat-message user';
            messageDiv.innerHTML = `
                <div class="message-bubble user">${escapeHtml(text)}</div>
            `;
            messages.appendChild(messageDiv);
            messages.scrollTop = messages.scrollHeight;
        }
        
        function sendChatMessage() {
            const input = document.getElementById('chatbotInput');
            const message = input.value.trim();
            
            if (!message) return;
            
            addUserMessage(message);
            input.value = '';
            
            setTimeout(() => {
                const response = getBotResponse(message);
                addBotMessage(response);
            }, 500);
        }
        
        function sendQuickQuestion(question) {
            addUserMessage(question);
            
            setTimeout(() => {
                const response = getBotResponse(question);
                addBotMessage(response);
            }, 500);
        }
        
        function getBotResponse(message) {
            const lowerMessage = message.toLowerCase();
            
            if (lowerMessage.includes('auto') || lowerMessage.includes('automatic') || lowerMessage.includes('stk')) {
                return "Automatic payments use M-Pesa STK Push:\n1. Select 'Automatic Payment' option\n2. Enter your M-Pesa PIN on your phone\n3. Payment is processed instantly\n4. Subscription/boost/ads activate immediately\n\nNo waiting for admin approval!";
            } else if (lowerMessage.includes('manual') || lowerMessage.includes('paybill')) {
                return "Manual payments use Paybill:\n1. Select 'Manual Payment' option\n2. Send money via M-Pesa:\n   • Paybill: 222111\n   • Account: 5414200\n3. Enter transaction code received\n4. Admin approves within 24 hours";
            } else if (lowerMessage.includes('post') || lowerMessage.includes('create')) {
                return "To create a post:\n1. Subscribe first (KES 50/week for individuals, KES 100/week for businesses)\n2. Go to 'Create Post'\n3. Choose post type (product, social, job, service, CV, ad, proposal, reel, digital, lesson)\n4. Fill details and upload media\n5. Submit for posting\n\nSubscribed users post for free!";
            } else if (lowerMessage.includes('subscribe') || lowerMessage.includes('cost')) {
                return "Subscription plans:\n• Individual: KES 50/week or KES 200/month\n• Business: KES 100/week or KES 400/month\nBenefits:\n• Unlimited free posts\n• Access to marketplace\n• Earn 50% referral commissions\n• Business tools (for premium)";
            } else if (lowerMessage.includes('boost') || lowerMessage.includes('visibility')) {
                return "Boost your posts for KES 100:\n• Automatic: Instant activation via STK Push\n• Manual: Paybill then enter transaction code\n• Boosted posts get premium placement\n• Featured in Boosted section for 7 days";
            } else if (lowerMessage.includes('ad') || lowerMessage.includes('advertise')) {
                return "Create ads for KES 299/week:\n• Display on homepage next to trending categories\n• Eye-catching cards with image, title, description, and link\n• Choose duration (1, 2, or 4 weeks)\n• Automatic or manual payment\n• Admins can add offers to ads";
            } else if (lowerMessage.includes('referral') || lowerMessage.includes('bonus')) {
                return "Referral bonuses: Earn 50% commission when your referred users subscribe or boost their posts. The remaining 50% goes to platform revenue. Weekly bonus: Refer 20 people and they each boost at least one post to earn KES 300!";
            } else if (lowerMessage.includes('calculator') || lowerMessage.includes('profit')) {
                return "Use our Business Calculator under Business Tools to compute profit, revenue, costs, and margins.";
            } else if (lowerMessage.includes('reel') || lowerMessage.includes('video')) {
                return "Upload reels to engage your audience. When your reel gets 1500 views and you have referred 360 users with monthly subscription (KES 200), you earn a KES 10,000 bonus! Check your dashboard for progress.";
            } else if (lowerMessage.includes('digital') || lowerMessage.includes('ebook') || lowerMessage.includes('template')) {
                return "You can sell digital products like ebooks, templates, canvas, and online lessons. Use the 'Digital Product' form in Create Post. Buyers can pay using their wallet balance or deposit funds.";
            } else if (lowerMessage.includes('lesson') || lowerMessage.includes('course')) {
                return "Sell online lessons with video or playlist. Upload thumbnail and videos. Buyers can purchase and watch instantly.";
            } else if (lowerMessage.includes('wallet') || lowerMessage.includes('deposit')) {
                return "Your wallet balance can be used to purchase products, digital goods, and lessons. You can deposit funds via M-Pesa (automatic or manual) from your dashboard.";
            } else if (lowerMessage.includes('resell')) {
                return "You can resell any product by clicking 'Resell' on its card. Share your unique resell link – when someone buys through it, you earn a commission (usually 10%).";
            } else if (lowerMessage.includes('tip')) {
                return "Support creators by tipping them on their reels. Click the gift icon on a reel, choose an amount, and the tip will be deducted from your wallet and sent to the creator.";
            } else if (lowerMessage.includes('rate') || lowerMessage.includes('rating')) {
                return "You can rate shops you've purchased from. Click 'Rate Shop' on a shop page and give a star rating. Your feedback helps others!";
            } else if (lowerMessage.includes('admin') || lowerMessage.includes('contact')) {
                return `Contact SOKOPLUS admin:\n• Email: sokoplus254@gmail.com\n• WhatsApp: +254712883849\n• Paybill: 222111\n• Account: 5414200\n\nAuto payments: Instant\nManual approvals: 24hrs`;
            } else if (lowerMessage.includes('2fa') || lowerMessage.includes('two factor')) {
                return "You can enable Two‑Factor Authentication in your Profile settings for extra security.";
            } else if (lowerMessage.includes('leaderboard')) {
                return "Check out the Leaderboard to see top referrers and earners. You can find it in the navigation menu.";
            } else {
                const responses = [
                    "I can help with automatic/manual payments, subscriptions, posting, ads, and more!",
                    "Ask me about payment methods, business tools, or marketplace features.",
                    "Need help with payments? I can explain automatic (STK Push) or manual (Paybill) options.",
                    "Is there anything else I can help you with regarding SOKOPLUS?",
                    "You can create ads to promote your business on our homepage for just KES 299/week!",
                    "Check out our referral bonuses – earn 50% commission on every referral!",
                    "Upload reels and earn KES 10,000 when you hit 1500 views and 360 monthly referrals!",
                    "Sell digital products and get paid instantly to your wallet.",
                    "Resell products and earn commissions – just share your unique link!",
                    "Tip your favorite creators on reels – it's a great way to show support."
                ];
                return responses[Math.floor(Math.random() * responses.length)];
            }
        }
        
        // ============================================
        // FORM LOADING FUNCTIONS
        // ============================================
        
        function loadRegisterForm() {
            const form = document.getElementById('registerForm');
            if (!form) return;
            
            const urlParams = new URLSearchParams(window.location.search);
            const refCode = urlParams.get('ref') || '';
            
            form.innerHTML = `
                <div class="form-group">
                    <label class="form-label">Full Name *</label>
                    <input type="text" class="form-control" id="registerName" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Email Address *</label>
                    <input type="email" class="form-control" id="registerEmail" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Phone Number *</label>
                    <input type="text" class="form-control" id="registerPhone" placeholder="2547XXXXXXXX" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Account Type *</label>
                    <div style="display: flex; gap: 1rem; margin-bottom: 0.5rem;">
                        <label style="color: var(--white);">
                            <input type="radio" name="accountType" value="individual" checked onchange="toggleCompanyField()"> Individual
                        </label>
                        <label style="color: var(--white);">
                            <input type="radio" name="accountType" value="company" onchange="toggleCompanyField()"> Company
                        </label>
                    </div>
                </div>
                
                <div id="companyNameField" class="form-group" style="display: none;">
                    <label class="form-label">Company Name *</label>
                    <input type="text" class="form-control" id="registerCompany" placeholder="Your company name">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password *</label>
                    <input type="password" class="form-control" id="registerPassword" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Referral Code (Optional)</label>
                    <input type="text" class="form-control" id="registerReferral" value="${escapeHtml(refCode)}">
                </div>
                
                <button type="submit" class="btn btn-primary w-full">
                    <i class="fas fa-user-plus"></i> Create Account
                </button>
                
                <div class="text-center mt-3">
                    <p style="color: var(--light-gray);">
                        Already have an account? 
                        <a href="#" onclick="showPage('login'); return false;" style="color: var(--primary-light);">Login here</a>
                    </p>
                </div>
            `;
            
            form.onsubmit = async function(e) {
                e.preventDefault();
                
                const accountType = document.querySelector('input[name="accountType"]:checked').value;
                const businessName = accountType === 'company' ? document.getElementById('registerCompany').value : '';
                
                if (accountType === 'company' && !businessName) {
                    showNotification('Please enter your company name', 'error');
                    return;
                }
                
                const userData = {
                    name: document.getElementById('registerName').value,
                    email: document.getElementById('registerEmail').value,
                    phone: document.getElementById('registerPhone').value,
                    password: document.getElementById('registerPassword').value,
                    referralCode: document.getElementById('registerReferral').value,
                    accountType: accountType,
                    businessName: businessName
                };
                
                await registerUser(userData);
            };
        }

        window.toggleCompanyField = function() {
            const companyField = document.getElementById('companyNameField');
            const isCompany = document.querySelector('input[name="accountType"]:checked').value === 'company';
            companyField.style.display = isCompany ? 'block' : 'none';
        };
        
        function loadLoginForm() {
            const form = document.getElementById('loginForm');
            if (!form) return;
            
            form.innerHTML = `
                <div class="form-group">
                    <label class="form-label">Email Address *</label>
                    <input type="email" class="form-control" id="loginEmail" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password *</label>
                    <input type="password" class="form-control" id="loginPassword" required>
                </div>
                
                <button type="submit" class="btn btn-primary w-full">
                    <i class="fas fa-sign-in-alt"></i> Login
                </button>
                
                <div class="text-center mt-3">
                    <a href="#" onclick="showPage('forgot-password'); return false;" style="color: var(--primary-light);">
                        Forgot password?
                    </a>
                    <p style="color: var(--light-gray); margin-top: 1rem;">
                        Don't have an account? 
                        <a href="#" onclick="showPage('register'); return false;" style="color: var(--primary-light);">Register here</a>
                    </p>
                </div>
            `;
            
            form.onsubmit = async function(e) {
                e.preventDefault();
                
                const email = document.getElementById('loginEmail').value;
                const password = document.getElementById('loginPassword').value;
                
                await loginUser(email, password);
            };
        }
        
        function loadSubscriptionForm() {
            selectPaymentMethodForSubscription('automatic');
            selectPlan('individual');
            selectDuration('week');
        }
        
        // ============================================
        // ADMIN FUNCTIONS
        // ============================================
        
        async function loadAdminPanel() {
            if (!currentUser || currentUser.role !== 'admin') {
                showNotification('Unauthorized', 'error');
                showPage('home');
                return;
            }
            
            try {
                const stats = await apiRequest('/admin/stats');
                if (stats) {
                    document.getElementById('adminUsers').textContent = stats.totalUsers || 0;
                    document.getElementById('adminPosts').textContent = stats.totalPosts || 0;
                    document.getElementById('adminPending').textContent = stats.pendingApprovals || 0;
                    document.getElementById('adminRevenue').textContent = formatPrice(stats.totalRevenue || 0);
                }
                
                showAdminTab('pending');
            } catch (error) {
                console.error('Error loading admin panel:', error);
            }
        }
        
        function showAdminTab(tabName) {
            document.querySelectorAll('#admin .tab-btn').forEach(btn => btn.classList.remove('active'));
            if (event && event.currentTarget) {
                event.currentTarget.classList.add('active');
            }
            loadAdminContent(tabName);
        }
        
        async function loadAdminContent(tabName) {
            const container = document.getElementById('adminContent');
            
            if (tabName === 'pending') {
                const response = await apiRequest('/admin/payments/pending');
                container.innerHTML = `
                    <h3 style="margin-bottom: 1rem;">Pending Payments</h3>
                    <table class="admin-table">
                        <thead><tr><th>User</th><th>Type</th><th>Amount</th><th>Transaction</th><th>Actions</th></tr></thead>
                        <tbody>
                            ${response?.payments?.map(p => `
                                <tr>
                                    <td>${escapeHtml(p.user?.name) || ''} (${escapeHtml(p.user?.phone) || ''})</td>
                                    <td>${p.type}</td>
                                    <td>${formatPrice(p.amount)}</td>
                                    <td>${escapeHtml(p.transaction_code)}</td>
                                    <td><button class="btn btn-success btn-sm" onclick="approvePayment('${p.id}')">Approve</button></td>
                                </tr>
                            `).join('') || '<tr><td colspan="5">No pending payments</td></tr>'}
                        </tbody>
                    </table>
                `;
            } else if (tabName === 'withdrawals') {
                const response = await apiRequest('/admin/withdrawals/pending');
                container.innerHTML = `
                    <h3 style="margin-bottom: 1rem;">Pending Withdrawals</h3>
                    <table class="admin-table">
                        <thead><tr><th>User</th><th>Amount</th><th>Net</th><th>M-Pesa</th><th>Actions</th></tr></thead>
                        <tbody>
                            ${response?.withdrawals?.map(w => `
                                <tr>
                                    <td>${escapeHtml(w.user?.name) || ''}</td>
                                    <td>${formatPrice(w.amount)}</td>
                                    <td>${formatPrice(w.net_amount)}</td>
                                    <td>${escapeHtml(w.mpesa_number)}</td>
                                    <td><button class="btn btn-success btn-sm" onclick="approveWithdrawal('${w.id}')">Approve</button></td>
                                </tr>
                            `).join('') || '<tr><td colspan="5">No pending withdrawals</td></tr>'}
                        </tbody>
                    </table>
                `;
            } else if (tabName === 'users') {
                const response = await apiRequest('/admin/users');
                container.innerHTML = `
                    <h3 style="margin-bottom: 1rem;">All Users</h3>
                    <table class="admin-table">
                        <thead><tr><th>Name</th><th>Email</th><th>Phone</th><th>Status</th><th>Role</th><th>Actions</th></tr></thead>
                        <tbody>
                            ${response?.users?.map(u => `
                                <tr>
                                    <td>${escapeHtml(u.name)}</td>
                                    <td>${escapeHtml(u.email)}</td>
                                    <td>${escapeHtml(u.phone)}</td>
                                    <td><span class="badge ${u.status === 'active' ? 'badge-success' : 'badge-danger'}">${u.status}</span></td>
                                    <td>${u.role}</td>
                                    <td>
                                        <button class="btn btn-sm btn-outline" onclick="editUser('${u.id}')">Edit</button>
                                        ${u.status === 'active' ? 
                                            `<button class="btn btn-sm btn-danger" onclick="deactivateUser('${u.id}')">Deactivate</button>` : 
                                            `<button class="btn btn-sm btn-success" onclick="activateUser('${u.id}')">Activate</button>`
                                        }
                                    </td>
                                </tr>
                            `).join('') || '<tr><td colspan="6">No users</td></tr>'}
                        </tbody>
                    </table>
                `;
            } else if (tabName === 'analytics') {
                const chartId = 'adminChart-' + Date.now();
                container.innerHTML = `
                    <h3>Platform Analytics</h3>
                    <canvas id="${chartId}" width="400" height="200"></canvas>
                `;
                setTimeout(() => {
                    const canvas = document.getElementById(chartId);
                    if (canvas) {
                        const ctx = canvas.getContext('2d');
                        if (ctx) {
                            if (chartInstances.admin) chartInstances.admin.destroy();
                            chartInstances.admin = new Chart(ctx, {
                                type: 'bar',
                                data: {
                                    labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May'],
                                    datasets: [{
                                        label: 'Revenue (KES)',
                                        data: [12000, 19000, 3000, 5000, 20000],
                                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                                        borderColor: 'rgb(75, 192, 192)',
                                        borderWidth: 1
                                    }]
                                }
                            });
                        }
                    }
                }, 100);
            } else {
                container.innerHTML = `<div class="empty-state">Coming soon...</div>`;
            }
        }
        
        async function approvePayment(paymentId) {
            try {
                const response = await apiRequest(`/admin/payments/${paymentId}/approve`, { method: 'PUT' });
                if (response) {
                    showNotification('Payment approved', 'success');
                    loadAdminContent('pending');
                }
            } catch (error) {
                console.error('Error approving payment:', error);
            }
        }
        
        async function approveWithdrawal(withdrawalId) {
            try {
                const response = await apiRequest(`/admin/withdrawals/${withdrawalId}/approve`, { method: 'PUT' });
                if (response) {
                    showNotification('Withdrawal approved', 'success');
                    loadAdminContent('withdrawals');
                }
            } catch (error) {
                console.error('Error approving withdrawal:', error);
            }
        }
        
        async function deactivateUser(userId) {
            if (!confirm('Deactivate this user? They will need to resubscribe to post again.')) return;
            try {
                const response = await apiRequest(`/admin/users/${userId}`, {
                    method: 'PUT',
                    body: JSON.stringify({ status: 'inactive' })
                });
                if (response) {
                    showNotification('User deactivated', 'success');
                    loadAdminContent('users');
                }
            } catch (error) {
                console.error('Error deactivating user:', error);
            }
        }
        
        async function activateUser(userId) {
            try {
                const response = await apiRequest(`/admin/users/${userId}`, {
                    method: 'PUT',
                    body: JSON.stringify({ status: 'active' })
                });
                if (response) {
                    showNotification('User activated', 'success');
                    loadAdminContent('users');
                }
            } catch (error) {
                console.error('Error activating user:', error);
            }
        }
        
        function editUser(userId) {
            showNotification('Edit user feature coming soon', 'info');
        }
        
        function viewReel(reelId) {
            showNotification('View reel feature coming soon', 'info');
        }
        
        // ============================================
        // MISSING FEATURE FUNCTIONS (Placeholders)
        // ============================================
        
        function viewPost(postId) {
            showNotification('View post feature coming soon!', 'info');
        }
        
        function likePost(postId) {
            if (!currentUser) {
                showNotification('Please login to like posts', 'error');
                return;
            }
            fetch(`${API_BASE_URL}/posts/${postId}/like`, {
                method: 'POST',
                headers: {
                    'Authorization': `Bearer ${authToken}`
                }
            })
            .then(res => res.json())
            .then(data => {
                if (data.success) {
                    showNotification(data.liked ? 'Post liked!' : 'Post unliked!', 'success');
                }
            })
            .catch(err => console.error(err));
        }
        
        function sharePost(postId) {
            const url = `${window.location.origin}?post=${postId}`;
            if (navigator.share) {
                navigator.share({
                    title: 'Check out this post on SOKOPLUS',
                    url: url
                });
            } else {
                copyToClipboard(url);
                showNotification('Post link copied to clipboard!', 'success');
            }
        }
        
        function contactSeller(postId, sellerWhatsapp) {
            if (sellerWhatsapp) {
                window.open(`https://wa.me/${sellerWhatsapp}`, '_blank');
            } else {
                showNotification('Seller contact not available', 'error');
            }
        }
        
        function showShop(shopId) {
            window.location.hash = `shop?id=${shopId}`;
            showPage('shop');
            // Load shop by ID (if not current user's shop)
            // For simplicity, we'll just show the shop page (current user's shop)
        }
        
        function processAdPayment() {
            showNotification('Processing ad payment...', 'info');
            setTimeout(() => {
                showNotification('Ad payment successful!', 'success');
                showPage('dashboard');
            }, 2000);
        }
        
        function processUpgrade() {
            showNotification('Processing upgrade...', 'info');
            setTimeout(() => {
                showNotification('Upgrade successful! You now have premium access.', 'success');
                if (currentUser) {
                    currentUser.upgraded = true;
                    localStorage.setItem('sokoplus_user', JSON.stringify(currentUser));
                }
                showPage('dashboard');
            }, 2000);
        }
        
        function viewCV(cvId) {
            showNotification('CV detail view coming soon!', 'info');
        }
        
        function previewShopLogo() {
            const file = document.getElementById('shopLogo').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('shopLogoPreview').innerHTML = `<img src="${e.target.result}" style="max-width: 100px; border-radius: var(--radius);">`;
                };
                reader.readAsDataURL(file);
            }
        }
        
        function previewShopBanner() {
            const file = document.getElementById('shopBanner').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('shopBannerPreview').innerHTML = `<img src="${e.target.result}" style="max-width: 100%; max-height: 150px; border-radius: var(--radius);">`;
                };
                reader.readAsDataURL(file);
            }
        }
        
        function previewProfilePicture() {
            const file = document.getElementById('profilePicture').files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    document.getElementById('profilePicturePreview').innerHTML = `<img src="${e.target.result}" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover;">`;
                };
                reader.readAsDataURL(file);
            }
        }
        
        function loadCreatePost() {
            // Any initialization for create post page
        }
        
        function loadForgotPasswordForm() {
            const container = document.getElementById('forgotPasswordForm');
            container.innerHTML = `
                <form id="forgotPasswordFormInner">
                    <div class="form-group">
                        <label class="form-label">Email Address *</label>
                        <input type="email" class="form-control" id="forgotEmail" required>
                    </div>
                    <button type="submit" class="btn btn-primary w-full">
                        <i class="fas fa-paper-plane"></i> Send Reset Link
                    </button>
                    <div class="text-center mt-3">
                        <a href="#" onclick="showPage('login'); return false;" style="color: var(--primary-light);">Back to Login</a>
                    </div>
                </form>
            `;
            document.getElementById('forgotPasswordFormInner').onsubmit = function(e) {
                e.preventDefault();
                const email = document.getElementById('forgotEmail').value;
                fetch(`${API_BASE_URL}/auth/forgot-password`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ email })
                })
                .then(res => res.json())
                .then(data => {
                    if (data.success) {
                        showNotification('Password reset link sent to your email', 'success');
                        showPage('login');
                    } else {
                        showNotification(data.message || 'Failed to send reset link', 'error');
                    }
                })
                .catch(err => console.error(err));
            };
        }
        
        // ============================================
        // GLOBAL FUNCTION EXPORTS
        // ============================================
        
        window.showPage = showPage;
        window.showHomeTab = showHomeTab;
        window.showDashboardTab = showDashboardTab;
        window.showAdminTab = showAdminTab;
        window.showShopTab = showShopTab;
        window.showPostForm = showPostForm;
        window.showBusinessModal = showBusinessModal;
        window.filterMarketplace = filterMarketplace;
        window.selectPaymentMethod = selectPaymentMethod;
        window.selectPaymentMethodForSubscription = selectPaymentMethodForSubscription;
        window.selectPaymentMethodForBoost = selectPaymentMethodForBoost;
        window.selectAdPaymentMethod = selectAdPaymentMethod;
        window.copyReferralLink = copyReferralLink;
        window.shareReferralLink = shareReferralLink;
        window.viewPost = viewPost;
        window.contactSeller = contactSeller;
        window.likePost = likePost;
        window.sharePost = sharePost;
        window.logout = logout;
        window.closeModal = closeModal;
        window.toggleChatbot = toggleChatbot;
        window.sendChatMessage = sendChatMessage;
        window.sendQuickQuestion = sendQuickQuestion;
        window.copyToClipboard = copyToClipboard;
        window.processAutomaticPayment = processAutomaticPayment;
        window.submitManualPayment = submitManualPayment;
        window.processBoostPayment = processBoostPayment;
        window.submitBoostPayment = submitBoostPayment;
        window.previewAdImage = previewAdImage;
        window.updateAdAmount = updateAdAmount;
        window.selectPlan = selectPlan;
        window.selectDuration = selectDuration;
        window.calculateProfit = calculateProfit;
        window.calculateCost = calculateCost;
        window.calculateROI = calculateROI;
        window.calculatePrice = calculatePrice;
        window.showCalculatorTab = showCalculatorTab;
        window.approvePayment = approvePayment;
        window.approveWithdrawal = approveWithdrawal;
        window.deactivateUser = deactivateUser;
        window.activateUser = activateUser;
        window.previewProposalFile = previewProposalFile;
        window.previewReelVideo = previewReelVideo;
        window.previewShopLogo = previewShopLogo;
        window.previewShopBanner = previewShopBanner;
        window.previewProfilePicture = previewProfilePicture;
        window.processAdPayment = processAdPayment;
        window.processUpgrade = processUpgrade;
        window.viewUserProfile = viewUserProfile;
        window.viewReel = viewReel;
        window.showDepositModal = showDepositModal;
        window.showPurchaseModal = showPurchaseModal;
        window.showResellModal = showResellModal;
        window.copyResellLink = copyResellLink;
        window.showTipModal = showTipModal;
        window.sendTip = sendTip;
        window.showRatingModal = showRatingModal;
        window.setRating = setRating;
        window.submitRating = submitRating;
        window.closeAdPopup = closeAdPopup;
        window.toggleLessonType = toggleLessonType;
        window.setLanguage = setLanguage;
        window.show2FAModal = show2FAModal;
        window.verify2FA = verify2FA;
        window.verify2FALogin = verify2FALogin;
        window.openChatWithUser = openChatWithUser;
        window.sendModalChatMessage = sendModalChatMessage;
        window.loadOrders = loadOrders;
        window.viewOrder = viewOrder;
        window.editUser = editUser;
        
    </script>
</body>
</html>
